= S-100 ECDIS and Interoperability Specification
:series: S
:docnumber: 98
:doctype: standard
:edition: 2.0.0
:language: en
:published-date: 2022-03-01
:copyright-year: 2025
:status: in-force
:committee: ircc
:workgroup: ibsc
:mn-document-class: iho
:mn-output-extensions: xml,html,doc,pdf,rxl
:local-cache-only:
:data-uri-image:
:imagesdir: images

[.preface]
== Document History

Changes to this Specification are coordinated by the IHO S-100 Working
Group. New editions will be made available via the IHO website. Maintenance
of the Specification shall conform to IHO Resolution 2/2007 (as amended).

[cols="87,93,69,299"]
|===
h| Version Number h| Date h| Approved By h| Purpose

| 0.0.1 | 28 Aug 2020 | RM       | First draft. Reviewed by EM.
| 0.0.2 | 01 Nov 2021 | J.Powell | Numerous revisions to take into account the S-98 Correspondence Group adjudication work.
| 1.0.0 | May 2022    | S-100WG  | Submission to HSSC14 for approval.
| 1.0.0 | May 2022    | HSSC     | Initial published version for evaluation and testing.

| 1.1.0
| August 2023
|
| Added MSC.530(106)/Rev.1 in place of MSC.232(82) and updated text
accordingly ("SENC" to "System Database"- various clauses); updated
tidal stream panel presentation (C-15.4); fixed heading 1 and heading
2 styles; added new clause listing allowed support file formats for
ECDIS and elaborated rules for additional information in text (C-11.5);
struck alternate labels in Tables C-2 and C-3;

| 1.2.0
| February 2024
|
| Collection of issues identified by subgroup and external stakeholder.

| 1.3.0
| May 2024
|
| Incorporating stakeholder inputs, GitHub discussions and TSM 2024 outputs.

| 1.3.4
| July 2024
|
| Version after review meetings

| 1.4.0
| August 2024
|
| Version prepared for F2F meeting with stakeholders.

| 1,6.0
| September 2024
|
| Prepared following Face to Face meeting.

| 1.7.1
| October 2024
|
| Remainder of comments received applied and commented.

| 1.8.0 [2.0.0]
| January 2025
|
| Draft for 2.0.0, HSSC 2025 following VTC reviews and resolutions
of comments from F2F meeting.

| 1.9.0[2.0.0]
| March 2025
|
| Prepared version for TSM 2025

| 2.0.0
| March 2025
|
| Version submitted to HSSC 2025

|===

== Introduction

This document contains requirements and guidance for the implementation
of harmonised portrayal and other user interaction functions for S-101
Electronic Navigational Chart (ENC) and other S-100 based data products
in an Electronic Chart Display and Information System (ECDIS). It
describes how S-100 products are to be used and displayed simultaneously
on the navigation screen. It does not address the portrayal processes
or architectures, which are addressed in S-100 Part 9. It is based
on the general principles described in S-100 Part 16A, and the requirements
for ECDIS specified in the relevant International Maritime Organization
(IMO), International Hydrographic Organization (IHO), and International
Electrotechnical Commission (IEC) standards.

This specification is the successor to the IHO S-52 Standard for chart
content and display in ECDIS. It contains material from S-52 that
has been updated for S-100, but does not include symbol specifications
(the S-52 "presentation library") or portrayal rules because symbols
and portrayal rules are now defined in the IHO GI Registry and portrayal
catalogues for individual product specifications. This document focuses
on the principles for portraying S-101 ENC and S-100 based data on
ECDIS. The principles described herein are intended to be compatible
with the corresponding requirements for ECDIS portrayal of S-57 ENCs.

This specification does not revoke nor does it supersede S-52 in its
applicability to the use of S-57 information on ECDIS. It assumes
ECDIS will support both S-52/S-57 and S-101 ENCs for the foreseeable
future. Such systems should continue to follow the S-52/S-57 standards
for S-57 information.

ECDIS presentation and user interactions are determined by the following
standards:

* IMO standards control presentation, performance, and user experience.
They include standards and guidelines for display and user interaction,
including alerts.
* IHO standards provide the framework for data content, primarily
in S-100, as well as standards for portrayal of hydrographic data.
S-100 also provides an abstract specification for visual interoperability;
for ECDIS, details about interoperability are specified in S-98. IHO
standards additionally provide methods of test and required test results
for portrayal and interoperability, these are in S-64 (for S-57) and
S-164 (for S-100).
* IEC standards describe methods and required results for equipment
and system testing.
* Data product specifications describe the content, data formats,
symbols, portrayal rules, packaging, and delivery, of individual data
products. For ECDIS, the basic data product is S-101
(Electronic Navigational Charts). Other products describe additional
information relevant to navigation, for example, bathymetry, currents,
water levels, regulated areas, services and weather.

The standards that are current at the time of writing of this specification
are listed in the References section. More detailed information about
the various standards is provided in S-100 Part 16a.

Application developers should obtain an up-to-date set of applicable
standards and specifications from the relevant organisations. Developers
must conform to the mandatory requirements of the particular standards
which apply to an application or system. In case of a conflict between
this specification and a mandatory requirement in an applicable standard,
the requirement in the standard supersedes the guidance in this specification.
Manufacturers, type-approval authorities, and above all Mariners,
are always encouraged to contact the IHO to provide feedback that
they may have about the ECDIS display, in order that this specification
can be kept effective and up to date.

This specification also applies to navigation displays in an Integrated
Navigation System (INS) which fulfil the role of an ECDIS. Users of
this document should refer to IEC publications when dealing with implementation
testing.

This document contains the main requirements and guidance for development
of S-100 ECDIS. Mariners and other users will receive different S-100-based
data products, each providing one or more information layers, and
will often need to view some of the information layers simultaneously
on a S-100 compatible ECDIS as well as in other ship and shore-based
scenarios.

The smooth interoperability and harmonized user-friendly graphical
presentations of these various products is therefore necessary. The
rules for interoperation and harmonized graphical presentations of
S-100 data products are contained in an _Interoperability Catalogue_,
which describes how groups of products are to be used and displayed
simultaneously.

Annex A to this Specification describes the structure, usage and rules
for development of Interoperability Catalogues that can be used by
systems to control the simultaneous use and display of two or more
S-100 based data products. It is an implementation of the abstract
interoperability concepts described in S-100 Part 16. Part A and B
of this specification define levels 1 and 2 respectively.

NOTE: the current edition of S-98 does not use the full interoperability
specification, it is included on the basis that it is highly likely
to be brought in in a future edition.

== Abbreviations and Notation

=== Abbreviations

AIS:: Automatic Identification System

ARPA:: Automatic Radar Plotting Aid

CRS:: Coordinate Reference System

CSS:: Cascading Style Sheets

EBL:: Electronic Bearing Line

ECDIS:: Electronic Chart Display and Information System

ECS:: Electronic Chart System

ENC:: Electronic Navigational Chart

ENDS:: Electronic Navigational Data Service

ENP:: Electronic Nautical Publication

GML:: Geographic Markup Language

HO:: Hydrographic Office

INS:: Integrated Navigation System

IEC:: International Electrotechnical Commission

IHO:: International Hydrographic Organization

IMO:: International Maritime Organization

SD:: System Database

SECOM:: Secure communication between ship and shore

SVG:: Scalable Vector Graphics

VRM:: Variable Range Marker

XML:: eXtensible Markup Language

XSLT:: eXtensible Stylesheet Language Transformations

=== Notation

The following notation is used throughout the document to describe
various portrayal aspects.

(Name of feature or information type):: Features and information types
are referenced by their names in camel-case or space-separated names
in initial capitals ("LandArea" or "Land Area").

(Name of attribute):: Attributes are referenced by their names in
camel-case with initial letters in lower case, or space-separated
names in all lower case ("visuallyConspicuous" or "visually conspicuous").

(Portrayal register item):: Items from the IHO portrayal registry
are referenced by their registered name and item type
("line style SCLBDY51"). The portrayal registry is a component of
the IHO Geospatial Information Registry (https://registry.iho.int/[https://registry.iho.int]).

=== Normative vs Informative within this document.

This document uses the word "must" to describe how mandatory functionality
for S-100 ECDIS must be implemented. Some parts of the S-100 framework
are also described in overview to provide useful context for implementers.
Where this is the case sections are marked as "Informative" to clarify.

Non-mandatory requirements or recommendations to implementers are
indicated using word "shall" or "should".

The word "may" expresses a permissible practice for action. It does
not express a requirement.

Mandatory functionality is achieved by the implementation of the relevant
parts of S-100 and S-98. In all cases the content of the published,
operational IHO product specifications are also normative.

== Background - System Concepts and Limitations

=== The concepts of ENC, ENDS and System Database

The Electronic Navigational Data Service and System Database concepts
include multiple products for use in navigation systems. They were
introduced in IMO MSC 530(106) and update the previous concept of
SENC defined in IMO MSC.232(82).

IMO MSC.530(106)/Rev.1 defines Electronic Navigational Chart (ENC),
Electronic Navigational Data Service (ENDS), and System Database as
follows:

____
3.2 Electronic Navigational Chart (ENC) means the database, standardized
as to content, structure and format, issued for use with ECDIS by
or on the authority of a Government, authorized hydrographic office
or other relevant government institution, and conforming to IHO standards.
The ENC contains all the nautical chart information necessary for
safe navigation.

3.3 Electronic Navigational Data Service (ENDS) means a special-purpose
database, compiled from nautical chart and nautical publication data,
standardized as to content, structure and format, issued for use with
ECDIS by or on the authority of a Government, authorized hydrographic
office or other relevant government institution, and conforming to
IHO standards; and, which is designed to meet the requirement of marine
navigation and the nautical chart and nautical publications carriage
requirements in SOLAS regulations V/19 and V/27. The navigational
base layer of ENDS is the electronic navigational chart.

3.4 System Database means a database, in the manufacturer's internal
ECDIS format, resulting from the lossless transformation of the ENDS
contents and its updates. It is this database that is accessed by
ECDIS for the display generation and other navigational functions,
and is equivalent to up-to-date ENDS.
____

The System Database is compiled from one or more S-100-based products
and/or S-57 based products.

[[sec_4.2]]
=== ECDIS concept, limitations, and challenges

IMO MSC 530(106)/Rev.1 also defines Electronic Chart Display and Information
System (ECDIS):

____
3.1 Electronic Chart Display and Information System (ECDIS) means
a navigation information system which with adequate backup arrangements
can be accepted as complying with the up-to-date nautical chart and
nautical publications required by SOLAS regulations V/19 and V/27,
by displaying selected information from a system database with positional
information from navigation sensors to assist the mariner in route
planning and route monitoring and, if required, display additional
navigation-related information.
____

The following list explains more of the ECDIS concept in detail and
provides information about certain limitations.

. ENC is an integral part of ECDIS and therefore is defined as the
base layer for the portrayal harmonisation framework. Additional layers
are classified as two main types, additional information to that of
the ENC or enhanced information to that of the ENC. Additional information
is information that is not contained in the ENC, while enhanced information
are layers that contain improved, detailed or higher resolution information
than the ENC.
. ECDIS, used together with official data, [is] accepted as complying
with the up-to-date nautical chart and nautical publications carriage
requirement required by regulations V/19 and V/17 of the 1974 SOLAS
Convention amended in 2009. Electronic chart systems not meeting these
ECDIS specifications of IHO and IMO, or ECDIS using non-official data,
are known as ECS (Electronic Chart Systems).
. Chart information may be used in conjunction with a radar overlay
on ECDIS. Tracked radar targets and targets reported by AIS
(Automatic Identification System) can be integrated into the ECDIS
display, as well as other navigational information which may be added
to the ECDIS display. With the advent of S-100, additional types of
data may also be occasionally added to the ECDIS display, especially
high-density bathymetry, surface current and water levels data or
predictions, maritime safety information (MSI), and under keel clearance
area data.
. Colours and symbols defined in the S-101 portrayal catalogue are
conceptually based on the symbology of conventional paper charts.
However, due to the special conditions of the ECDIS chart display
as a computer-generated image, the ECDIS presentation of ENC data
may differ from the appearance of a conventional paper chart, especially
when simplified portrayal mode is used. There may be considerable
differences in symbology in shape, colour and size, and in the placement
of text in particular.
. ECDIS combines chart and real-time navigational positioning information.
Modern navigation systems (i.e. GNSS) may offer a more accurate positioning
than was available to position some of the surveys from which the
digital chart data ENC was derived. Further, other products may not
be encoded to the same accuracy or precision as ENC data or ship's
positioning, therefore there is a potentially greater reliance on
metadata covering data quality and precision in a digital navigation
context
. The display categories specified in the IMO Performance Standards
and the IHO priorities of the various types of chart information
(alerts, updates, mariner's and non official chart data, etc.) are
applied to features by the display plane and drawing order assignments
in individual portrayal catalogues. The drawing order may be modified
if interoperability is activated.
. In the initial period of S-100 roll-out, S-100 compatible ECDIS
will be "dual-fuel" in that they will have both S-57 and S-101 ENCs
(see: <<sec_18>>). It is possible that there will be situations where
the navigation screen will display both S-57 and S-101 ENCs. The user
experience aspects of such situations are discussed in <<sec_18>>.

The versatility of ECDIS poses several challenges for ECDIS display
design. These challenges are discussed below.

The diversity of information displayed on an ECDIS may include:

* physical chart information, for example, coastline, depth contours,
buoys;
* traffic routeing; specified areas; cautions; etc.;
* supplementary HO information from light list, etc.;
* mariner's notes; additional local chart information; manufacturer's
information;
* chartwork such as planned route; electronic bearing lines and range
rings; etc.;
* own ship's position and velocity vector; ship's head and rate of
turn; past track;
* fix accuracy, or position check from secondary positioning system;
* possibly, ship handling options, based on ship's characteristics,
alphanumeric navigation information (ship's latitude, longitude, heading,
course, etc.);
* information from radar and other sensors;
* information from AIS;
* navigational indications and alerts generated by ECDIS;
* possibly, telemetered information from shore authorities
(traffic, real-time tides etc.);
* possibly, ice information;
* reminders (for example, time to contact pilot station);
* possibly, messages from other displays.

The flexibility of portrayal may include:

* displaying/removing various types of chart and non-chart information,
* selecting standard chart display or a thinned out display, and either
paper chart symbols or simplified symbols,
* using cursor interrogation for further detail,
* overlaying/removing radar video or radar target information
(in order to: confirm ship's positioning; aid radar interpretation;
show the entire navigation situation on one screen),
* overlaying/removing various other sensor information, or information
telemetered from shore,
* changing the scale or orientation of the display,
* selecting true motion or relative motion,
* changing screen layout with windowed displays, text information
in the margins, etc.,
* possibility of pull-down menus and other operator interaction devices
being alongside the operational navigation display and so interacting
with it,
* giving navigation and chart warnings such as "too close approach
to safety contour"; "about to enter prohibited area"; "overscale display";
"more detailed (larger scale) data available"; etc.,
* possibly, a diagrammatic representation of a computer evaluation
of grounding danger,
* possibly, a diagrammatic representation of the immediate vicinity
of the ship to aid in close quarters manoeuvring,

==== Depth Related Functionality

S-100 ECDIS allows water levels to be automatically adjusted using
an interoperable combination of S-101, S-102 and S-104 data, both
for monitoring and planning purposes. This is described fully in <<annexD>>
of this document.



=== Integrated Navigation System (INS) concept, limitations and challenges

The concept of an Integrated Navigation System (INS) is outlined in
the IMO Performance Standards MSC 252(83). INS workstations have multifunctional
displays providing at least route monitoring and collision avoidance
functions, and may provide manual or automatic navigation control
functions. In addition to these functions, an INS generally also provide
route planning, navigation control data and status, and alert management
functions. INS integrate sources, data, and displays into one navigation
system. An INS may consist of multiple task stations.

Since the concept of ECDIS is included in the INS concept, the principle
described in <<sec_6.1.1>> of having ENC as the base layer applies
- but in the context of an INS it applies to components playing the
role of an ECDIS. Components playing other roles will generally use
ENC or similar data, but this may depend on function and task.

The considerations related to portrayal that are in addition to the
requirements already embedded in the INS standards are outlined below:

. An INS may substitute under some carriage requirements for certain
navigational equipment. The INS is required to fulfil the requirements
for the systems it replaces. For example, an INS component used for
the tasks of route monitoring and route planning must meet the requirements
for an ECDIS, which are described in IMO MSC 530(106). This means
that the portrayal and user interaction considerations for an ECDIS
described in 4.2 apply to the workstation playing the role of an ECDIS.
. All tasks of an INS should use the same electronic chart data and
other S-100 navigational databases such as routes, maps, and tide
information.

IMO Performance Standards state that for each task it is used for,
the INS should fulfil the relevant modules of the performance standards
for standalone equipment for the task. An INS display being used for
route monitoring will be subject to the ECDIS performance standards,
and therefore the relevant INS display will have largely the same
limitations and challenges described in <<sec_4.2>>. The potential
availability of other workstations in an INS allows manufacturers
somewhat more flexibility in designing solutions, but this is limited
by human factors constraints related to compatibility and divided
attention.

Given the complexity of the issues and the necessity for compatibility,
this document does not distinguish between INS and ECDIS displays
for the purpose of harmonised portrayal. If the data products are
shown on the same screen, the same rules apply for INS and ECDIS displays,
and the treatment should be the same for INS as for ECDIS. If the
data products are on different INS screens, the treatment should be
compatible in the sense of the guidelines in IMO MSC.1/Circ.1609.

== User Interface Design

=== General principles

The guidelines in IMO MSC.1/Circ.1609 (Guidelines for the Standardization
of User Interface Design for Navigational Equipment) apply to the
design of user interfaces for navigation systems such as ECDIS and
INS. The general principles are described in MSC.1/Circ.1609 and are
summarised in S-100 Part 16A.

== Data Layers

=== Data products and information layers

[[sec_6.1.1]]
==== Basic product specifications and layers

Navigation displays such as the ECDIS main screen *must* be able to
process and display at least the following data products:

* S-101 ENC data as the base layer, alongside S-57 ENC data during
the transition period;
* S-102 Bathymetric Surface, only for Enhanced Safety Contour and
Water Level Adjustment (<<annexD>>);
* S-104 Water Level information for Surface Navigation, only for Water
Level Adjustment (<<annexD>>);
* S-111 Surface Currents, additional requirements apply (<<sec_13.1>>
and <<annexG>>);
* S-124 Navigational Warnings, additional requirements also apply
(<<sec_12.12>>);
* S-128 Catalogue of Nautical Products, only within Update Status
Reports (<<annexC>>) and graphical indexes (<<sec_12.4>>)
* S-129 Under Keel Clearance Management;

With the exception of the ENC layer, which must be permanently on,
the mariner must be able to switch the graphical display of S-111,
S-124, S-129 on and off. Graphical display of S-101 is defined in
<<annexE>>. Additional requirements for the graphical display of S-111,
S-124 and S-129 are contained in 12.2.

==== Projected Data

ECDIS must support the import of data products using unprojected geographic
latitude and longitude values. Additionally, ECDIS must support the
import of S-102 and S-104 data products using coordinates which are
projected using either UTM or UPS projections. Formulas for conversion
of such coordinates back to unprojected latitude and longitude values
are contained in <<annexH>> of this document.

==== Other data products

The intention is that in future editions of this document, when operational
product specifications are published by IHO, navigation displays such
as the ECDIS main screen will allow the mariner to process the following
data products

* S-122 Marine Protected Areas;
* S-123 Marine Radio Services;
* S-125 Marine Aids to Navigation;
* S-127 Marine Traffic Management;
* S-131 Marine Harbour Infrastructure;
* WMO S-411 Ice Information;
* WMO S-412 Weather and Wave Hazards;

=== Mitigation of data overload

To prevent the simultaneous presentation of multiple data layers from
cluttering the presentation and hiding critical information, the ECDIS
shall implement good practice in user interface design, including
the applicable IMO requirements (MSC.191(79), MSC.1/Circ1609),
see also <<sec_8>>.

Detection of and response to possible data overload should be guided
by the role a particular system is playing at the moment
(e.g., a display being used for planning may be able to treat potential
overloading in a laxer manner than navigation displays being used
for route monitoring and collision avoidance).

== Portrayal Process, Catalogue Elements, and Alerting

This section provides a brief, informative summary of the S-100 portrayal
process, the main elements of Portrayal Catalogues, and the alert
model. More details about the process and definitions of Portrayal
Catalogue elements and the alerting model are available in S-100 Parts
9 and 9a.

Later sections of this document describe how the portrayal elements
should be used in an ECDIS implementation.

=== Overview of the portrayal process

The system has feature data within its internal database that needs
to be portrayed. The System Portrayal Engine transforms the feature
data into drawing instructions according to the portrayal rules defined
in the Portrayal Catalogue. The drawing instructions are intermediate
data used by the rendering engine to produce the portrayal output.
Drawing instructions include such things as references to symbol definitions,
priority and filtering information. The symbol definitions contain
the details of all graphical elements used for the portrayal.
The drawing instructions are processed by the rendering engine to
produce the final display according to the output device.

S-100 describes two different portrayal mechanisms, one based on XSLT
templates and the other based on the scripting capability described
in S-100 Part 13. The basic portrayal process is the same for both,
and is described in S-100 Part 9 and 9a.

When interoperability is activated and there is an interoperable product
loaded to the display, either feature data or drawing instructions
(depending on the implementation architecture) are further filtered
and/or have their priorities adjusted as specified in the interoperability
catalogue. Interoperability processing is described in S-100 Part
16 and in Annexes A and B of this specification (Note that such interoperability
is not operational in this edition of S-98).

=== Elements of S-100 Portrayal

Much of the content of this section is included for information as
it is described definitively in S-100 Part 9 and Part 9a.

==== Pixmaps

Pixmaps can be used for defining pattern fills for areas that are
not sufficiently described to be symbolised, or for which no symbol
exists in the IHO Geospatial Information (GI) Registry.

==== Colour coding scheme

The Portrayal Catalogue uses a colour scheme, which classifies colours
by their usage. Each colour usage is represented by a colour token.
Each colour token corresponds to a colour definition given in CIE
and/or sRGB coordinates in one of a set of colours; each set is intended
for a different bridge lighting condition. Each such set of colours
is referred to as a "palette" and is generally identified by a descriptive
name, such as "Day", "Dusk" and "Night". A particular colour token
is often assigned different CIE/sRGB coordinates in different palettes
(especially day/night/dusk palettes).

A "colour profile", as the term is used in S-100, is a collection
of tokens within a single XML file. An ECDIS makes palettes for day,
night, and dusk conditions available on the system
(MSC 530(106) / A10.4.

Symbols, fill styles and line styles refer to the colour tokens as
part of the symbol definition.

==== Symbols

The Portrayal Catalogue provides a set of symbols. These symbols are
encoded as SVG files which conform to the S-100 SVG profile

==== Area fills

The Portrayal Catalogue offers various ways to fill areas. They can
be filled with an opaque colour; with a colour shown with some transparency;
or with a pattern of symbols (fill pattern) or with a centred symbol.
Fill patterns and centred symbols are a solution for the symbolization
of areas in special situations. Fill patterns or centred area symbols
may be used to symbolize the case when the entire display window lies
within an area (the area boundary is not visible).

Area boundaries should not be visible on the edge of the display window
when the display window is enclosed by an area. However, if the boundary
is actually on the edge of the display window, it should be visible.

==== Line styles

The Portrayal Catalogue uses two types of line styles: simple line
styles and complex line styles. Simple line styles are solid, dashed
or dotted lines with varying colour and thickness
(width or stroke width). Complex (or "composite") line styles are
composed of repeating line patterns.

Simple line styles are generally described by continuity, width, and
colour. The full specification of a simple line style may also include
other elements such as dash interval, cap and join types
(see S-100 clauses 9-12.4 and 9a-11.2.2.3), defaults for which may
be set in the Portrayal Catalogue. Complex line styles consist of
additional elements, described in S-100 9-12.4 and 9a-11.2.2.3.

Complex linestyles may be one-sided (symbols, text, etc., which are
part of the line extend to only one side of the line) or two-sided
(symbols, text, etc. extend on both sides of the line).

==== Portrayal of Shared Edges.

Shared edges portrayed with dash patterns may be presented incorrectly
to the mariner when the ECDIS draws the edge in both directions.
This issue can occur along the shared edges of features which abut,
such as restricted areas or anchorages where adjacent edges are drawn
in opposite directions.

Rendering the dash pattern in both directions can alter the pattern
from what is intended, and in some cases may result in a solid line.

In the figure below, note the edges under the green highlight:

[%unnumbered]
====
.Incorrect presentation
image::img01.emf[]

.Correct presentation
image::img02.emf[]
====

This issue can also affect complex line styles, for example:

[%unnumbered]
====
.Incorrect presentation
image::img03.emf[]

.Correct presentation
image::img04.emf[]
====

==== Text

S-101 and other Product Specifications may utilize a cartographic
feature called *TextPlacement* that is used in association with a
feature to optimise placement of labels (usually, either feature name
or light characteristic description string).

There are three types of text instructions possible in portrayal catalogues:

* Text relative to a point;
* Text that will be drawn along a line; and
* Text placed relative to an area uses a local coordinate reference
system. Note that this can cause the text to be drawn at multiple
locations.

However, explicit cartographic placement along curves or relative
to area/local CRS cannot be explicitly encoded in S-101 datasets,
though it can be encoded in portrayal rules in a Portrayal Catalogue
(S-100 Part 9a, clause 9a-11.2).

==== Style sheets

Cascading Style Sheets (CSS) files are used to provide different sets
of stroke and fill style instructions to be applied to symbols.
This mechanism allows changing colours and line weights used in the
symbols by swapping CSS files according to the desired colour scheme.

In principle, any style attribute can be set in a CSS file, but the
CSS files in IHO Portrayal Catalogues are restricted by S-100 9-B-4.4
to only two use cases: setting stroke and fill colours, altering the
visibility of elements which are not normally displayed
(for example, the pivot point).

==== Display planes

Display planes are used to split the output of the portrayal functions
into mutually exclusive lists. An example of this is the separation
of chart information drawn under a radar image and chart information
drawn over a radar image.

==== Display (drawing) priorities

Display priorities are also called "drawing priorities" in S-100 Parts
9 and 9a.

Display priorities control the order in which the output of the portrayal
functions is processed by the rendering engine within a display plane.
Priorities with smaller numerical values will be processed first.

The display priority applies irrespective of whether a feature is
a point, curve or surface. If the display priority is equal among
features, curve features have to be drawn on top of surface features
whereas point features are drawn on top of both. If the display priority
is still equal among features of the same type of geometry
(curve, surface or point) the given sequence in the data structure
of the System Database, or some other neutral criterion, should be
used for a decision as to which feature is drawn on top.

==== Viewing groups

The viewing group controls the content of the display. It provides
an on/off switch in the Portrayal Catalogue for all drawing instructions
assigned to the corresponding viewing group.

==== Viewing group layers

A viewing group layer defines a collection of viewing groups whose
visibility can be simultaneously toggled on/off by an application.

==== Display modes

A display mode defines a collection of viewing group layers which
can be simultaneously toggled on/off by an application.

==== Rules

A portrayal rule describes the transformation of feature data into
drawing instructions.

==== Context

The context is a set of parameters whose values alter the portrayal
processing. These parameters can be used to provide contextual information
to the execution of rules in portrayal processing. Examples are settings
of depth values for the safety depth, shallow and deep contours.

==== Validity times

Drawing instructions can be designated as being valid only during
a specified interval, which may be open-ended at either beginning
or end, or a single time point (with beginning and end the same).
Intervals may be specified in terms of date, time (of day), or date-time
endpoints.

The start and end instants are defined by their date/time component
of the smallest granularity. For example, if the end instant is specified
a date without a time of day, and the interval is "right-closed",
the end instant is midnight at the end of the specified day
(240000 in ISO 8601 terms). This is consistent with the S-100 treatment
of _dateStart_ and _dateEnd_ attributes (see S-100 Part 3 clause 3-8-3
(Interpretation of models of time intervals and period), but note
that the open/closed nature of the interval affects the interpretation
for Part 9 time intervals — if the same interval is specified as "right-open"
the start time point is midnight at the beginning of the specified
day (000000 in ISO 8601 terms).

=== Alerts

The Alerts Catalogue is a component of the Portrayal Catalogue;
it describes each alert event along with its associated message(s)
and highlighting rules.

The alerting model allows product developers to associate alerts with
features (optionally satisfying specified conditions on attribute
values) by encoding rules in the Portrayal Catalogue.

Alerts are associated with drawing instructions output by the portrayal,
and are triggered when the vessel route (either actual track, during
route monitoring, or planned, during route planning) intersects the
geometry (which may be restricted or augmented) of a feature.
The events are alarms, alerts, warnings, cautions, or indications
as described in IMO MSC.252(83).

[[sec_8]]
== Interoperability

Ensuring visual interoperability in the presence of simultaneously
displayed products is an important aspect of user interfaces for navigation
screens. IHO Publication S-98 (Data Product Interoperability in S-100
Navigation Systems) specifies the structure of an interoperability
catalogue to be used for ECDIS and INS. S-98 will provide, as a minimum
for S-100 ECDIS, two levels of interoperability allowing data layers
in different products to be interleaved or substituted within the
display. An interoperability catalogue is currently unpublished by
IHO and there is no current requirement for its implementation in
ECDIS. Other mechanisms for interoperability between product specifications
exist and are defined in this document.

When published by the IHO an Interoperability Catalogue will provide
a normative Interoperability Catalogue for S-100 ECDIS and the published
IHO product specifications. Therefore, a detailed requirement for
its implementation will be contained in a future edition of this document.

It is intended, in a future edition of this document, to also provide
user interface requirements for end user control of interoperability.

S-98 itself also permits extensions, substitutes and customizations
provided the minimum functions provided by the IHO Catalogue are maintained
and interoperability is not degraded (S-98 clauses 12.1.1-12.1.3).

[[sec_9]]
== Display Organisation and Operation

[[sec_9.1]]
=== Display of non-S-100 information

This section describes the display of information that is not from
official S-100-based data products, S-57, radar, or AIS.

[[sec_9.1.1]]
==== Distinguishing between official S-100 data and additional data

IMO Performance Standards (MSC.530(106)/Rev.1 section 1.5) states
that ECDIS should enable the mariner to execute all route planning,
route monitoring, and positioning and sections 3.3-3.4 mean that the
ENDS and System Database may contain information from nautical publications
as well as ENCs. This specification requires that ECDIS must distinguish
between official data and such additional data from users (mariners)
and manufacturers. The colour and symbol usage for mariners' and manufacturers'
data in the IHO GI Registry and the Portrayal Catalogues for S-100
data products are designed to implement this while ensuring the display
remains clear and uncluttered.

The official status of data delivered to the ECDIS is defined by the
value of a role. This is encoded in the ST field of the X.509 certificate
referenced in the mandatory digital signature accompanying content
in the exchange set catalogue. Digital signatures are mandatory for
any data imported into the ECDIS, whether official or not. The mandatory
fields within every authenticating certificate are defined as:

* *C* (Country) = ISO Country Code of state making request
* *ST* (State or Province) = A code reflecting the role of the signing
entity (below)
* *O* (Organisation) = member state organisation name (text) or other
organisation name
* *CN* (Common Name) = IHO data producer code integer and alpha code
(as part of a colon separated MRN), e.g. *urn:mrn:iho:aa00:01810*
or *urn:mrn:iho:GB00:00540*. For digitally signed datasets, the CN
data producer integer and alpha code elements in the MRN of at least
one of the authenticating certificates must match those contained
in the dataset and its CATALOG.XML entry.

For ECDIS, the ST code holding the role determines whether a dataset
or supporting resource is non official or official. The following
codes are supported by the IHO data protection scheme:

* For S-100 datasets or supporting resources the following roles define
official data.

** *DATA_PRODUCER* Data Producers - producing data content for live
navigation under SOLAS. This data is "official"
** *DATA_AGGREGATOR* RENCs/Aggregators - validate, distribute and
(sometimes) digitally sign data on behalf of their members. These
organisations do not create data content but can sign data as "official"
* S-128 datasets used for ECDIS Update Status reports. These datasets
may also be authenticated by:

** *AGGREGATOR* S-128 producers - aggregate data together for the
purposes of running a service for end users. They create and digitally
sign S-128 datasets which support their service offering and the production
of update status reports
* Catalogues

** **SCHEME_ADMINISTRATOR** The Scheme Administrator, the IHO. Only
digitally signed catalogues with a certificate authenticated by the
scheme administrator may be loaded onto the ECDIS.

ST field values using the role *OTHER_DATA_PRODUCER* (or any other
value not included in the list above, or those not conforming to the
CN MRN format above) represent data or catalogue content which is
non official.

[[sec_9.1.2]]
==== Supplemental display items

The following information must be shown on demand

* Positional data and time;
* Legend (See <<sec_9.1.5>>);
* Feature description and associated attributes
(result of "cursor query") in human readable language;
* textual information from ENC, for example, dataset name, compilation
date, date of issue;
* Record of updates for all data products;
* ECDIS Chart 1;
* Black adjust symbol for contrast adjustment;
* Colour differentiation diagram (available from IHO S-164);
* List of categories which are removed from Standard Display;
* Dataset Edition and update numbers (if applicable) of S-101 and
other Products in use;
* Edition numbers of Presentation Libraries in use;
* Edition numbers of feature and portrayal catalogues in use.

[[sec_9.1.3]]
==== Navigational Warning functions

Specification for the display of navigational warnings are contained
in section <<sec_12.12>>

[[sec_9.1.4]]
==== Units

The units of height and depth listed below must be permanently indicated.

Equivalent values using other units may also be shown:

Depth: Metres and decimetres.

Height: Metres.

Additionally, the units listed below must be available, on demand
and indicated in the display legend.

Position: Latitude and longitude in degrees, minutes and decimal minutes.

Distance: Nautical miles and decimal miles; or metres.

Speed: Knots and decimal knots.

[[sec_9.1.5]]
==== Legend

A standard legend of general information relating to the area displayed,
applicable to the position selected by the mariner, must be shown
on a graphic or text display. See <<sec_12.11.1>> for detail.

=== Priority of information [Informative footnote:[Much of the described functionality in this clause is effected by implementation of the S-100 portrayal catalogues. When the S-100 portrayal mechanism is implemented the layers defined will implement the mandatory IMO layers. The description of those layers here is, thus, informative.]]

==== Priority layers

The IMO Performance Standard divides System Database information into
three categories that determine what data is to be on the display:
Display Base (always present on the display); Standard Display
(the default display); and all other information (displayed on demand).
(MSC.530(106)/Rev.1, Appendix 2).

There are 9 basic priority layers for the drawing sequence of the
data on the display, ordered from higher to lower priorities in the
list below:

. ECDIS visual alerts/indications (for example caution, overscale);
. Official-data: Points/Curves and Surfaces + official updates;
. Notices to Mariners, manual input and Navigational Warnings;
. Official-caution (ENC and other cautions);
. Official-colour-fill area data;
. Official on demand data (for example, water levels, surface currents,
under keel clearance);
. Radar and AIS information;
. Mariner's data: Points/lines and areas;
. Mariner's colour-fill area data.

This list is not intended to indicate a drawing sequence, but to specify
that the information content of category n+1 must not obscure the
information content of category n, or any higher-priority category
(n-1 etc.).

==== Radar priority

Radar priority for a given display plane is described by the _order_
attribute within the Portrayal Catalogue.

The _RadarOverlay_ Portrayal Catalogue context parameters must be
updated whenever the radar image is toggled on or off.

When present, the radar image should be written over Portrayal Catalogue
display planes with a negative _order_ attribute; and below display
planes with a positive _order_ attribute.

In order to meet the requirements of IMO MSC.530(106)/Rev.1 section
11.4.18 to adjust the ship's position, the ECDIS may incorporate the
capability of temporarily changing the radar image priority during
the adjustment.

=== Displaying ECDIS updates

The strategy for displaying ECDIS updates is derived from the IMO
Performance Standard MSC.530(106)/Rev.1. The citations below are to
sections in that Standard. The quoted requirements are mandatory and
must be implemented by the ECDIS.

.MSC.530(106)/Rev.1 4.4
____
ECDIS should be capable of accepting official updates to the ENDS
provided in conformity with IHO standards. These updates must be automatically
applied to the system database. By whatever means updates are received,
the implementation procedure must not interfere with the display in
use.
____

.MSC.530(106)/Rev.1 4.5
____
ECDIS should also be capable of accepting updates to the ENDS data
entered manually with simple means for verification prior to the final
acceptance of the data. They must be distinguishable on the display
from ENDS information and its official updates and not affect display
legibility. (The requirements for Manual Updates are given in
<<sec_12.12.1;and!sec_20.4.4>>.)
____

.MSC.530(106)/Rev.1 4.7
____
ECDIS should allow the mariner to display updates in order to review
their contents and to ascertain that they have been included in the
system database. (The requirements for displaying updates for review
are given in <<sec_12.12.4>>.).
____

=== Display functions

The Portrayal Catalogue defines a number of Independent Mariner Selections
and Context Parameters. These must all be implemented and exposed
to the end user through the user interface. Many of these may have
already been implemented for existing (S-57) ECDIS, for example Four
Depth Shades, Contour Labels and viewing of Accuracy patterns. Implementation
should therefore be harmonised to provide a harmonised user interface.

== General Rules for Symbols and Text

=== Symbol Specifications

All symbols are specified in the Portrayal Catalogue for the respective
Product Specifications and are defined according to S-100 Part 9
appendix B.

Some feature types do not have a symbol. Such "no symbol" features
may be picked up by cursor interrogation of the area.

[[sec_10.2]]
=== Reproduction of lines, symbols and text

==== Introduction

In a navigation system the viewing distance will be about 70 cm for
route planning, but experience to date indicates that the viewing
distance for important features during route monitoring may be several
metres.

Human factors experts recommend that symbols and characters subtend
20 arc minutes at the observer's eye. (For example, a symbol viewed
from 70 cm for route planning should be about 4mm in size, 1.5 times
the size of a normal chart symbol. Two times chart size is a good
general rule.) Symbols and characters important for route monitoring
may have to be significantly bigger.

For clear representation, symbols require a minimum number of screen
units (pixels), depending on their complexity. A simple chart symbol
of height 4mm should extend at least 13 pixels for a screen that just
meets the current minimum standards for chart display size and resolution.

The minimum resolution is defined by IEC 61174 and/or IEC 62288.

==== Minimum Requirement for size and resolution

The minimum sizes for all symbols must be as defined in the Portrayal
Catalogue.

Enough "picture units" (pixels) must be used to draw small features
and symbols clearly and allow viewers to distinguish similar symbols.
Symbols must therefore always be drawn with at least the same number
of pixels as are required to draw the symbol at the size defined in
the Portrayal Catalogue for the minimum resolution and minimum chart
display area.

NOTE: (informative): This requirement means the minimum height in
pixels of a symbol is: (symbol height in stem:["unitsml(mm)"]) divided
by the "pixel size" for the minimum size chart display.

The CHKSYM01 symbol may be used for comparison; this symbol must measure
stem:[5 "unitsml(mm)" xx 5 "unitsml(mm)"] when displayed at its nominal
size (that is, scaled to 100%), within the tolerance specified by
the IEC testing standard (recommended tolerance: 1 physical pixel
width in each of the X and Y dimensions).

Since the CHKSYM01 symbol is quite small for the purpose of on-site
system configuration by ordinary users, manufacturers may use an enlarged
version or an equivalent method for that purpose.

==== Zooming

When the display scale is enlarged by zooming in, it must be possible
to hold symbol size constant. The same applies to text. Symbol and
text size must never be decreased when zooming out.

[[sec_10.3]]
=== Common text and information attributes

Several Product Specifications use common structures for feature names
(*featureName*) and information attributes (*information/text*)

To support dataset portrayal using languages other than English, the
ECDIS must expose to the mariner two context parameters;

**National Language** (applies for S-57 ENC only)

This Boolean value should be used to show the national attribute values
present in S-57 ENC data.

*Preferred Language (does not apply to S-57 ENC)*

This context parameter contains an ordered list 0 or more preferred
language values. The following procedure must be used when displaying
the "feature name" attributes.

Feature names Attribute "feature name" (featureName) is a complex
attribute consisting of the mandatory sub-attribute "name"
(the actual name of the feature) and sub-attributes "language" and
"name usage". The sub-attribute "name usage" is an enumeration indicating
which indicates if a name should be displayed when preferred language
is not selected (1), or may be displayed when preferred language is
selected (2).

If selected, feature name values must be displayed based on the user
defined language preference values, the first value contained in the
context parameter list should be displayed. If no feature names correspond
to the language preferences, then the feature name with name
usage = 1 must be displayed.

In the following example Island Group feature below when the user
has set a language preferences as follows;

. **sms**
. **smn**

Then the name Lâu'ŋŋsuõllu is displayed, because it contains a name
with the language "sms", the highest priority in the language preference
list. With no language preference set, the name "Turvesaaret" must
be displayed because it has nameUsage = 1.

[source%unnumbered]
----
IslandGroup
    featureName
        language: fin
        name: Turvesaaret
        nameUsage: 1
    featureName
        language: smn
        name: Lavŋesuolluuh
        nameUsage: 2
    featureName
        language: sms
        name: Lâu'ŋŋsuõllu
        nameUsage: 2
----

== Text and Graphics

=== Arrangement of viewing group layers.

Viewing group layers should be grouped together when one (the child)
is wholly included (a subset) of another (the parent). The table below
shows an example of grouping of "Other text" viewing group layers.

[cols="127,244",options="header,unnumbered"]
|===
h| Viewing Group Layer h| Name of Viewing group layer in the ECDIS

| 1    | Important text
| 2    | Other Text
| 2.1  | Names
| 2.2  | Light description
| 2.3  | All other
|===

== Display Elements

This section describes additional display elements and special symbols
and considerations for ENC data, including chart furniture, contours,
mariner's features, IMO-required elements, and presentation of updates.

Cursor pick reports and information displays in off-graphic panels
are described in <<sec_15>>.

=== Elements related to data and display scales

ENC Features are contained within DataCoverage features and aggregated
into datasets. Each DataCoverage feature contains attributes
_optimumDisplayScale_, _minimumDisplayScale_ and _maximumDisplayScale_.
The algorithm which must be used for the selection and rendering of
ENC features is contained in <<annexE>> - Dataset Loading and Display
(Rendering) Algorithms

[[sec_12.1.1]]
==== ENC scale

The term "scale" is used to describe either:

* Display Scale, or (equivalently) Mariner Selected Viewing Scale
(MSVS)
* The scale of the source data used to compile the ENC.
* Data Scale (the values used for the DataCoverage attributes
_minimumDisplayScale_, _maximumDisplayScale_, _optimumDisplayScale_.
This may not be the same as the scale of the source data used to compile
the ENC. These values define the range of scales at which ENC coverage
is intended to be displayed.

The S-101 ENC values used for the Data Scale attributes _minimumDisplayScale_
and _optimumDisplayScale_ are fixed, and taken from the table below:

._minimumDisplayScale_ and _optimumDisplayScale_ values
[cols="^",options="unnumbered"]
|===
h| Scale

| NULL
| 1:10,000,000
| 1:3,500,000
| 1:1,500,000
| 1:700,000
| 1:350,000
| 1:180,000
| 1:90,000
| 1:45,000
| 1:22,000
| 1:12,000
| 1:8,000
| 1:4,000
| 1:3,000
| 1:2,000
| 1:1,000
|===

The ordering and selection of *Data Coverage* features by Data Scale,
prior to S-101 portrayal is defined fully in <<annexE>> - Dataset
Loading and Display (Rendering) Algorithms.

[[sec_12.2]]
=== Display of Non-ENC data layers

Non-ENC data layers may not contain DataCoverage features. Where the
dataset discovery metadata entries for non-ENC datasets contains values
*_minimumDisplayScale_* and *_maximumDisplayScale_* these values define
the range of display scales for which a non-ENC dataset is intended
to be displayed.

Where the dataset discovery metadata do not contain values for
minimumDisplayScale and maximumDisplayScale the ECDIS must display
the dataset by default but may drop display in the interests of system
resources.

There is no algorithm defined for the selection and rendering of non-ENC
data.

[[sec_12.3]]
=== Overscale

Data is overscale when displayed at a scale larger than its *_optimumDisplayScale_*.

[discrete]
==== Overscale Indication

The overscale indication is intended to remind the mariner that chart
errors are magnified as the display scale is increased.
A stem:[1 "unitsml(mm)"] error at a display scale of 1:20,000 becomes
a stem:[1.3 "unitsml(mm)"] error at a display scale of 1:15,000 and
a stem:[2 "unitsml(mm)"] error at 1:10,000. The overscale indication
is specific to ENC portrayal.

The overscale factor must be calculated as:

[denominator of the
*_optimumDisplayScale_* ] / [denominator of the mariner's 
selected viewing scale]

and expressed as, for example "X1.3", or "X2"
(using the figures in the example above.)

When the overscale factor is > 1 it must be indicated on the same
screen as the chart display, and treated as display base. Use colour
SCLBR.

This overscale indication is required by IMO Performance Standards
(MSC.530(106)/Rev.1) and must be shown whenever the overscale factor
at the vessel location (when the vessel is on screen), or at the centre
of the screen (when the vessel is not on screen), exceeds 1.

==== Chart Scale boundary

Where the *_optimumDisplayScale_* of the ENC data available changes
the ECDIS should warn the mariner of upcoming ENC scale change. Only
the major changes in *_optimumDisplayScale_* resulting from the scale
jumping more than three steps in *_optimumDisplayScale_* should be
shown. The steps are the defined scale bands in the display Loading
and rendering <<table_11>>.

The "chart scale boundaries", where the *_optimumDisplayScale_* of
the data changes by more than three steps, must be symbolised on the
ECDIS display by a solid 0.32mm wide line using colour token CHGRD.
Alternatively, linestyle SCLBDY51 may be used. The display priority
is 9; over-radar; standard display; viewing group 21030.

When scale boundaries of smaller scale *Data Coverage* areas overlap
larger scale *Data Coverage* areas, that portion of the scale boundary
which intersects the larger scale *Data Coverage* area should not
be visible.

==== Overscale Pattern

ECDIS displays all chart data at the same (mariner selected) viewing
scale. In order to avoid leaving parts of the display blank, the display
may be rendered using data from multiple datasets using the algorithm
defined in <<annexE>> - Dataset Loading and Display (Rendering) Algorithms.
These datasets may contain *Data Coverage* areas with different *_optimumDisplayScale*_.

The area fill OVERSC01 must be used to indicate *Data Coverage* areas
displayed larger than the *_maximumDisplayScale_*, when the area has
been selected for display by the ECDIS in order to avoid leaving that
portion of the display blank. These Data Coverage areas are those
selected after stage 3.b is reached in the SelectDataCoverages function
in <<annexE>> - Dataset Loading and Display (Rendering) Algorithms.

For example, an overscale situation arises when the ship approaches
a scale boundary from a larger to a smaller scale ENC, typically when
leaving harbour. In combining data from the large scale and the small
scale ENCs to generate a display at the larger scale, the ECDIS will
have "grossly enlarged" the small scale data.

In addition to drawing the scale boundaries, the "grossly overscale"
part of the display must be identified with area fill OVERSC01, as
illustrated in <<fig_1>>.

[[fig_1]]
.Illustration of overscale display
image::figure-01.jpeg["",499,255]

In this context, "grossly enlarged" and "grossly overscale" should
be taken to mean that the display scale is enlarged/overscale with
respect to the *_maximumDisplayScale_*. For example, at the left edge
of the display scale of 1/12,500 is larger than the *_maximumDisplayScale_*
of 1/50,000, and so the overscale pattern is required.

Note that in this situation the OVERSC01 area fill should only be
shown on the area compiled from the smaller scale ENC. If the area
from the larger scale ENC is also overscale, this should be indicated
only by the "overscale indication". The OVERSC01 area fill should
not be shown on the part of the display taken from the larger scale
ENC

For example if the display scale (MSVS) 1:3,500 is selected, the area
of *_optimumDisplayScale_* 1:12,500 would have an overscale indication
of X 3.6 but would have no OVERSC01 area fill.

==== Larger scale data available

As the mariner's display window moves and begins to cover an ENC that
is of a larger *_optimumDisplayScale_*, the ECDIS must indicate when
the ship's position enters the larger scale ENC, as required by
MSC.530(106)/Rev.1 6.1.2.

[[sec_12.4]]
=== Graphical indexes

==== Graphical indexes of ENCs

The system *must* be capable of displaying a graphical index of ENCs.

All datasets installed on the system must be included in the graphical
index.

Additionally:

* ENC Discovery metadata from Exchange Catalogue files in Exchange
Sets
* Installed S-128 datasets (data which may be available, but which
is not installed) may be used to generate ENC graphical index as long
as the graphical index distinguishes them from the datasets installed
on the system.

The description of dataset extents in S-101 ENC discovery metadata
in exchange catalogue files uses a fixed format, described in <<annexF>>.

It must be possible to individually select the display of the graphical
index entries for the installed S-57 and S-101 ENCs. The display of
each data product must be differentiated.

==== Graphical indexes of other S-100 products

The ECDIS must additionally implement a capability for displaying
graphical indexes of S-102 and S-104 data products, and may implement
a graphical index of other non-ENC data products

If the system displays graphical indexes for different products simultaneously
it must be possible to individually select the display of each supported
data product. The display of each supported data product shall be
differentiated.

[[sec_12.5]]
=== Limits of data

[[sec_12.5.1]]
==== ENC No data areas

The ECDIS must fill any areas in which there is no installed ENC coverage
using area pattern NODATA03, using colour token NODTA. These areas
are defined as no data areas.

The indication "**__No ENC Available__**" must be shown if the display
includes areas in which there are waters with no ENCs installed.

An indication that the mariner must refer to the official chart must
also be given whenever line style NONHODAT appears on the display,
or whenever the display is comprised of other than ENC data as specified
by <<sec_9.1.1>>.

[[sec_12.5.2]]
==== Limit of official S-101 data and non official S-101 data

The limit of official S-101 data on the graphical index defines the
limit of official ENC coverage. The definition of official data as
opposed to non official data is contained in <<sec_9.1.1>>.

The appearance of the "No data" colour (colour token NODTA) and NODATA03
area fill (see <<sec_12.5.1>>) will indicate the end of official data.

If non-official chart data is shown on the ECDIS display, its boundary
must be demarcated by the line style NONHODAT. Note that the NONHODAT
line style is a "one-sided" line and the boundary of the non official
data must be drawn according to S-101 rules to ensure that the diagonal
stroke of the line is on the non official data side of the line.
The non official data boundary indicated by the NONHODAT line style
serves to separate official ENC data from non official chart information.

==== Limits of other S-100 product data

For all other supported data products, it must be possible for the
mariner to be able to individually select for display the "no data"
areas and "non official data" boundaries. The display for each supported
data product must be differentiated.

For gridded data, the no-data area limits do not need to demarcate
areas within the grid extent which are covered by fill values.

NOTE: For some types of coverage products (for example gridded data),
no-data areas may be easily distinguished by the lack of portrayal.
Nevertheless, consistent treatment of products is required for the
convenience of the mariner - either this clause should be implemented
for all the non-ENC S-100 products, or for none of them.

=== Special ECDIS chart symbols to identify unsafe depths

The ECDIS highlights four concepts that are important for safe navigation.
These are the safety contour, depth shades, the safety depth and isolated
dangers. Depth shades, safety depth and isolated dangers are implemented
in the portrayal catalogue.

==== Safety Contour

The own-ship safety contour is double-coded by a thick line and a
prominent change in depth shade.

If the safety contour selected by the mariner is not available in
the System Database, the ECDIS must default to next deeper contour
and inform the mariner. If the ship moves onto a new chart, and the
safety contour previously in use is no longer available, the ECDIS
must again select the next deeper contour, and inform the mariner.

If the mariner does not select a safety contour, the value must default
to 30 metres.

=== Date-dependent features

There are a number of features within the Marine environment which
are seasonal, such as racing buoys. These features are only to be
displayed over a certain period, S-101 uses the complex attribute
_periodicDateRange_ with the sub attributes _dateStart_ and _dateEnd_
to indicate the periodic nature of the feature. Other features, such
as traffic separation schemes, use the complex attribute _fixedDateRange_
with the sub attributes _dateStart_ and _dateEnd_ to indicate their
introduction or removal. In order for the Mariner to receive important
changes to traffic separation schemes before the event, HOs are required
to provide updates or new editions containing the alterations at least
one month before they come into force. Any S-101 feature with one
of the above complex attributes must not be displayed outside its
effective dates unless requested by the Mariner.

==== Display of date-dependent features by mariner-selected date

To provide the Mariner with effective route planning capabilities
and for the look-ahead function during route monitoring ECDIS must
display date dependent chart data based on a Mariner selected date
or date range (start viewing date and end viewing date).

During route planning and monitoring the Mariner must be able to select
a date or date range to display all date dependent chart features.

[example]
A new traffic separation scheme is coming into effect on 01.01.2013,
it has been encoded by the ENC producer using the attribute _dateStart_.
The current date is 12.12.2012 and the Mariner is planning a route
that will cross this area over the effective start period.

In this case the ECDIS must be capable of providing the Mariner the
ability to set the date the vessel will be in the area
(e.g. 02.01.2013 in the above example) and the system should show
the new traffic scheme.

==== Indication of date adjustment

When viewing date or date range do not include the current date, the
mariner must be informed by a permanent indication on the chart display
that the date has been adjusted. The indication must begin with the
text "Display Not Real Time" and the selected date or date range must
be readily available.

The use of one of the following formats is recommended:

* Display Not Real Time - Display is based on date dd mmm yyyy
* Display Not Real Time - Display is based on viewing date range from
dd mmm yyyy to dd mmm yyyy

=== Decluttering the screen

To reduce screen clutter some features within ENC carry the attribute
_scaleMinimum_ to specify the smallest display scale at which they
are to be portrayed. At display scales smaller than _scaleMinimum_
the drawing instructions output from the portrayal engine must not
be drawn.

For example, the drawing instructions for a feature with a _scaleMinimum_
value of 49999, (indicating a display scale of 1:49,999), must not
be drawn on an ECDIS with a display scale of 1:50,000.

=== IMO presentation elements

In some cases, S-101 does not provide a symbology instruction in the
Portrayal Catalogue that specifies how to present a specific feature
on the ECDIS screen. The reason is that such a feature is not defined
as an S-101 feature type or it would be illogical to include it in
the Mariners' navigational feature types.

The following presentation instructions are therefore provided to
assist the manufacturer.

==== Scale bar and latitude scale

The IMO Performance Standards require an indication of scale and range
as part of the Display Base. The display scale determines which must
be used:

. Case 1: for display scales larger than 1/80,000: always display
the 1 Nautical Mile scale bar provided in the Portrayal Catalogue
. Case 2: for display scales at 1/80,000 or smaller: always display
the 10 Nautical Mile latitude scale provided in the Portrayal Catalogue.

The scale bar or latitude scale must always be drawn vertically at
the left side of the chart display, just clear of the border of the
display. The symbols and drawing parameters are described in <<table_1>>.

The placement must be 3mm in from the border of the display. The symbol
must be properly sized to represent 1 nautical mile at the scale of
the display (for Case 1) or 10 nautical miles at the scale of the
display (for Case 2).

[[table_1]]
.Scale bar presentation parameters
[cols="^.^,^.^,^.^,^.^,^.^,^.^"]
|===
h| Scale range h| Symbol h| Drawing priority h| Display plane h| Display category h| Viewing group

| 1:79999 and larger scale  | SCALEB10 .2+| 27 .2+| OverRadar .2+| Display Base .2+| 11030
| 1:80000 and smaller scale | SCALEB11
|===

[example]
For _display scales_ larger than 1/80,000
(for example, a scale of 1/50,000) draw symbol 'SCALEB10' on the left
side of the chart display, bottom justified and 3mm in from the border
of the display. Make sure the symbol should be sized to represent
1 nautical mile (1852 m) at the scale of the display.

[example]
For display scales of 1/80,000 or smaller (for example, 1/250,000)
use symbol 'SCALEB11', similarly located, and scaled to represent
10 miles at the scale of the display.

IEC define a requirement for indicating the location at which the
scale is calculated under certain circumstances.

==== North arrow

A north arrow must be provided as part of the Display Base according
to the IMO Performance Standard. The north arrow must always be shown
at the top left corner of the chart display, just clear of the scale
bar or latitude scale. Other requirements for the north arrow are
defined in IEC 61174.

The symbol 'NORTHAR1' must be used to indicate true north.
It must be placed in the top left corner of the chart display, on
the inner side of the scalebar. It must be rotated to true north if
the display is other than north up, and clear of the scalebar even
if the latter extends the full height of the display.

[[table_2]]
.North Arrow presentation parameters
[cols="25,17,21,21,17"]
|===
h| Symbol h| Drawing priority h| Display plane h| Display category h| Viewing group

| NORTHAR1 | 27 | OverRadar | Display Base | 11040
|===

==== Graticule

If the ECDIS shows a graticule (listed in "other information" in IMO
Performance Standards (MSC.530(106)/Rev.1)) the lines must use the
colour token CHBLK.

==== Display mode

The ECDIS manufacturer must provide the indication of display mode
required in the display base by IMO Performance Standards
(MSC.530(106)/Rev.1 Appendix 2).

==== Black level adjustment symbol

Unless the brightness and contrast controls of the monitor are properly
adjusted there is a danger that information may be lost from the chart
display, particularly at night. Symbol BLKADJ is provided for checking
correct adjustment and for re-adjusting as necessary. The BLKADJ symbol
is provided as a part of ECDIS Chart 1, see <<sec_19.5>>

==== Detection and notification of navigational hazards

The IMO Performance Standard for ECDIS MSC.530(106)/Rev.1,
clause 11.3.7 Route planning states:

____
A graphical indication should also be given if the mariner plans a
route closer than a user-specified distance from a user-selectable
category of point objects, such as a fixed or floating aid to navigation
or isolated danger.
____

Clause 11.4.6 Route monitoring states:

____
ECDIS should give a warning or caution or indication as selected by
the mariner and related graphical indication if, continuing on its
present course and speed, over a specified time or distance set by
the mariner, own ship will pass closer than a user-specified distance
from a user-selectable category of danger
(e.g. obstruction, wreck, rock) that is shallower than the mariner's
safety contour or a user-selectable category of aid to navigation.
____

Clause 11.4.8 Route Monitoring states:

____
A graphical indication should be given if the current or the next
leg of the selected route goes closer than a user-specified distance
from the boundary of a user-selectable category of prohibited area
or a geographic area for which special conditions exist.
____

The ECDIS must implement support for the Alert and Indications Catalogue
which may be provided within each product's Portrayal Catalogue.

The safety contour value is set by the user; in the absence of a user
setting, its default value must be 30m.

The highlight must indicate the intersection between the ship's look-ahead
buffer (computed using speed, course, look-ahead time and cross-track
deviation) and the spatial components associated with alert instructions
output by the portrayal.

<<fig_2>> depicts indication highlights for points, curves, and surfaces.

[[fig_2]]
.Examples of indication highlights
image::figure-02.png["",440,325]

==== Detection of areas for which special conditions exist

The IMO Performance Standard for ECDIS MSC.530(106)/Rev.1,
clause 11.3.7 (which applies to Route Planning) states:

____
A graphical indication should be given if the mariner plans a route
closer than a user-specified distance from the boundary of a user-selectable
category of prohibited area or geographic area for which special conditions
exist (see appendix 4).
____

Clause 11.4.4 Route Monitoring states;

____
ECDIS should give a warning or caution, or indication, as selected
by the mariner, and related graphical indication if, within a specified
time or distance set by the mariner, own ship will pass closer than
a user-selected distance from the boundary of a user-selectable category
of prohibited area or of a geographical area for which special conditions
exist (see appendix 4).
____

The ECDIS must implement support for Alert and Indications Catalogues.

==== Definition of safety contour

The safety contour is defined as the boundary between safe and unsafe
areas of the display.

==== Detection of safety contour

The IMO Performance Standard for ECDIS MSC.530(106)/Rev.1,
clause 11.3.6 Route Planning states;

____
A graphical indication is required if the mariner plans a route closer
than a user-specified distance from own ship's safety contour.
____

Clause 11.4.3 Route Monitoring states;

____
It should be possible to select that ECDIS gives an alarm and related
graphical indication if, within a specified time or distance set by
the mariner, own ship will pass closer than a user-selected distance
from the safety contour.
____

Clause 11.4.7 Route Monitoring states:

____
A graphical indication should be given if the current or the next
leg of the selected route passes closer than a user-specified distance
from the safety contour.
____

The ECDIS must implement support for Alert and Indications Catalogues

The point, curve or surface must be graphically indicated using the
presentation named as "DNGHLT" in the S-101 Portrayal Catalogue, as
depicted in <<fig_3>>.

[[fig_3]]
.Examples of danger highlights in ECDIS
image::figure-03.png["",461,321]

==== Indications related to ENC accuracy

The IMO Performance Standard for ECDIS MSC.530(106)/Rev.1,
clause 11.3.6 Route Planning states;

____
11.3.8 It should be possible for the mariner to select that the indications
of 11.3.6 and 11.3.7 take into account accuracy information of relevant
hydrographic information, as defined by IHO standards.
____

Clause 11.4.9 Route Monitoring states;

____
11.4.9 It should be possible for the mariner to select that the indications
of 11.4.3, 11.4.4, 11.4.6, 11.4.7 and 11.4.8 take into account accuracy
information of relevant hydrographic information, as defined by IHO
standards.
____

When the Mariner has chosen to take accuracy of hydrographic information
into account the ECDIS must use a _zoneOfConfidence_ attribute to
extend the check area in a horizontal direction for route plans
(closer than a user-specified distance) and for own ship
(within a specified time or distance set by the mariner, own ship
will pass closer than a user-selected distance).

==== Check area extension value - S-101 only

When the ECDIS is using S-101 without any S-102 depth substitution
or S-104 depth adjustment the S-101 QualityOfBathymetricData feature
contains a zoneOfConfidence complex attribute. This provides either
a _horizontalPositionUncertainty_ sub-attribute If no
_horizontalPositionUncertainty_ value is available then the amount
of extension must be taken from the sub-attribute _categoryOfZoneOfConfidence_
according to the following table of default values:

[[table_3]]
.categoryOfZoneOfConfidence and Accuracy values.
[cols="111,68"]
|===
h| _categoryOfZoneOfConfidence value_ h| Positional Accuracy

| A1    | 5m
| A2    | 20m
| B     | 50m
| C     | 500m
| D     | 500m
| U     | 500m
|===

==== Check area extension value - S-102 depth substitution

When the depth information in the S-101 is substituted by S-102 the
__zoneOfConfidence.horizontalPositionUncertainty.__uncertaintyFixedin
the QualityOfBathymetryCoverage feature attribute table
(S-100 Part 10c, 9.6.2) from the S-102 must be used instead of the
S-101 feature information as defined in the last clause if it is set.
If this value is not available then the S-101 value defined in the
previous clause must be used instead.

==== Check area extension value - S-102 depth substitution and S-104 adjustment

When the depth values in the S-101 are substituted for S-102 and also
adjusted by the S-104 values (as documented in <<annexD>>) then the
total value for the extension of the check area, as defined in the
previous clause must then be further adjusted by adding the uncertainty
value in the S-104 feature attribute table
_zoneOfConfidence.horizontalPositionUncertainty.uncertaintyFixed_
if defined.

For example, when the ECDIS is using S-101 only, if the value of
"closer than user specified distance is 100 m and if the value of
_categoryOfZoneOfConfidence_ is A2 (a value of 20 m from the table
of defaults) then the check is extended in the horizontal direction
up to 120 m.

[[fig_9]]
.Example Danger Highlight extended by underlaying value of *_categoryOfZoneOfConfidence_*, left is without extension and right is with extension
image::figure-09.png["",602,206]

For the S-101 case, when multiple QualityOfBathymetricData features
with different _categoryOfZoneOfConfidence_ values underlay the check
area, then the value of extension changes at the point where the original
non-extended check area crosses the boundary of the QualityOfBathymetricData
areas with different _categoryOfZoneOfConfidence_ values, see the
example below:

[[fig_10]]
.Example Extension of check-area by multiple underlaying *QualityOfBathymetricData* areas with different values of *_categoryOfZoneOfConfidence_*
image::figure-10.png["",601,329]

==== Enhanced Safety Contour and Water Level Adjustment.

The term "Enhanced Safety Contour" means a safety contour created
from bathymetric grid data using the value set by the user.
With ENCs the user sets a value for the safety contour, but if a contour
of that value is not found in the ENC then the safety contour defaults
to the next deepest available contour which can be substantially deeper
than the value requested by the user.

Bathymetric grid data allows the user the ability to define a value
and for the system to delineate areas of safe and unsafe water based
on that value. The areas defined can then be used for the definition
of safety contour and attendant alerts/indications. When this is done
contextual ENC features with depth information are also substituted
from the bathymetric grid to present the user a harmonised picture.

The combination of S-101 with S-102 and S-104 together enable Water
Level Adjustment (WLA), allowing the water level data contained in
S-104 to complement the S-102 and S-101 chart data. As with depth
information, WLA processes adjust attribute values in the ENC data
to present the user with a harmonised picture.

<<annexD>> defines the detailed mechanisms for Enhanced Safety Contour
and Water Level Adjustment. The ECDIS must support the Enhanced Safety
Contour and Water Level Adjustment features.

=== Other specified display features

==== Legend

A standard legend of general information relating to the area displayed,
applicable to the position selected by the mariner, must be shown
on a graphic or text display. This legend must contain at minimum
(and, as applicable):

. Scale of display; in addition overscale indication where appropriate;
. Data quality indicator;
. Sounding/vertical datum;
. Horizontal datum;
. The value of the safety depth if used;
. The value of the safety contour selected by the mariner, as well
as the value of the safety contour displayed (which may be different
from that selected by the mariner);
. Method of Water Level Adjustment (if enabled)
. Magnetic variation;
. Date and number of last update(s) affecting the datasets currently
in use;
. Edition number and date of issue of the datasets currently in use;
. Display projection.

Since attempting to display all the above items for all displayed
data products may lead to an unduly large legend, manufacturers may
suppress information from data products other than ENCs. If this is
done, the suppressed information should be available through simple
operator action, such as a temporary expansion of the legend activated
by clicking on a target in the legend. (Note that some of the items
will be the same for all data products - in particular, units and
datums should be the same for all products, or converted to present
the same display result, in order to reduce the chances of user error.)

==== Legend details

The legend must additionally indicate the vertical datum of any S-102
and S-104 used for Enhanced Safety Contour and Water Level Adjustment
on the display. If the vertical datums are the same then a single
indication is enough to cover S-101, S-102 and S-104.

==== ECDIS Legend

The ECDIS chart legend containing the items in <<table_4>> must be
available for display for a position selected by the Mariner.

[[table_4]]
.Legend elements
[cols="203,365"]
|===
h| ECDIS Legend Item h| Values

| Units for depth | Axis Unit of Measure (AXUM) subfield in the Coordinate
System Axes (CSAX) field

| Units for height | AXUM subfield in the CSAX field

2+| Although the S-101 ENC Product Specification does not allow any
units other than metres for depths and heights, these two elements
must be stated for clarity for the Mariner

| Scale of display | Selected by mariner

| Data quality indicator a|

. zoneOfConfidence.categoryOfZoneOfConfidence (CATZOC) attribute of
the *Quality Of Bathymetric Data* (M_QUAL) meta-feature.
When multiple temporal attributes are present:
- If a single attribute value is valid for the selected viewing date
range, that value must be displayed.
If multiple values are valid for the selected viewing date range,
the worst-case value must be displayed.When multiple features are
present (to indicate bathymetric data quality at various depths):
- The feature which intersects the specified safety contour value
must be used.

. Total _horizontalPositionUncertainty_ of the
*Quality Of Non-Bathymetric Data* (M_ACCY) meta-feature if available.

NOTE: Due to the way quality is encoded in the ENC, both values
(a and b) must be provided

2+|

| Sounding/vertical datum |The _verticalDatum_ attribute of the *SoundingDatum*
feature and *VerticalDatumOfData* feature when available.(_verticalDatum_
attributes of individual features must not be used for the legend.)

| Horizontal datum | WGS84

| Value of safety depth | Selected by Mariner. Default is 30 metres

| Value of safety contour a|
Selected by Mariner. Default is 30 metres

NOTE: If the Mariner has selected a contour that is not available
in the ENC and the ECDIS displays a default contour, both the contour
selected and the contour displayed must be quoted

| WLA method
| Method of Water Level Adjustment selected.

| Magnetic variation | *MagneticVariation* (MAGVAR) feature, attributes:
_referenceYearForMagneticVariation (RYRMGV)_, _valueofAnnualChangeInMagneticVariation (VALACM)_,
and _valueOfMagneticVariation (VALMAG)_ Item must be displayed as:
VALMAG RYRMGV (VALACM) +
For example, 4°15W 1990 (8'E)
| Date and number of latest update affecting the ENC each dataset
currently in use
| Issue date and update number from the dataset discovery record
(S100_DatasetDiscoveryMetadata) of the last update dataset applied.
(See S-100 Part 17)

| Edition number and date of each dataset the ENC currently in use
| Edition number and issue date from the dataset discovery record

(S100_DatasetDiscoveryMetadata) of the current base issue of the ENC
dataset. (See S-100 Part 17)
| Display projection | Projection used for the ECDIS display
(For example, oblique azimuthal). This must be appropriate to the
scale and latitude of the data in use

|===

The list above is the minimum that must be available, but the complete
list need not always be shown. Individual items may be picked by the
mariner for display for a period; examples are magnetic variation,
data quality for depths, etc.

=== Displaying manual and automatic updates and added information

[[sec_12.11.1]]
==== Manual updates

It must be possible to make the following manual updates to an ENC:

* Add feature
* Delete feature
* Modify feature

A manually updated feature must be capable of the same performance
in feature selection, response to cursor-picking, etc, as an ENC feature.
In addition, it must provide updating information (identification
and source of update, when and by whom entered, etc) on cursor picking

Manual chart updates, which are subject to human error, must be distinguished
from official information and updates applied automatically. Additionally:

. *Keying and Symbology*. The mariner must be able to enter manual
updates for presentation on the display. A capacity should exist to
enable the mariner to:

.. Enter the update so it can be displayed as described in this specification.

.. Ensure all update text information relevant to the new condition
and to the source of the update, as entered by the Mariner, is recorded
by the system for display on demand.

. *Indications and Alerts*. The ECDIS should provide indications and
alerts related to manual updates, using the same criteria as for ENC
features.
. *Presentation*. Manual updates must be displayed as described in
this clause. A selection of standardised symbols must be made available
for preparing hand-entered chart corrections. The original chart features
must not be removed or altered. A description and list of all symbols
reserved for manual chart updates is contained in <<annexA>>
. **Archiving of Manual Updates**. It should be possible to remove
from the display any manual update. The removed update should be retained
in the ECDIS for future review until commencement of the next voyage,
but will not be otherwise displayed.

==== Additional Mariner's Information

Mariner's Caution Notes and a Mariner's Information Notes must be
presented according to IEC 61174 or IEC 62288, as applicable [and
available].

Point cautions and notes entered by the mariner and the manufacturer
must be distinguished by the colours orange and yellow respectively.

==== Automatic Updates

Only ISO8211 and GML encoded data can support updates, as described
in S-100 Part 10a and 10b respectively. The use of GML updates as
described in S-100 Part 10b is used, in particular, by S-128 to update
catalogue information used by the ECDIS to produce update Status Reports,
as described in <<annexC>> - ECDIS Update Status Reports.

==== Identifying automatic chart corrections on demand

On Mariner demand automatic chart corrections of ENC information must
be highlighted as described in the following sub-clauses.

===== Added Feature (automatic)

Point object: Superimpose symbol CHRVID01.

Curve object: Overwrite with line style CHRVID02.

Surface object: Overwrite area boundary with line style CHRVID02 and
superimpose symbol CHRVID01 on any centred symbol.

===== Deleted Feature (automatic)

Point object: Superimpose symbol CHRVDEL1.

Curve object: Overwrite with line style CHRVDEL2 (do not remove the
original line).

Surface object: Overwrite area boundary with line style CHRVDEL2 and
superimpose symbol CHRVDEL1 on any centred symbol.

===== Modified Feature (automatic)

Point: Superimpose symbol CHRVID01 and symbol CHRVDEL1.

Curve: Overwrite with line styles CHRVID02 and CHRVDEL2.

Surface: Overwrite the boundary with line styles CHRVID02 and CHRVDEL2
and also superimpose symbols CHRVID01 and CHRVDEL1 on any centred
symbol.

==== Update Information

The S-101 Feature Catalogue also provides encoders with an
*Update Information* feature that is used to represent a change to
the information shown.

The intention of the *Update Information* feature is to show the extent
of changes contained in either updates or new editions of S-101 datasets.
This is separate to the highlighting mechanism described in the previous
clause and is optionally included by data producers in ENCs.

For example, when an ENC update contains updates to various features
that adjoin a feature that was actually update, the producer will
use an *Update Information* feature to indicate the actual feature
that was affected and a brief description of the changes.

The 'Update Review' IMS must be implemented to allow update information
features to be portrayed and reviewed on demand.

==== Non-official (Non-ENC) Chart Information

Non-official data added to existing official ENC data to augment the
chart information must be distinguished from the official information
as follows:

Point feature: Superimpose symbol CHCRID01.

Curve feature: Overwrite with line style CHCRID01.

Surface feature: Overwrite area boundary with line style CHCRID01
and superimpose symbol CHCRID01 on any centred symbol.

Non-official data must be distinguished from manually updated chart
information, which uses the same identifiers, by cursor picking.

Non-official chart information may be updated by any systematic procedure.
A record of updates must be maintained.

The mariner must be able to remove all non-official chart information
if the need should arise.

[[sec_12.12]]
=== Display and Management of Navigational Warnings

S-124 Navigational Warnings (NAVWARN) portrayal is provided by a portrayal
catalogue that includes a symbol set and symbol instructions for the
feature and attribute combinations.

[[sec_12.12.1]]
==== Additional Portrayal requirements of the Graphical User Interface

A dedicated interface must be provided to allow users to interact
with NAVWARN messages. This interface must, at a minimum, provide
the following functionality;

. The user must be able to tag individual messages according to the
filtering requirements in <<sec_12.12.2>>
. A Capability for an on demand listing of all (S-124) NAVWARN messages
in the system, and sorting these according to: received date and time,
issue date and time, warning type, producer and series, must be provided.
Additionally, a means to list according to user classification should
be provided.
. Provide an indication when a new NAVWARN message is received until
it has been displayed or 24 hours have passed. This indication may
be suppressed if the NAVWARN message does not meet filtering criteria
set by the mariner (see <<sec_12.12.2>>).
. Means must be provided for the mariner to enter criteria for filtering
of indication of new NAVWARN messages based on time and maximum distance
from own ship, monitored route or planned route (see <<sec_12.12.2>>).
Default setting must be no filtering.
. Details of the filtering options that have been enabled by user
must be available on demand for inspection and modification.
. Means must be provided to view the most recent message, past messages,
and to view messages associated with selection of NAVWARN symbols
in the graphical display area.
. Listing of all NAVWARN must include means for viewing an abbreviated
view of any **NAVWARNPart**, *warningInformation* attributes present.

NOTE: It may be possible to create some of this functionality via
portrayal context parameters,

[[sec_12.12.2]]
==== Filtering Navigational Warning information

The mariner must be able to select the graphical display of S-124
navigational warning (NAVWARN) dataset on or off.

To ensure only relevant information is displayed, and to ensure an
uncluttered screen, the mariner must be able to filter the NAVWARNs
as follows :

At a minimum, filtering functionality must be included that allows
the user to classify the relevance of a NAVWARN against the intended
route as:

* on chart (relevant for the route, must always be visualized), or;
* off chart (not relevant for the route, and need not be visualized),
or;
* information (relevant for the route, but for information and need
not be visualized).

On chart should be the default classification for all NAVWARNs.

NOTE: Even though the full extent of a navigational warning may not
be portrayed, it must still be available and discoverable in a list
of NAVWARNs that can be recalled by user action at any time

Additional filtering functions may include options such as;

* Filtering on route with a buffer;
* Navigational warning topic;
* Date range of the hazard;
* Valid time of the navigational warning.

These filters may then be used to assist the navigator in classifying
a NAVWARN according to its relevance for the route.

====
A self-cancelling dataset:

*NAVWARNPreamble* +
*publicationTime* of 20230704T010000Z +
*cancellationDate* of 20230711T000000Z +
*NAVWARNPart fixedDateRange* of 20230706T010000Z to 20230710T010000Z

is visible on navigation screen during 20230706T010000Z to 20230710T010000Z,
unless removed by a filter set by user, and optionally visible during
20230704T010000Z to 20230706T005959Z.
====

NOTE: It must be possible for user to recall cancelled messages for
review purposes.

[example]
Any dangers that are in waters too shallow for the ship get classified
as off chart warnings, _but must be discoverable_ in the on demand
listing of active NAVWARNs.

[[sec_12.12.3]]
==== Cancelled datasets

When a S-124 dataset is cancelled it must not be displayed on the
navigation screen, but must be available for review in the on demand
listing of NAVWARNs in the navigation system and marked as cancelled.

[[sec_12.12.4]]
==== Portrayal of feature types

The *NAVWARNAreaAffected* class does not have a portrayal defined
to avoid causing significant cluttering on the navigation screen.
Rather, the feature must be highlighted by the system if selected
from a pick report or by other means for interrogation by user.

When a *NAVWARNPart* is not portrayed, such as when user selections
mark it not to be visualized, any associated *TextPlacement* features
must also not be portrayed.



== Coverages and Time Series for Gridded Data (S-102, S-104 and S-111)

Coverage and time series features are encoded in the HDF5 format
(see S-100 Part 10c). S-100 provides for the following types of coverage
and time series data:

* Gridded data with different types of spatial grid coverages;
* Data at a set of discrete fixed points;
* Data at a set of moving platforms;
* Time series data at a set of fixed points.

For S-102 and S-104 datasets, ECDIS must support gridded data in DCF
2 format only. For S-111 datasets, ECDIS must support gridded data
in DCF 2 or DCF 3 format only

Gridded data will specify either continuous or discrete interpolation
(no interpolation between points) between grid points. Data for discrete
fixed points, moving platform and time series at fixed points is intrinsically
discrete.

[[sec_13.1]]
=== Thinning

When gridded data is portrayed using discrete symbols at each data
point, the effects of scaling the display must be considered. A high-resolution
display (that is, zooming in) of regularly gridded data display produces
a lower density of data in the visual field.

Displaying at a low resolution (that is, zooming out) increases the
density of symbols in the visual field. However, by applying a thinning
algorithm, the number of symbols may be reduced.

Thinning must therefore be applied to reduce symbol density when the
display is scaled.

Manufacturers may use the recommended algorithm contained in <<annexG>>
or other algorithms of their own devising.

[[sec_13.2]]
=== Temporal variation

The metadata variables related to time are __dateTimeOfFirstRecord__,
__dateTimeOfLastRecord__, __timeRecordInterval__, _numberOfTimes,
timeIntervalIndex, timePoint, startDateTime,_ and _endDateTime_
(see S-100 Part 10c). The time selected for display (that is,
past/present/future) will typically not correspond exactly to the
timestamp (metadata variable _timePoint_) of the input data.
For a correct display, the ECDIS must select the correct data.

For data with only a single timed record (where the timestamp of the
earliest value equals that of the latest value) such as real-time
data, the data values must be displayed only if the display time is
later than the timestamp and the absolute time difference between
the display time and the data timestamp is less than a discrimination
interval (for example 5 minutes). For a single record, the variable
_timeRecordInterval_ can be used to set the discrimination interval.

For data with multiple times, if the selected display time is later
than the first timestamp and earlier than the last timestamp, or the
selected display time is in the interval [__startDateTime, endDateTime__],
then the closest but immediately preceding values in the data must
be displayed. However, if the selected display time is earlier than
the first timestamp, or outside the interval [__startDateTime__, _endDateTime_]
then the data must not be displayed. If the selected time is later
than the last timestamp or after __endDateTime__, then data values
at that time must be displayed only if the absolute time difference
between the display time and the data timestamp is less than a discrimination
interval (for example the value of the variable _timeRecordInterval_).

Some data change rapidly, so more-or-less continual revision or updating
of such data is essential. For real-time observations, new values
are periodically collected (for example, on the order of once every
5 minutes). For a forecast, the entire field may be created one or
more times per day.Other data, such as tidal atlas or harmonic constant
data are updated much less often, typically on an annual basis.

The system should check for the availability of new data at a frequency
that matches the update frequency.

== Colours

=== Colour palettes implemented by the portrayal catalogue

There are three colour palettes, all of which should be made available
to the Mariner. They are specified as part of the colour profile file(s)
in the Portrayal Catalogues. They are as follows:

DAY:: The "Day" palette uses a white background as a result of a comparative
test outdoors in bright sunlight which showed that a display background
of maximum luminance gives the best contrast achievable under near-washout
conditions. This conclusion has been confirmed by subsequent sea experience.

DUSK:: The "Dusk" colour palette is based on using a black background;
this palette may also be used by day as a Mariner's option.

NIGHT:: The "Night" colour palette is intended for nighttime use.
At night the light emitted by the display must be strictly limited
to avoid impairing night vision. In case the luminance needs to be
further reduced, the "Night" colour palette may be augmented by a
luminance-reducing neutral density filter which should have 8 times
attenuation, designated (logarithmically) "0.9 ND".
(This is a manufacturer's option.)

[[sec_15]]
== Cursor Pick Reports and Displays in Interface Panels

ECDIS must be capable of performing spatial queries on ENC and other
S-100 data. Spatial query is understood as the ability to inspect
graphical position and numerical value of spatial coordinates associated
with a charted feature.

Spatial query must be available by means of cursor pick.

=== Cursor pick rules

The rules below must be applied to all ECDIS cursor Pick Reports.

. Full feature and attribute names must be displayed. If a language
pack is installed then the feature and attribute names must use the
translated names contained in the language pack according to user
preference - user language preferences are described in <<sec_10.3>>.
. Listed value names must be displayed instead of the numerical code.
. There must not be any padding of attribute values, for example,
a height of 10 metres must not be padded to 10.000000 metres as this
could potentially confuse or mislead the Mariner.
. Units of measure must be included after all attribute values when
available.
. Cursor pick report must extend to include both information associations
and feature associations, including aggregations and compositions,
which may link to information types or features that carry additional
information such as a _featureName_.
. Dates must be given in the form "Day Month Year" DD-MMM-YYYY.
+
--
Month abbreviations must be: JAN, FEB, MAR, APR, MAY, JUN, JUL, AUG,
SEP, OCT, NOV, DEC.
--

. The Pick Report must only return information about the visible features
on the ECDIS display. If the viewing group is turned on all features,
even "no symbol" features without visible presentation within that
viewing group, must be provided in the cursor Pick Report, i.e. only
active drawing instructions must be included.
. Pick Report must include the information associated with the spatial
object limited to the area of the cursor pick. For example, information
related to accuracy.
. Complex or Simple Attributes with private feature catalogue visibility
must not be included. If visibility is not defined then it must be
assumed to be public.
. All features with identical _interoperabilityIdentifier_ values
must be presented together and merged.
. Descriptions of attributes and their values, available in the feature
catalogue, must be shown on demand.

=== Display of dataset support files

S-100 datasets encode textual or graphical information such as diagrams
and photographs in dataset support files using one of the S-100 dataset
support file formats.

The pick report must enable text and graphical information to be displayed
without affecting the night vision of the user. The luminance of the
displayed information must be in the same band as the current palette
in use at the time it is displayed.

=== Pick report organisation.

==== Sorting order of results

The Pick Report must be organized to facilitate navigation through
complex reports in a manner logically consistent with the layering
presented on the screen.

The order of features must correspond to the drawing order. Features
must be prioritized using the highest priority active drawing instruction
associated with the feature. Only active drawing instructions which
intersect the pick area should be evaluated during sorting.

==== Hover-over function

The ECDIS may provide a hover-over function for Mariners to access
important charted feature details without having to select a Pick
Report. If this function is implemented within an ECDIS, the Mariner
must be able to turn hover-over functionality on and off.

=== Tidal stream data panels

S-101 Tidal stream information in the form of speed and direction
at intervals relative to the time of a "reference tide"
(generally high or low water) must be formatted for display in the
ECDIS cursor Pick Report (or other UI panel).

<<table_6>> shows the layout that must be used for displaying the
values, encoded in the *Tidal Stream Panel Data* S-101 feature.

Multiple instances of *Tidal Stream Panel Data* features must be shown
as separate tables

The table shows how a *Tidal Stream Panel Data* feature and its attributes
are used in the ECDIS display. Complex attributes are in italics and
encoded values are in blue text.

[[table_6]]
.Template for tidal stream values
[cols="71,38,147,97,101",options="noheader"]    
|===
5+| Tidal Station: _(station name)_ [blue]#*Plymouth Devonport*#
2+| Tidal Station Identifier: _(station identifier)_ [blue]#*0014*#
3+| Data From: _(data product, from dataset metadata)_ [blue]#*S-101*#
.2+|   .2+| Hours | Direction of Stream | Rates (knots) | Stream Depth
| _(degrees)_ | _springs_ | _metres_

.6+| *Before*   ^| _-6_ ^| [blue]#*113*# ^| [blue]#*0.1*# ^| [blue]#*1.0*#
                ^| _-5_ ^| [blue]#*332*# ^| [blue]#*0.6*# ^| [blue]#*1.0*#
                ^| _-4_ ^| [blue]#*331*# ^| [blue]#*1.1*# ^| [blue]#*1.0*#
                ^| _-3_ ^| [blue]#*342*# ^| [blue]#*1.0*# ^| [blue]#*1.0*#
                ^| _-2_ ^| [blue]#*347*# ^| [blue]#*0.7*# ^| [blue]#*1.0*#
                ^| _-1_ ^| [blue]#*333*# ^| [blue]#*0.5*# ^| [blue]#*1.0*#
| _high water_  ^| _0_  ^| [blue]#*317*# ^| [blue]#*0.3*# ^| [blue]#*1.0*#
.6+| *After*    ^| _1_  ^| [blue]#*178*# ^| [blue]#*0.3*# ^| [blue]#*0.5*#
                ^| _2_  ^| [blue]#*146*# ^| [blue]#*0.6*# ^| [blue]#*0.5*#
                ^| _3_  ^| [blue]#*140*# ^| [blue]#*1.0*# ^| [blue]#*0.5*#
                ^| _4_  ^| [blue]#*143*# ^| [blue]#*1.1*# ^| [blue]#*0.5*#
                ^| _5_  ^| [blue]#*143*# ^| [blue]#*0.8*# ^| [blue]#*0.5*#
                ^| _6_  ^| [blue]#*138*# ^| [blue]#*0.3*# ^| [blue]#*0.5*#
|===


== Alerts and Indications

IMO Resolution MSC.530(106)/Rev.1 states in 11.3 and 11.4 and their
sub-paragraphs how an ECDIS should respond to risk of crossing, dangers,
prohibited areas or areas with special conditions, during route planning
(11.3) or route monitoring (11.4). Appendix 4 and Appendix 5 of the
same resolution provide details about the areas for which an ECDIS
should detect incursions and provide an alert or indication.

=== Multiple spatial objects.

If multiple spatial objects are identified then the union of those
spatial objects must be highlighted. If the same spatial object identifies
an alert and an indication then the drawing order must be the alert
highlight followed by the drawing highlight.

== Use of Context Parameters

The Portrayal Catalogue for a product contains the set of parameters
which are used in the portrayal processing for that product.
This set may be different for different products. Context parameters
are used for passing portrayal-related configuration information and
user settings to portrayal processing, and the values of context parameters
may therefore be changed by user functions, including those defined
in the IMO Performance Standards, in this document, or manufacturers'
custom user functions.

In order to be able to use the official Portrayal Catalogue for a
data product, manufacturers must implement all the context parameters
listed in the Portrayal Catalogue.

Context parameters may be added or removed by updates to the Portrayal
Catalogue. Context parameters which cannot be automatically associated
with ECDIS display functions or user interface features must be exposed
to the Mariner for use.

[[sec_18]]
== Dual-fuel systems

Dual-fuel systems are systems that use both older (pre-S-100) and
newer (S-100) data products that contain the same type of information
(for example, S-57 and S-101 ENCs).

All stakeholders should anticipate a transition period during which
new S-100 formats are increasingly published to co-exist with older
formats. An S-100 ECDIS must be able to handle both S-57 and S-101
ENCs during the transition period.

=== Display of additional information layers

The display of additional information layers is generally driven by
mariner need. The Interoperability Catalogue concept for ECDIS
(see S-100 Part 16 and S-98) is based on the use of S-101 ENCs as
the base layer.

=== Concurrent applicability of S-52 and S-57

Dual-fuel capable systems must continue to use the principles defined
in S-57 and S-52 for the presentation of chart data that conforms
to S-57 instead of S-101. The principles of S-101 and this specification
must be concurrently applied where S-101 data is displayed. This includes
the case where one part of the chart window has S-101 data as the
chart layer and another has S-57 data as the chart layer - S-57/S-52
applies to the portion where S-57 data is the chart layer and S-101
and this specification apply where S-101 data is the chart layer.

Seamless portrayal of S-57 and S-101 data is described in <<annexE>>.

Overlays of S-100-based non-ENC data over S-57 chart data are left
to manufacturer discretion within IMO guidance. Any overlays over
S-57 chart data must not interact with or modify the underlying chart
data, in particular the Enhanced Safety Contour and Water Level Adjustment
features must only be implemented over S-101 charts.

This specification is designed to allow such integrated displays.
Note in particular:

* The IMO functions continue to be used. This specification describes
their applicability to S-100-based data and defines additional functions
for S-100-based data. Any additional functions that apply only to
S-100-data should be deactivated for S-57 data.
* The principles for chart furniture and miscellaneous display elements
(scale boundaries, limits of data, safety contour, depth zones, update
identification, legend, etc) are the same in S-52 and this specification.
* The names of colour tokens are the same. (Future versions of this
specification may add additional colour tokens, but should retain
the S-52 set.)
* Management of viewing groups must be combined between S-57 and S-100.
Viewing groups common to S-57 and S-100 should be managed as a single
group across all S-100 products.

Note that some elements required for complete compatibility of S-57/S-52
and S-101 presentations cannot be controlled in this specification,
depending as they do on the harmonisation of Portrayal Catalogues
with S-52 symbology, colour tables, and lookup tables. Among these
are the shapes and dimensions of symbols and the colour coordinates
assigned to colour tokens.

== Specifications for the display screen

=== Physical display requirements

The requirements for the main graphic display are:

Size:: Minimum effective size of the area for chart display:
stem:[270 xx 270 "unitsml(mm)"] (IMO MSC 530(106) 10.2).

Resolution:: Minimum lines per mm (stem:[L]) given by stem:[L = 864/s],
where stem:[s] is the smaller dimension of the chart display area.
(e.g. for the minimum chart area, stem:[s = 270 "unitsml(mm)"], the
resolution stem:[L = 864//270 = 3.20] lines per mm, giving a
"picture unit" size of stem:[0.312 "unitsml(mm)"])

The specifications above permit a chart display whose minimum resolution
(lines/mm) may vary depending on the size of the display. Maintaining
a clearly readable chart display under this flexibility imposes certain
requirements on the display software, which are described in <<sec_10.2>>.

Information should be displayed in the ECDIS on one or more physical
screens, which may be divided into more than one chart display.
Information may be displayed automatically, on demand or as a result
of Mariner's selection.

The physical size of the screen(s) should be appropriate to viewing
conditions. Larger screens may be more suitable for situations where
the operational viewing distance is higher, because the larger physical
area of the display offsets the reduction of on-screen geographical
extent that is caused by the greater zoom levels and symbol sizes
necessitated by greater viewing distances.

Redraw during route monitoring to follow the ship's progress, including
scale changes due to change in the scale of the chart information,
should take less than 5 seconds. Demands by the Mariner that cannot
be predicted by the ECDIS, such as draw at a different scale or in
a different area may take more than 5 seconds. In the latter case:

* The Mariner should be informed;
* The display should continue route monitoring

=== Colour reproduction

Absolute accuracy in colour reproduction is not required but relative
colour fidelity is important. To ensure clear contrast between colour-coded
features the display screen must be calibrated before use, and this
calibration should as far as possible be maintained while in service.
If this is not done, lines, symbols, and area shades may become indistinct,
and information may then be lost or become misleading.

=== Display requirements for colours

[[sec_19.3]]
==== General

The ECDIS manufacturer can use any technology to build the display
as long as their display fulfils the requirements of this specification.

==== Display calibration and verification

The ECDIS display must be calibrated initially in order to transform
the CIE colour table coordinates to screen coordinates. The main components
of the ECDIS display are the monitor and the image generator.
Both the monitor and the image generator used to drive the ECDIS display
can be calibrated together as a colour generating unit. Another alternative
is to calibrate separately both the monitor and image generator.

The following international standards describe methods for calibration
of a monitor's RGB values to produce an output. Other methodologies
may be followed, but the same verification test requirements apply
regardless of method.

CIE 122-1996 _Technical Report: The Relationship between Digital and
Colorimetric Data for Computer-Controlled CRT Displays._

IEC 61966-3:2000 __Multimedia systems and equipment -Colour measurement
and management - Part 3: Equipment using cathode ray tubes__,
Edition 1.

IEC 61966-4:2000 __Multimedia systems and equipment-Colour measurement
and management - Part 4: Equipment using liquid crystal display panels__,
Edition 1.

The ECDIS display calibration must be verified for type approval of
all monitors.

==== Colour control, contrast and brightness controls

There are a variety of technologies available for monitors to be used
for ECDIS display. Different technologies have different methods to
control colour, contrast and brightness, but some basic rules apply
for all of them.

==== Effect of controls

The contrast control of a display generally shortens or extends the
range of luminance available, making the display appear darker or
brighter.

On the other hand, the brightness control shortens or extends the
range of colour saturation available by adding white
(which extends the range by making colours other than black less saturated),
or subtracting white (colours become darker, more saturated.)

To the viewer, it has much the same apparent effect as contrast, but
it achieves this by altering the colour contrast of the colour tables
between foreground and background colours, and this may result in
some features becoming harder to see, particularly at night.
More importantly, making the night display more saturated may drop
some dark colours below the cut-off point, into black, thus losing
distinctions such as shallow versus deep water.

==== Use of the controls

Colour tables are provided for day, dusk and night. The mariner must
be provided with the control to make fine adjustments between these
tables; the calibration position must be marked as a reference for
this.

The general principle is that all colour calibration controls must
have a provision to return to the calibrated settings.

The ECDIS manual must carry a warning that use of the ECDIS with uncalibrated
settings may adversely affect the visibility of information on the
display.

==== Setting the controls for route monitoring

The ECDIS display carries far more detail than a radar display, and
requires correspondingly more attention to the correct selection of
colour table and the correct adjustment of the controls.

This particularly affects the black-background displays, and is critically
important at night, because all colours of the night table, particularly
those for large areas, have to be set very dark to avoid loss of night
vision, and if the control is turned down too far these colours will
disappear into the black background. As a result, chart information
will be lost.

The situation will be worse if one of the day tables is improperly
dimmed for use at night, instead of switching to the night table.

It is important that the display be adapted to lighting conditions
on the bridge by selecting the correct colour table: "Day" for bright
sunlight; "Day" or "Dusk" for general daylight viewing; "Dusk" for
twilight; and "Night" for the night-darkened bridge.

The controls should only be used for fine adjustment within the appropriate
colour table.

To ensure that the controls are always set to a level above that at
which information will be lost, the black-adjust symbol BLKADJ must
be available to the Mariner, treated as "Standard display", to be
called up at any convenient point on the screen. The instructions
for its use by the Mariner must be incorporated in the ECDIS manual.

The following text box contains an example of instruction for an LCD
type of Monitor. The LCD type of monitor used in this example has
only one mariner control, called "brilliance". Internally the monitor
has also other controls available for service engineers. These internal
controls include also controls named as contrast and brightness.

____
First, set brilliance to calibration position. Look at the black-adjust
symbol.
Then either:

* If the centre square is not visible, turn up the brilliance until
it just appears;

or

* If the centre square is clearly visible, turn down the brilliance
until the inner square disappears, then turn brilliance back up until
the inner square is just visible again.

(If the above adjustment is not successful, select a more appropriate
colour table and repeat this procedure.)

The "black level" is now correctly set. If a brighter display is required
use the brilliance control, but it is better not to re-adjust the
controls unless lighting conditions on the bridge change.Note that
the black-adjust symbol should be displayed to check that the inner
square remains visible on the following occasions:

* Every time that the brightness or contrast controls are adjusted.
* Every time that the display is switched to the night colour table.
____

=== Colour display capability

Colour displays must be capable of at least 256 luminance steps in
each of red, green and blue.

==== Colour conversion tolerances and tests

===== Tolerances

The tolerances quoted below apply only to the process of converting
CIE colour coordinates to RGB values

Considerable operational experience will be needed before it will
be possible to state colour maintenance tolerances for ECDIS on-board
ship.

The colour tables developed have been selected to ensure maximum colour
discrimination between features. Colour discrimination depends on
both the colour difference and the luminance difference between two
colours. Colour science (as represented by the CIE colour convention)
has defined colour difference units stem:[Delta E^**].
The stem:[Delta E^**] metric is a measure of the overall discrimination
(including both colour and luminance differences). As a metric for
ECDIS colour accuracy, a measure of the discrimination in colour alone,
excluding luminance differences has been defined as a subset of
stem:[Delta E^**] referred to as stem:[Delta (u^**,v^**)].

[stem%unnumbered]
++++
Delta(u^**,v^**) = SQRT[(u2^** - u1^**)^2 + (v2^** - v1^**)^2]
++++

[stem%unnumbered]
++++
Delta E^** = SQRT [(L2^** - L1^**)^2 + (u2^** - u1^**)^2 + (v2^** - v1^**)^2]
++++

Calculations of stem:[L^**, u^**], and stem:[v^**] must be made using
as reference the chromaticity and luminance specified for the brightest
white colour token in the respective colour table stem:[(Y0, u0, y0)];
where stem:[Y0] is the luminance in units of stem:["unitsml(cd/m^2)"].
Note: this is not the brightest white of the monitor.

NOTE: "stem:[Delta]" represents the Greek letter "Delta", although
it may appear differently on some computers.

The tolerances for the conversion of the colour tables from the CIE
colours defined in these specifications to the actual RGB values for
the ECDIS display are defined in three terms:

. Overall discrimination between actual colours within the converted
table: stem:[Delta E^**]. This is to ensure that all the colours within
the RGB table remain discriminably separate; that is, that the relative
colour distinctions have been maintained.

. Colour discrimination differences between the defined and the actual
values: stem:[Delta (u^**,v^**)]. This is to ensure that the actual
RGB colours resulting from the conversion remain reasonably close
to the CIE colours defined in the specifications; that is, that the
blues stay blue and the greens stay green.

. Luminance differences between the defined values and the actual
values: stem:[L]. This is to ensure that the luminance remains the
same within acceptable limits.

Note: The CIE stem:[L^** u^** v^**] human perception colour model,
which is the source of the tolerances described above, has not yet
been evaluated at the low luminances of the night colour table, at
which the less colour-sensitive rods of the eye take over from the
daytime cones. Consequently these tolerances should not be applied
to the night table; and for type-approval purposes they are restricted
to the bright sun table.

Colour tolerance values:

. The discrimination difference between any two colours displayed
(except those listed with a tabular stem:[Delta E^**] less than 20)
must be not less than stem:[10 Delta E^**] units.

[[table_7]]
.Tolerance exceptions
[cols="47,93,49,93,22"]
|===
h| Token h| Colour stem:[(x, y, L)] h| Token h| Colour stem:[(x, y, L)] h| stem:[Delta E^**]

| DEPMD | (.27 .30 65)pale blue   | CHWHTDEPDWUIBCK | (.28 .31 80)white       | 11
| CHBRN | (.42 .45 30)brown       | ADINF           | (.41, .47 35)yellow     | 14
| DEPMS | (.24 .26 55)medium blue | DEPVSUIAFD      | (.22 .24 45)medium blue | 17
| DEPMD | (.27 .30 65)pale blue   | CHGRFNODTA      | (.28 .31 45)faint grey  | 18
|===

. The difference between the colour displayed and the CIE colour defined
in these specifications must be not greater than 16 stem:[Delta(u^**,v^**)]
units. If a monitor is independently tested, then the difference must
not be greater than stem:[8 Delta(u^**,v^**)] units.

. The luminance of the colour displayed must be within 20% of its
specified value. Black is a special case and the luminance of it must
not be greater than stem:[0.52 "unitsml(cd/m^2)"] for bright sun colour
table.

===== Instrumental calibration verification test

For LCD displays, an instrumental test to check that the results of
the colour conversion calibration are within tolerance should be
made by

. Displaying the colours of all three colour tables (restricted to
colour pairs of tabular stem:[Delta E^**] greater than 20)
. Measuring their CIE coordinates stem:[x],stem:[y] and stem:[L]
. Applying a tolerance test.

Note that since the tolerance test is intended solely to check successful
colour calibration, and not to test colour maintenance at sea, this
test should be performed on the bench in the manufacturer's or type-approval
authority's plant under normal conditions of temperature, humidity
and vibration.

Manufacturers of ECDIS can choose between two different methods of
colour calibration.

The first method is a test of a monitor as part of an integrated system.
In this method both the monitor and the image generator parts of ECDIS
display are tested together.

The second method is an independent test of the monitor. In this method
the monitor and the image generator of ECDIS display are separately
tested against a reference (that is, the monitor is tested against
a reference image generator and the image generator is tested against
a reference monitor). The second method has tighter tolerance for
displayed colour than the first method.

[[sec_19.5]]
=== ECDIS Chart 1 and Colour (Differentiation) Test Diagram

The IHO provides ECDIS Chart 1 in digital form, a graphical index
of selected ECDIS symbols and symbolized lines and area boundary linestyles.
This is intended to familiarize the Mariner with the colour and symbol
coding used by the ECDIS. The symbols are grouped according to INT1,
which is familiar to the Mariner, but are numbered with a look-up
sheet, not labelled.

Since Product Specifications for data products used on ECDIS will
be updated at different times, there may be a supplementary
"Chart 1" for each data product other than ENC that is intended for
use in ECDIS.

The ECDIS Chart 1 and any supplements are intended for use in route
planning. They are not needed during route monitoring, when the Mariner
can use cursor enquiry to find the meaning of symbols.

The ECDIS Chart 1 and its indexing list of symbol names and meanings
arranged numerically, together with the colour differentiation test
diagrams, are intended for the Mariner's use. The use of the Colour
Differentiation Test Diagrams is described in <<sec_19.6.2>>

=== Use of ECDIS Chart 1 and Colour Test Diagram

==== Specification for ECDIS Chart 1 and the Colour Test Diagram

===== Definition

Each Chart 1 dataset must be initially displayed at the optimumDisplayScale,
so as to fill all of the standard ECDIS display area (that is,
the minimum stem:[270 xx 270 "unitsml(mm)"] chart area).

===== Description and purpose

The ECDIS Chart 1 and the Colour Differentiation Test are for use
by the Mariner and are provided in the form of an Exchange Set containing
a number of S-100 datasets.

The ECDIS chart 1 is intended to familiarise the Mariner with the
symbology used on ECDIS. The Mariner must be able to display each
cell, and by cursor-pick get a read-out of the meaning of any
feature shown.

The Colour Differentiation Test diagram is intended for display using
the day or dusk colour tables so that the Mariner can check that the
ECDIS display is providing adequate colour performance It is also
used in type-approval testing. Instructions for its use are given
in the following clauses.

The ECDIS Chart 1 includes the CHKSYM symbol which is intended for
checking the correct size of the symbols during the type approval.
The width and height of the CHKSYM is stem:[5.0 "unitsml(mm)"].

The line width of the diagonal lines in the Colour Differentiation
Test diagram are specified as stem:[0.6 "unitsml(mm)"] wide.

===== Mode of use

The operation of these diagrams is not subject to any draw-speed requirements
of route monitoring.

===== Content and Encoding

Chart 1 is released as an exchange set comprising a number of S-100
datasets within the S-164 suite of test data. Portrayal and content
are defined wholly by feature and portrayal catalogues.

===== Revisions

Revisions will be made by whole file replacement; that is, by the
issuing of new editions. The user must be able to access the revision
information of Chart 1 and the Colour Test Diagram.

===== Presentation and parameter settings

Refer to the S-164 test dataset manual for ECDIS parameter settings
for portrayal of Chart 1 datasets.

[[sec_19.6.2]]
==== The Colour Test Diagram

A multi-purpose colour differentiation test diagram is illustrated
in <<fig_4>>. This consists of 20 squares each coloured with one of
the 4 main background colour fills (such as shallow water blue);
and each having a diagonal line in one of the six important foreground
colours (such as mariner's orange). Each diagonal line is
stem:[0.64 "unitsml(mm)"].

The diagram is in the form of a dataset and so can be displayed using
any of the three colour palettes. This diagram is intended:

. For use by the Mariner to check and if necessary re-adjust the controls,
particularly for use at night;
. For use by the Mariner to verify that an ageing display remains
capable of providing the necessary colour differentiation; and
. For initial colour verification of the day, dusk and night colour
tables.

Both the Colour Test Diagram and the instructions for its use are
included within the IHO S-164 test datasets Chart 1 exchange set,
and must be made available to the Mariner. In addition, a grey scale
is included in <<sec_19.6>> for use by maintenance technicians in
checking colour tracking in an ageing display.

The Colour Differentiation Test diagram is not needed during route
monitoring.

Note that the Colour Differentiation Test Diagram will not be true
to colour unless it is projected on a calibrated screen and is generated
using the digital format provided by IHO, which correctly reproduces
the colour tokens of the Presentation Library.

The colour differentiation diagram is required in "Day" and "Dusk"
colours so that the Mariner can verify that the ECDIS display monitor
has the colour differentiation capability needed to distinguish between
the various colour-coded areas, lines and point symbols of the ECDIS
display.

[[fig_4]]
.Colour differentiation diagram - Day
image::figure-04.png["",547,549]

NOTE: For illustrative purposes only. Actual ECDIS Chart 1 datasets
must be used

[discrete]
===== Providing the diagram

The Colour Differentiation Test diagram must be provided to enable
the Mariner to verify that the display screen still retains the colour
differentiation capability needed to distinguish between the various
colour-coded areas, lines and point symbols of the ECDIS display.

The diagram will not be true to colour unless it is displayed on a
calibrated monitor and is generated using the provided ENC portrayal
catalogue.

To provide the diagram the dataset labelled "10100AACH1WOO" must be
used. This dataset must be initially displayed at the optimumDisplayScale
so that the extent of the imaginary chart data covers the entire ECDIS
display.

The diagram consists of twenty numbered squares extending over the
whole of a stem:[270 xx 270 "unitsml(mm)"] screen Each square is coloured
with one of the four main background area shades (such as shallow
water blue, DEPVS), and each carries a two-pixel wide diagonal line
in one of the important line or symbol foreground colours. These are
arranged as follows:

*Four main background colours:*

[cols="3,10,5",options="noheader,unnumbered",frame=none,grid=none]
|===
| DEPVS | (shallow water blue)          | squares 3, 5, 11, 15, 18, 20.
| DEPDW | (deep water, white or black)  | squares 1, 7, 8, 10, 13, 19.
| LANDA | (land colour)                 | squares 6, 14, 17.
| NODTA
| (no data shade: radar, navigation safety
lines and chartwork must be visible on the
no-data part of a display)
| squares 2, 4, 9, 12, 16.
|===

*Six important foreground colours:*

[cols="3,10,5",options="noheader,unnumbered",frame=none,grid=none]
|===
| DEPSC | (safety contour grey)                         | squares 3, 10, 17.
| NINFO | (orange, Mariner's information)               | squares 5, 8, 14, 16.
| ADINF | (yellow, manufacturer's information)          | squares 12, 15, 19.
| TRFCD | (magenta, traffic lanes and area boundaries)  | squares 1, 9, 11.
| RADLO | (the lower luminance radar green)             | squares 4, 6, 13, 18.
| RESBL
| (blue, provisionally reserved for traffic info from transponder, VTS etc.)
| squares 2, 7, 20.
|===

The procedures for carrying out the test are documented in S-164.

==== Relationship to S-57 Chart 1

The Chart 1 datasets are located alongside the existing S-57
Chart 1 cells to allow use of both in Dual Fuel mode.

==== The Black-adjust symbol

The black-adjust symbol BLKADJ01 is to allow the Mariner to adjust
the display for ambient illumination on the bridge of a ship. An ECDIS
must have the black-adjust symbol displayed whenever the mariner is
adjusting the display (that is, depending on the technology of the
display brilliance, brightness, contrast, etc), as required by <<sec_19.3>>.


== Dataset Management

This clause covers required functionality for S-100 dataset management
on the ECDIS to the extent that it affects the user experience and
portrayal processing.

=== Multiple Feature and Portrayal Catalogues

The ECDIS must be able to persistently install for usemultiple versions
of the Feature and Portrayal Catalogues for S-100 products. Catalogue
management is based on the version number of the Product Specification
and Catalogues

A list of the available versions of all installed feature and portrayal
catalogues together with their versions must be available to the user
on demand.

See <<annexB>> for loading and ingest processes including SSE Codes
relating to catalogues.

The versioning of Feature and Portrayal catalogues follows the same
rules as S-100, which uses a three-part version number
(_Edition.Revision.Clarification_). The significance of each component
is summarised below:

* Edition: New Editions introduce significant changes, such as the
ability to support new functions or applications; or the introduction
of new constructs or data types. New Editions are indicated by incrementing
the _Edition_ component of the version number and resetting the other
components to 0.
* Revision: Revisions introduce substantive semantic changes. New
Revisions are indicated by incrementing the _Revision_ component of
the version number and resetting the _Clarification_
component to 0.
* Clarification: Clarifications are non-substantive changes. Typically,
Clarifications remove ambiguity; correct grammatical and spelling
errors; amend or update cross references; and/or insert improved graphics,
spelling, punctuation and grammar. Clarifications must not cause any
substantive semantic changes. Changes in a Clarification are minor
and ensure backward compatibility with the previous versions within
the same Edition. Clarifications are indicated by incrementing the
Clarification component of the version number.

[cols="139,98,85,107,106",options="unnumbered"]
|===
h| Type of Change h| Example h| DPS h| FC h| PC

| Major Change including an S-100 version change
| New Concept in S-100, used in S-101
a| image:figure-x.png["",16,16].0.0
a| image:figure-x.png["",16,16].0.0
a| image:figure-x.png["",16,16].0.0

| New content
| Attribute value / Feature added or removed
a| A.image:figure-x.png["",16,16].0
a| A.image:figure-x.png["",16,16].0
a| A.image:figure-x.png["",16,16].0

| FC correction, no content or portrayal impact
| Clarification of definition
| A.B.-
a| A.B.image:figure-x.png["",16,16]
| A.B.-
|===

Each dataset has a product specification edition number contained
within it. These are located as follows:

. ISO8211 datasets (S-100 Part 10a). The "PRED" field of the DSID
record in the dataset.
. GML Datasets (S-100 Part 10b). The "ProductEdition" element of the
DatasetIdentification element in the GML dataset header.
. HDF5 datasets (S-100 Part 10c) - Root Group "Product Specification"
metadata value, S-100 Part 10c

And have the following common format:

*INT.IHO.[S-XXX].A.B[.C]* where: +
S-XXX is the IHO product specification , e.g S-101, S-102 etc.. +
*A.B* and, optionally encoded, *.C* are the Edition, Revision and
clarification numbers as above.

e.g. for an S-101 ENC dataset conforming to feature catalogue 1.4.1
the DSID PRED field contains:

*INT.IHO.S-101.1.4.1 or INT.IHO.S-101.1.4*

Catalogues are identified by the following XML elements

* Feature Catalogue: S100XC: *productid* and S100XC:**versionNumber**
* Portrayal Catalogue: *productid* and *version* attributes of the
PortrayalCatalogue root element of the portrayal_catalogue.xml contained
in the root level of the compressed portrayal catalogue archive.

Therefore, this requires the ECDIS to have installed a feature catalogue
for each S-100 dataset which has a matching edition and revision number.
Multiple feature catalogues for each S-100 product *must* therefore
be supported to maintain different revisions and editions of datasets
within the System Database.

=== Portrayal and feature catalogue compatibility

The ECDIS must support the ability to install and use multiple Portrayal
Catalogues (including for individual products) for portrayal of the
contents of the System Database.

. Compatible datasets have identical Edition and Revision numbers.
. Portrayal Catalogues compatible with Feature catalogues also have
identical Edition and Revision Numbers.
. Editions with different clarification numbers but identical Edition
and Revision numbers are all compatible.
. So, it is possible to process datasets conforming to a Clarification
with the Feature and Portrayal Catalogues for an earlier Clarification
within the same Edition and Revision.

=== Dataset overlaps and gaps

==== Overlaps and gaps in ENC coverage

There may be cases where ENCs in the same scale range overlap.
Such may be the case at agreed adjoining producer data limits, where,
if it is difficult to achieve a perfect join, an overlapping buffer
zone of up to 5 metres may be used.

Where an overlap of more than 5 metres between two or more datasets
exists the ECDIS *must* only display one dataset for the overlap area
and provide a permanent indication "overlap".

==== Overlaps and gaps between other data products

Overlaps in datasets of the same scale range in products other than
the ENC must be indicated by an on-demand indication
"Overlap in ??? data" (where ??? is the abbreviation for the data
product).

An exception to this rule is S-102 and S-104 data used for Water Level
Adjustment. In these cases the ECDIS *must* only select and use a
single dataset from the overlapping data available and provide a permanent
indication "overlap" as per ENCs.

Coverage gaps in products other than the ENC can be expected and should
not be indicated.

Similarly, overlaps between different data producers' ENC and other
data products other than ENC should also be expected. Certain features,
such as navigational warnings, can extend far beyond national boundaries
and may therefore overlap other data producers' ENC data. An indication
is not needed in these cases.

[[sec_20.4]]
=== Updating Datasets on ECDIS

==== Introduction

The current Editions of S-65, S-57 and S-63 continue to apply to the
production and data delivery for S-57 ENC updates. S-52 Appendix I
continues to apply to the processing of S-57 updates on ECDIS.

==== General requirements

. *Data Integrity*. The ECDIS must be able to process updates to S-100
data products without degradation of the information content of the
dataset or dataset update. For example, all information regarding
attributes, logical relationships, geometry, and topology must be
accounted for.
. *Verification of Application*. The ECDIS must provide a method to
ensure that updates have been correctly applied to the System Database
. *Log File*. ECDIS must keep a record of updates to all S-100 data
products through a log file. The log file must contain, for each update
applied to or rejected by the System Database, the following information:
.. date and time of application
.. complete and unique identification of update, for example update
and edition numbers for S-101 ENC
.. any anomalies encountered during application;
.. type of application: manual/automatic.

NOTE: (informative) Sequences are determined by the update and Edition
numbers, not by issue date and time. Issue date/time are given in
dataset discovery metadata in the Exchange Catalogue
(see S-100 Part 17). Note that time is optional. Note also that it
is possible for the date/time for two or more consecutive updates
to be the same - in fact for data that are frequently updated, such
as water levels, the date may be the same for many consecutive datasets.

==== Automatic Update

. *Reception of Updates.* The ECDIS must be capable of receiving official
updates, as S-100 Part 17 exchange set.For such updates of S-124 and
S-129 datasets, the ECDIS should footnote:[In the next operational
version of S-98, "should" to be changed to "must" and the constraint
to S-124 and S-129 to be removed.] be capable of being interfaced
to a SECOM (IEC 63173-2) based telecommunication network. This capability
should include at least:

.. [[item_i]]User selection of data services from a list provided
by a SECOM service registry,
.. Management of information about the data services selected in <<item_i>>,
for example SECOM subscription status, and
.. Acknowledge receipt of datasets.
+
--
NOTE: (informative) The bi-directional transfer of S-421 based route
plans using SECOM is described in IEC 61174, IEC 63173-1 and IEC 63173-2.
--

. *Sequence Check*. Where data products support sequential updating
the ECDIS must ensure updates are always applied in uninterrupted
sequence.
. *Data Integrity and Authentication Check*. All exchange set contents
require the use of digital signatures and the ECDIS must authenticate
all updates using the applicable procedures described in S-100
Part 15. All updates that do not pass the authentication and data
integrity check must not be applied. The user must be informed of
any authentication or data integrity anomalies (refer to SSE codes).
Update authentication and data integrity related messages for the
user may be combined to avoid flooding the user, but must all be logged
. *Applicability*. Updates not relating to a dataset within the set
of datasets in the System Database may be discarded.
. *Summary Report*. A summary report for each of the Issuing Authority's
official update files must be given after completion of receipt containing
at least:
.. Identification of Issuing Authority;
.. Update numbers of the update files;
.. Dataset Identifiers of datasets affected;
.. Edition number and date of dataset involved;
.. Number of updates in the affected dataset.

. *Review of ENC Updates*. It must be possible for the Mariner to
review ENC updates applied through displaying the System Database
contents with the updates highlighted.
. *ECDIS Update Status Report.* It must be possible for the user to
inspect and demonstrate the up to date status of all datasets held
within the ECDIS against a complete list supplied by a service provider.
Details of the required update status reports for both electronic
chart and nautical publications datasets are given in <<annexC>>

=== New editions, re-issues, cancellations and updates of datasets

The method for detecting whether a dataset is a New Edition, re-issue,
cancellation, termination, or update is contained in the Exchange
Set metadata field S100_Purpose.

The behaviour of each is described below; note that individual Product
Specifications may not implement all types of dataset state. All datasets
include an issue date, and optionally an Edition and update number.

* New dataset - install new dataset and any included updates and record
for tracking purposes.
* New Edition - replace numbered old Edition and its updates with
the New Edition. The information in <<sec_13.2>> about the use of
New Editions and re-issues for certain coverage data products should
be kept in mind
* Update - apply the numbered update and retain for tracking purposes.
See <<sec_20.4>>. Where updates cannot be applied a permanent indication
"Chart information not up to date" must be available in the chart
display area when such a chart is in use (either displayed on chart
area or used as largest scale available for chart related alerts and
indications). This is also referenced by the ECDIS Update Status Report,
<<annexC>>.
* Re-issue - replace the original datasets and its updates up to the
date of the issue with the reissued dataset. Retention of the old
issue should be as specified in the Product Specification. The information
in <<sec_13.2>> about the use of New Editions and re-issues for certain
coverage data products should be kept in mind. After a re-issue, subsequent
updates may be incorporated from this reissue or from the original
data kept continuously updated.
* Cancellation - delete the cancelled dataset and its updates as per
S-100 17-4.4.1. The system must report any dataset(s) that have been
identified as cancelled at load time. A message must be displayed
informing the user of the dataset name. Depending on the method adopted
by the OEM for managing cancelled datasets one of the following conditions
must be observed: (1). The cancelled dataset cannot be viewed in the
ECDIS; (2). The cancelled dataset can be viewed in the ECDIS with
the warning message specified "Dataset <name> has been cancelled and
may not be up to date. Under no circumstances should it be used for
primary navigation".

== Dataset Support Files

Exchange sets delivered to ECDIS only contain S-100 datasets, any
required dataset support files, S-100 catalogues (feature and portrayal
catalogues) and language packs, referred to as "system support files".

The ECDIS must support the import of exchange set contents into the
System database. There is no requirement to import or update any other
content from an exchange set. This includes any of S-100's component
schemas and system support files associated with those schemas.

As defined in S-100 Part 17, each dataset support file references
one or more datasets which contain a reference to it. Language packs
(S-100 Part 18) reference the feature catalogue they refer to.

=== Exchange set delivery

Exchange sets which contain base datasets will also contain all relevant
dataset support. Exchange sets containing updates will deliver any
dataset support files which are required by those updates. This may
not be necessarily all the dataset support files associated with the
base dataset.

=== Management of automatic updates to Dataset Support files

Dataset names in S-100 are unique (S-100 Part 17). Dataset support
files are referenced to one or more datasets in the exchange catalogue
metadata. This allows dataset support files to be shared between multiple
datasets.

As with datasets, dataset support files are managed with the Exchange
Set metadata field S100_SupportFileRevisionStatus. The behaviour of
each is described below:

* _new_ - A new dataset support file to be installed on the system
* __replacement__ - a replacement for an existing dataset support
file with the same name.
* _deletion_ - deletion of the dataset support file with the given
name (subject to the guidance in this section)

When a feature pointing to a text, picture or application file is
deleted or updated so that it no longer references the dataset support
file, the ECDIS must check to see whether any other feature references
the same dataset support file, before that dataset support file is
deleted.

Similarly, when a dataset support file is marked for deletion by a
CATALOG.XML entry then the ECDIS must check that the support file
is not used by any other datasets prior to deletion.

// left it

=== Dataset Support File formats.

From all possible support file formats, ECDIS must at least be able
to display the following (taken from the list of support file formats
in S-100 Part 17 S100_SupportFileFormat enumeration)

* Plain text
* JPEG 2000
* TIFF 6.0

All dataset support files except the graphic formats use UTF-8 encoding.

System support files (feature and portrayal catalogues, and language
packs) are in XML format.

[[annexA]]
[appendix]
== Manual Updates

=== Introduction

Manual updates are data entered manually into the ENDS/ENC. Manual
updates are entered by the mariner to add, delete or modify features
in an ENC. In order to provide a harmonised and consistent approach
to manual updates on the ECDIS a set of portrayal symbols is supplied
alongside this publication. As a minimum, the symbols and attributes
listed in <<table_8>>, <<table_9>> and <<table_10>> must be supported.

Indications and alerts must be triggered as for all official ENC data.

In order to provide a harmonised and consistent approach to manual
editing and update on the ECDIS a set of portrayal symbols is supplied
alongside this publication. These symbols, contained within an S-100
portrayal catalogue and feature catalogue allow the OEM to implement
a manual update and editing feature on the ECDIS.

A visual index of the supplied symbols is provided in this Appendix
in the following tables.

[[table_8]]
.Manual Update Point Symbols
[cols="155,194,214"]
|===
h| Symbol h| Suggested attributes h| Example

| Depth | Depth ValueInformation.text
a|
[%unnumbered]
image::figure-table-8-1.png["",185,45]

| Underwater | Information.text
a|
[%unnumbered]
image::figure-table-8-2.png["",149,39]

| Wreck | As per Wreck feature in S-101
a|
[%unnumbered]
image::figure-table-8-3.png["",85,30]

| Obstruction | As per obstruction feature in S-101
a|
[%unnumbered]
image::figure-table-8-4.png["",104,30]

| Beacon | As per general purpose beacon in S-101
a|
[%unnumbered]
image::figure-table-8-5.png["",113,52]

| Buoy | As per general purpose buoy in S-101
a|
[%unnumbered]
image::figure-table-8-6.png["",89,56]

| Caution (Vicinity) | Caution Area
a|
[%unnumbered]
image::figure-table-8-7.png["",170,31]

[%unnumbered]
image::figure-table-8-8.png["",125,77]

| Caution (Object Missing) | Caution Area
a|
[%unnumbered]
image::figure-table-8-9.png["",170,58]

|===

[[table_9]]
.Manual update: Curve symbols
[cols="116,118,223"]
|===
h| Symbol h| Suggested attributes h| Example

| Danger |
a|
[%unnumbered]
image::figure-table-9-1.png["",221,178]

| Cable |
a|
[%unnumbered]
image::figure-table-9-2.png["",318,115]

| Other |
a|
[%unnumbered]
image::figure-table-9-3.png["",329,70]
|===

[[table_10]]
.Manual update: Surface symbols
[cols="132,141,289"]
|===
h| Symbol h| Suggested attributes h| Example

| Restricted Area |
a|
[%unnumbered]
image::figure-table-10-1.png["",275,180]

| Caution Area |
a|
[%unnumbered]
image::figure-table-10-1.png["",269,131]

| Other |
a|
[%unnumbered]
image::figure-table-10-1.png["",165,185]
|===

=== Attribution of Manual Update Features

Features added by manual updates must support attribution as defined
in the Manual Updates feature catalogue. A feature catalogue containing
the data structures which must be supported by the manual updates
also accompanies this publication.

The supplied feature catalogue contains a restricted set of features
and attributes compatible with those used for S-101 electronic charts
which enable portrayal and required alert and indication processing
to be carried out on manually entered updates.

[[annexB]]
[appendix]
== S-100 Data Import Error Codes and Explanations

=== Introduction.

Loading, Updating, Authentication and Decryption error codes and messages
are defined in this section. It is expected that application developers
may also support the error conditions with an appropriate error message.

When an error occurs, this can in some instances, prevent further
processing of data.

Standardised error codes must be used to communicate problems with
import of datasets, data support files and catalogues into the ECDIS.
These are defined in the following table.

[[table_B-1]]
.Error codes and messages
[cols="65,502"]
|===
h| Error Code h| Error Message

| *SSE 101* | _Self Signed Key is invalid_
| *SSE 102* | _Format of Self Signed Key file is incorrect_
| *SSE 103* | _Signed Data Server Certificate is invalid_
| *SSE 104* | _Format of SA Signed DS Certificate is incorrect_
| *SSE 105* | SA Digital Certificate (X509) file is not available. A valid certificate can be obtained from the IHO website or your data supplier
| *SSE 106* | The SA Signed Data Server Certificate is invalid. The SA may have issued a new public key or the dataset may originate from another service. A new SA public key can be obtained from the IHO website or from your data supplier
| *SSE 107* | _SA signed Data Server Certificate file is missing. A valid certificate can be obtained from your data supplier"_
| *SSE 108* | SA Digital Certificate (X509) file incorrect format. A valid certificate can be obtained from the IHO website or your data supplier
| *SSE 109* | Dataset Resource Digital Signature is invalid
| *SSE 110* | Dataset Permits not available for this Data Server. Contact your data supplier to obtain the correct permits.
| *SSE 111* | Dataset Permit not found. Load the permit file provided by the data supplier.
| *SSE 113* | Dataset Permit is invalid (checksum is incorrect) or the Dataset Permit is for a different system" Contact your data supplier and obtain a new or valid permit file.
| *SSE 114* | Incorrect system date, check that the computer clock (if accessible) is set correctly or contact your system supplier.
| *SSE 115* | Subscription service has expired. Please contact your data supplier to renew the subscription licence
| *SSE 117* | User Permit is invalid (checksum is incorrect). Check that the correct hardware device (dongle) is connected or contact your system supplier to obtain a valid User Permit.
| *SSE 118* | HW_ID has incorrect format
| *SSE 120* | Subscription service will expire in less than 30 days. Please contact your data supplier to renew the subscription licence
| *SSE 121* | Decryption failed no valid dataset permit found. Permits may be for another system or new permits may be required, please contact your supplier to obtain a new licence
| *SSE 122* | One or more of the SA Digital Certificate or Domain Controller certificates (X509) have expired. A new SA public key can be obtained from the IHO website or from your data supplier
| *SSE 123* | Non sequential update, previous update(s) missing try reloading from the base media. If the problem persists contact your data supplier
| *SSE 125* | The permit for dataset < name> has expired. This dataset may be out of date and MUST NOT be used for Primary NAVIGATION
| *SSE 126* | This Dataset is not authenticated by the IHO acting as the Scheme Administrator
| *SSE 127* | Dataset <dataset name> is not up to date. A New Edition, Re-issue or Update for this cell is missing and therefore MUST NOT be used for Primary NAVIGATION
| *SSE128*  | Error processing <file name>. The format or content could not be parsed and it could not be installed
| *SSE129*  | This Catalogue is not authenticated by the IHO acting as the Scheme Administrator
| *SSE130*  | Warning: Dataset <dataset name> is not up to date. A New Edition or Update for this cell is missing
| *SSE131*  | Error: No Feature Catalogue or Portrayal Catalogue could be found compatible with dataset <dataset name>
| *SSE132*  | Signature Path can not be validated. One or more of the Domain Controller or SA digital certificates is missing or invalid
| *SSE133*  | Version mismatch between <dataset> and <catalogue>. Only <catalogue version> is supported for data of this type (<product>)
| *SSE134*  | This Exchange Set is not authenticated by the IHO acting as the Scheme Administrator
| *SSE135*  | This Permit file is not authenticated by the IHO acting as the Scheme Administrator

|===

=== Error code descriptions.

*SSE 101* must be returned when a self signed key (SSK) cannot be
validated against the public stored as part of the SSK. The data server
must check that its own SSK is valid before sending it to the SA.
The SA will confirm the data server SSK before returning the SA signed
data server certificate.

*SSE 102* is returned if the SSK is wrongly formatted or if mandatory
elements are missing. SA and data servers must complete this check.

*SSE 103* is returned if the Signed data server certificate does not
authenticate correctly against the SA public key or any Domain Controller
Intermediaries. This validation process must be carried out by the
SA or Domain Controller before supplying it to the data server. The
data server must also validate a received certificate. The data client
must validate the digital signature against any file prior to its
use.

*SSE 104* must be returned if the SA signed data server certificate
is wrongly formatted. This must be carried out by the data server
on receipt from the SA.

*SSE 105* must be returned if there is no SA certificate installed
on the data client.

*SSE 106* must be returned if the SA digital certificate (public key)
does not validate against the following:

* SA digital certificate will not validate against the SA public key.
* One or more of the Domain Controller certificates do not validate
against the SA certificate.

*SSE 107* must be returned if the SA signed data server certificate
is not available to the data server for checking or is not present
in the Exchange Set Catalogue file when the data client attempts to
authenticate it.

*SSE 108* must be returned if the SA public key held in the SA digital
certificate is wrongly formatted or the certificate file is unreadable.

*SSE 109* must be returned if any resources (dataset or supplementary
file) in the Exchange Set Catalogue do not authenticate against the
SA authenticated data server public key or Domain Controller authenticated
public key contained in the Exchange Set Catalogue metadata.

*SSE 110* must be returned if there are no dataset permits available
for a particular data server corresponding to encrypted data within
the Exchange Set being loaded.

*SSE 111* must be returned if there are no permits installed on the
system for a requested dataset.

*SSE 113* must be returned if the calculated CRC of an individual
dataset permit does not validate against the CRC held in that cell
permit. [Data Clients] This may be a HW_ID problem, corruption during
transmission or the permits are for a different system.

*SSE 114* must be returned if the system date does not agree with
the date obtained from any alternative, reliable date source; for
example, GPS. [Data Clients]

*SSE 115* must be returned if the expiry date of the dataset permit
has an earlier date than that obtained from the validated system date.
[Data Clients]

*SSE 117* must be returned if the CRC contained in the User Permit
does not validate against the calculated CRC of the extracted HW_ID.
[Data Servers]

*SSE 118* must be returned if the if the decrypted HW_ID extracted
from the User Permit is incorrectly formatted. [Data servers]

*SSE 120* must be returned if the subscription licence is due to expire
within 30 days or less.

*SSE 121* must be returned if a valid dataset key (decryption key)
cannot be obtained from the relevant dataset permit to enable the
system to decrypt the corresponding dataset.

*SSE 122* must be returned if the SA Digital Certificate or any of
the intermediate Domain Controller Certificates have expired. "Expired"
is when the X.509 *_"Valid to"_* date in the certificate is older
than the validated system date.

*SSE 123* must be returned if a dataset update being imported is not
sequential with the latest update already contained in the ENDS/System
Database for any given dataset. Under these conditions the update
process (for the dataset) must be terminated and the ECDIS is to display
a warning when the dataset is displayed stating that it is not up
to date and should not be used for navigation.

*SSE 125* must be returned if the stored permit for any given dataset
has expired. It should be possible to view the dataset but a permanent
warning message must be displayed informing the user; for example,
_"The permit for dataset <name> has expired. This dataset may be out
of date and</name> MUST NOT be used for Primary NAVIGATION"._

*SSE 126* must be returned if a signed resource (dataset, catalogue
or permit) in an Exchange Set is authenticated against a certificate
or public key file stored on the Data Client other than the one provided
by the SA. In a chain of digital signatures the root certificate must
be the SA certificate.

*SSE 128* must be returned if one or more dataset resources
(datasets, catalogues or permits) could not be loaded because the
contents could not be validated according to the versions of the (XML)
Schemas installed on the system. Only conformant content may be loaded
onto any S-100 system.

*SSE 129* must be returned if the Catalogue to be installed
(Feature or Portrayal) has not been directly authenticated by the
Scheme Adminstrator (as identified according to <<sec_9.1>>).

*SSE 131* must be returned if a dataset has no Feature Catalogue or
Portrayal Catalogue installed.

*SSE 132* must be returned if any digitalSignatureValue for a resource
(whether dataset, supplementary file or permit) is missing or fails
validation.

*SSE 133* must be returned if the dataset being installed is of a
version which is not compatible with a Feature Catalogue or Portrayal
Catalogue installed on the system.

*SSE 134* must be returned if the CATALOG.XML digital signature (CATALOG.SIGN)
cannot be authenticated against the Scheme Administrator's certificate,
either through the data server's signed public key or any specified
intermediate Domain Controllers. The contents of the Catalogue must
not be installed if the signature is invalid.

*SSE 135* must be returned if the PERMIT.XML digital signature (PERMIT.SIGN)
cannot be authenticated against the Scheme Adminstrator's certificate,
either through the data server's signed public key or any intermediate
Domain Controllers.

The flow diagrams in this Appendix show the conditions under which
the SSE codes are displayed. These diagrams only relate to processes
carried out on the ECDIS for import of exchange set contents.
Data Server and Scheme Administrator processes are not defined here.

=== Exchange Set Installation on ECDIS

This section describes the sequence of actions to import Exchange
Set contents. This content is always digitally signed and may optionally
be encrypted.

Before exchange sets are imported to ECDIS the CATALOG.XML must initially
be authenticated against the digital signature contained in the CATALOG.SIGN
file. This is described in the following flow diagram.

[[fig_5]]
.Verification of CATALOG.SIGN
image::figure-05.png["",514,304]

If encrypted data is to be imported into the ECDIS, before any permits
are imported to ECDIS the PERMIT.XML must initially be authenticated
against the digital signature contained in the PERMIT.SIGN file.

[[fig_6]]
.Verification of PERMIT.SIGN
image::figure-06.png["",436,258]

Once the CATALOG.XML is authenticated and, where encrypted data is
to be imported, the PERMIT.XML is first authenticated, then the contents
of the exchange set may be imported.

Encrypted data is imported into the System Database. For encrypted
data the following process is used to establish the validity of the
PERMIT.XML contents (after the PERMIT.XML is successfully authenticated
against the digital signature in the PERMIT.SIGN) and its contents
in respect of the end user's subscription details. This is only for
use with datasets which are encrypted and should be carried out prior
to dataset file decryption according to S-100 Part 15.

[[fig_7]]
.Check for permit validity prior to dataset decryption
image::figure-07.png["",604,272]

Once encryption and compression has been processed the digital signatures
for all Exchange Set contents to be imported can be processed. These
signatures can form a chain of authentication and the following flow
diagram illustrates how signatures must be processed.

[[fig_8]]
.Authentication of Exchange Set dataset components
image::figure-08.png["",628,482]

Under S-100 Part 15 datasets and other Exchange Set components may
have multiple digital signatures, with each signature referenced to
a signed public key certificate. Each Exchange Set contains all relevant
certificates with the exception of the SA digital certificate which
is installed separately by the end user.

Using the flow shown in <<fig_8>> the chain of certificates for dataset
components, permits and the CATALOG.XML itself can be authenticated.

If more than one signature exists for a dataset or dataset support
file then all signatures must be verified before successful import.

Full documentation of authentication processes and technical details
are contained in S-100 Part 15.

Certain Exchange Set contents control the behaviour of the ECDIS and
may only be digitally signed by the Scheme Administrator. These categories
of content comprise the Feature Catalogues and Portrayal Catalogues
should be authenticated using the following process.

IHO standards determine the content and revision of such Catalogues.
The following flow diagram describes the authentication of catalogues
prior to their import into the ECDIS.

[[fig_b-9]]
.Authentication of Feature and Portrayal Catalogues
image::figure-b-09.png["",477,337]


[[annexC]]
[appendix]
== ECDIS Update Status Reports

=== Purpose

This Appendix elaborates the definition of an "up to date" dataset.
This is required by the IMO Performance Standards and all ECDIS users
are required to be able to demonstrate to a vetting inspector that
their ECDIS and its installed datasets are "up to date".

This Appendix specifies the format and content of an "Update Status
Report" which will demonstrate the revision status of datasets within
the ENDS/System Database of the ECDIS. The ECDIS must, therefore,
implement two Update Status Reports:

. An ENC Update Status Report, which reports the contents of electronic
charts and directly related information.
. An ENP (Electronic Nautical Publication) Update Status Report which
reports the status of ENPs

[discrete]
==== Use and Responsibility

An Update Status Report is designed as a concise and standardised
format to assist end users in satisfying themselves that their data
is "up to date" and help satisfy inspection requirements in that respect.

The report is designed for two individual use cases:

. To ensure that all navigational data loaded into the System Database
is up to date for a section of a particular route
. To ensure that all navigational data loaded into the System Database
is up to date.

All S-100 datasets use Edition and, sometimes, update numbers to denote
their individual revision (see S-100 Part 17 for details). These numbers
uniquely identify how up to date a dataset is. The difficulty with
using Edition/update numbers in isolation is that they do not document
the date of revision of all datasets relative to the installation
date of a data server's service giving the end user no indication
of whether a dataset (or a collection of datasets) is up to date with
respect to the last dataset installed.

S-100 supports the creation and distribution of IHO S-128 data which
provides an issue date within its metadata for an entire data service
as well as a snapshot of the Edition and update information for all
component datasets within a data service. The issue date of the last
delivered S-128 dataset is used in each update status reports to provide
a reference date for every dataset either on a section of the vessel's
route or for the System Database as a whole.

The driving use case for the Update status report is that an inspector
(for example flag State, port State or vetting) or end user can check
that an ECDIS is up to date with respect to the last dataset installed
from each data server's data within the System Database.

Note that this report specification is not a concrete definition of
what an "up to date" dataset (or ECDIS) is; it only shows a status
of each dataset with respect to the last data installed on the system.
If a period of time has passed since the last update then some data
may well be "out of date" relative to the time the report is run -
the report only records the up to date status relative to the last
data installed (the date being defined by the issue date of the latest
S-128 dataset). The equipment manual should explain terms "up to date"
and "out of date".

This report only reports the status of datasets delivered as part
of a data service using S-100 Part 17 Exchange Set metadata and
(as part of dual-fuel mode) IHO S-57 datasets (as illustrated in the
hybrid Exchange Set in S-100 Part 17, clause 17-4.2). Where other
S-100 datasets are installed on the system from other sources
(for example, Unencrypted ENCs) then they should be displayed with
a status of "unknown". The Equipment manual should explain terms "unknown".

This Appendix provides a specification for a report which can be run
on a compliant ECDIS to determine the status of S-100 datasets held
within the System Database.

[discrete]
==== Completeness and Up-to-datedness

Update status reports report whether the data which is installed in
the system database are all up to date with reference to the one or
more S-128 datasets, which together represent the status of a service
provider's entire service.

Update status reports may also show whether there are any items contained
in the combined S-128 service which are not installed in the system
database. This represents a "Completeness" status on a product by
product basis.

The primary use case for the completeness feature is to assess the
installation of S-124 Navigational warnings against the in force bulletins
produced by navigational warning providers.

Completeness reports must be able to be restricted to individual products.
They may be referenced to either S-128 datasets, or individual S-124
Navigational Warning datasets representing in-force bulletins.

[discrete]
==== Product Independence.

When update status reports are reporting "up to datedness" the following
points must be borne in mind

* S-128 datasets from multiple sources must be combined together to
form a complete picture of what is "available" from service providers.
When they are combined the most recent dates of any content should
be used as the reference against which the report is generated.
* S-128 datasets are "official" data by definition and have a data
producer status (as defined in section )
* S-128 datasets containing only a single product only contain revision
for that product, not other products which may be contained in other
S-128 datasets. This is to ensure that products with a high rate of
update do not invalidate the revision status of other less frequently
updated products. For example, a vessel may have an S-128 dataset
initially installed with a mixture of S-101, S-102 and S-104 data.
When approaching a port requiring more up to date S-104 data a new
exchanges set containing updated S-104 data and an accompanying S-104-only
S-128 dataset may be installed. This does not change the revision
status of the S-101 data on the ECDIS. If the vessel installs a more
up to date mixed exchange set (with S-101, S-102 and S-104) then the
S-128 it contains is then used as the reference for the up to date
status reports

[discrete]
==== Report Definitions

[discrete]
==== Report Contents

The mariner must be able to select the type of report to be created:

. An ENC Update Status Report, which reports the contents of electronic
charts and directly related information. This report shows the status
of IHO S-100 datasets of the following product types:
.. ENC, either S-101 or S-57
.. S-102
.. S-104
. An ENP (Electronic Nautical Publication) Update Status Report which
reports the status of ENPs. All other S-100 products (with the exception
of S-128 itself) installed in the System Database are in this category.

The report name at the top of the report header shows the type of
Report being produced.

[discrete]
==== Report Filters

The mariner must be able to select the report filter to be one of
the following:

. A report detailing the status of all datasets within the System
Database of the ECDIS for the appropriate type (ENC or ENP). This
shows the status of the datasets with respect to the date contained
in the S-128 dataset of the last update for each data server's service
installed.
. A report detailing the status of each S-100 dataset along a predefined
section of a route contained within the ECDIS.

[discrete]
==== Example

An example of an Update Status Report for current ECDIS with S-57
ENCs is shown in the <<fig_c1>>, followed by an illustrative revised
report for S-100 datasets in <<fig_c2>>. The example shown is an ENC
Update Status Report.

[[fig_c1]]
.Update Status Report - current report example
image::figure-c-1.emf["",524,366]

[[fig_c2]]
.Update Status Report - notional example for S-100 datasets
image::figure-c-2.emf["",572,312]

[discrete]
==== Report specification

The ENC Update Status Report is a formatted output from the ECDIS.
It should be formatted to fit within the width of the ECDIS screen
and, if printable, split into individual A4 pages.

Reports of both types (complete System Database contents and filtered
by route) are divided into two sections:

. A header containing information on the vessel and report content
selected (either filtered for a route (or part of a route) or for
the entire System Database contents. This header contains vessel information
and report reference dates followed by a summary totals for each report
status.
. A table containing information for each cell within the chosen content
type. This provides detailed information on each dataset within the
chosen content category.

[discrete]
==== Report header

The data content of each of the header fields is defined in <<table_3>>
below:

[[table_c3]]
.Data content of header fields
[cols="183,62,312"]
|===
h| Field Name. h| Type h| Source
a|
. Report Name

| Text
a| Two Report names are possible depending on which Report is being
shown. Either:

* Electronic Navigational Charts (ENC) Update Status Report
* Electronic Nautical Publications (ENP) Update Status Report

a|
[start=2]
. Vessel Name

| Text
| The name of the vessel as recorded within the ECDIS.

a|
[start=3]
. Identifier

| Text
| A unique identifier, the MMSI or vessel IMO number.

a|
[start=4]
. Update reference date

| Date
| The data used as the reference for the status of each of the cells.
This is the issue date of the last S-128 dataset in the Exchange Set
used to update the System Database. The date is taken from the latest
S-128 datasets issueDate in the CATALOG.XML and is expressed in ISO8601
notation:[*YYYMMDDZHHMMSS*]

a|
[start=5]
. Date of report

| Date
| The date the Report was run.

a|
[start=6]
. Content

| Text
a| Each Report can be optionally filtered for an individual route
plan or report the full System Database contents for each Report type:

* "Filtered for Route Plan XXX to YYY" where XXX and YYY are the textual
names of the point of origin and destination on the chosen route.
* Full System Database contents.

a|
[start=7]
. Start WP

| Text
| This field is only present if the Report is filtered for a route.
It should comprise the textual name of the starting waypoint of the
route (if one exists) and the lat/long coordinates of the waypoint.
There is no fixed form that the coordinates should take.

a|
[start=8]
. End WP

| Text
| This field is only present if the Report is filtered for a route.
It should comprise the textual name of the last waypoint of the route
(if one exists) and its lat/long coordinates. There is no fixed form
that the coordinates should take.

|===

[discrete]
==== Filtering of Update status report for route section

Where an Update Status Report is filtered for a route plan then the
datasets of the appropriate type (ENC or ENP) in the System Database
whose status are checked are defined by the intersection of the route
corridor with the dataset boundaries (as defined by dataset's coverage
features (or coverage defined in the S-100 CATALOG.XML within the
System Database)).

The width of the filtering corridor is equal to the
"user specified distance" implemented inside the ECDIS to fulfil IMO
MSC.532(106) _11.3.5:_

____
A graphical indication should be given if the mariner plans a route
closer than a user-specified distance from the boundary of a user-selectable
category of prohibited area or a geographic area for which special
conditions exist (see appendix 4). A graphical indication should also
be given if the mariner plans a route closer than a user specified
distance from a user-selectable category of point objects, such as
a fixed or floating aid to navigation or isolated danger. The user-selectable
categories should be the same as the user selections for the display
of objects and be based on IHO standards. There should be a permanent
indication when any user-selectable categories are deselected. Details
of the deselection should be available on demand.
____

This is not the same as the XTD distance.

[discrete]
==== Summary totals

The summary section of the Report follows directly after the header.
The summary contains the following information:

. The title: "Chart Status Summary".
. Totals of cells with the relevant status in the order defined below.

.. Total - the total number of datasets available in the System Database
for the content type (ENC or ENP), selected for the Report (either
full or filtered by route).
.. Up to date - the total number of datasets (for the content selected)
which have status "Up to date".
.. Not up to date - the total number of datasets (for the content
selected) which have status "Not up to date".
.. Withdrawn - the total number of datasets (for the content selected)
which have status "Withdrawn".
.. Cancelled - the total number of datasets (for the content selected)
which have status "Cancelled".
.. Unknown - the number of datasets for which a status cannot be determined
for any reason.
. The possibilities for each dataset's status are listed in <<table_4>>
below along with their definitions.

[discrete]
==== Data Server content tables

The detailed tables in each Report are arranged by data server - each
separate data server or dataset data source within the System Database
has its own separate table listing all datasets by content type
(as reported in the "Content" field in the report header) and S-100
Product Specification order.

The detailed tables contain the following information:

. Title: Data Server Name - this is the data server identified by
the S-128 Producer Code (which can either be a data producer, an aggregator
or data aggregator (as identified by <<sec_9.1.1>>)
. For each cell installed in the System Database from the data server:

.. Dataset Name - the name of the dataset. (DSNM).
.. Edition - the Edition of the dataset in the System Database (EDTN).
.. Update - the update number of the dataset in the System Database.
If the product does not support updates, then this must be
labelled "-".
.. Issue Date - the issue date of the last applied update to the dataset
in the System Database (or "-" where no updates are supported for
the S-100 product).
.. Status - the status of the cell. The status may have one of four
values determined according to the criteria in the following table:

[[table_c4]]
.Status values
[cols="27,116"]
|===
h| Status h| Specification

| *Up to date* | This is where the System Database has all the latest
Edition and (where supported by the S-100 Product Specification) update
information for the dataset installed as defined by the latest S-128
dataset received from the data server. The reference date for the
most up to date information is defined by the S-128 dataset issue
date. The dataset update reference date must be within the last four
weeks from the time of the Report execution or the cell must be displayed
as "Not up to date" regardless of its status as defined by the S-128
data.
| *Not Up to date* | This is where the System Database has NOT installed
all the latest update and/or New Edition for the cell. Again, the
reference point for what should be installed is defined by the S-128
dataset issue date. If the reference date is older than four weeks
then cells must be displayed as "not up to date" by definition.
| *Withdrawn* | The number of datasets which have been withdrawn by
the data server or cancelled but which are still available within
the System Database.
| *Unknown* | Datasets for which a status cannot be determined for
any reason. If the revision information in the latest S-128 dataset
is incomplete for any reason then all datasets in the data server's
service not included in the partial S-128 must be deemed to be "Unknown"
as no definitive information on them can be determined. S-128 content
is required to specify the status of all datasets in a data server's
service.

|===

[discrete]
==== Example of ENC update status report

*_Report Name: ENC Update Status Report_*

*Vessel Name:* HMS Goteborg

*Identifier:* IMO 4653321

*Update Reference Date:* 16 May 2013

*Date of Report*: 1 Jun 2013

*Content:* Full

*Chart Status Summary:*

*Chart Status: Count*

Total: 50

Up to Date 38/50

Not Up to Date 10/50

Withdrawn 2/50

Unknown 0/50

*_Table:_*

.Data Server: XXXX
[cols="84,101,84,84,84,83",options="unnumbered"]
|===
h| Product h| Dataset Name h| Edition h| Update h| Issue Date h| Status
| *S-101* | *101US23495820* | *10* | *4* | *2020-01-02* | *Up to Date*
|===

*Example of ENP update status report*

*_Report Name: Electronic Nautical Publications (ENP) Update Status Report_*

*Vessel Name:* HMS Goteborg

*Identifier:* IMO 4653321

*Update Reference Date:* 16 May 2013

*Date of Report*: 1 Jun 2013

*Content:* Full

*Chart Status Summary:*

*Chart Status: Count*

Total: 50

Up to Date 38/50

Not Up to Date 10/50

Withdrawn 2/50

Unknown 0/50

*_Table:_*

[cols="83,100,83,84,83,82",options="unnumbered"]
|===
6+h| Data Server: XXXX
h| Product h| Dataset Name h| Edition h| Update h| Issue Date h| Status

| *S-123*   | *123US3245394* | *5*       | -        | *2020-01-02* | *Up to Date*
| *S-127*   | *127US2345032* | *6*       | -        |              |
|===

[[annexD]]
[appendix]
== Enhanced Safety Contour and Water Level Adjustment

=== Enhanced Safety Contour

This Appendix defines how the "**Enhanced Safety Contour**" (ESC)
feature is defined and implemented.

Enhanced Safety Contour, or ESC, means creation of the safety contour
from the bathymetric grid data based on the value set by the user.

NOTE: On an S-100 ECDIS with the Enhanced Safety Contour feature switched
off (or an S-57 ECDIS), the user sets the value for the safety contour,
but if the exact value is not found from the available depth information
then the safety contour defaults to the next deepest which may be
over 10 metres deeper than the value set by the user. The Enhanced
Safety Contour feature addresses this issue.

The contents of this Appendix are not currently integrated with the
existing S-100 portrayal mechanisms specified in S-100 Edition 5.2.0
Part 9. This may be rectified in future editions of S-100. Until then,
this appendix contains the normative specification for these features
and may use different language, terms and conventions than S-100 itself.

In these processes an end user selects:

. Suppression of specific S-101 features by S-102.
. A Safety Contour value of their choice.

When a user selects a safety contour value, outside areas of S-102
coverage the source for the displayed safety contour is the existing
S-101 ENC (or S-57 ENC in dual-fuel mode).

When the safety contour has been generated from S-102 data then the
area over which it is generated, that is the S-102 coverage area,
must be surrounded by a boundary line using colour token DEPWL
footnote:[colour token DEPWL, stem:[xyL] values are: DAY
stem:[x = 0.15], stem:[y = 0.15], stem:[L = 30.0]; DUSK
stem:[x = 0.15], stem:[y = 0.15], stem:[L = 7.5]; NIGHT
stem:[x = 0.15], stem:[y = 0.15], stem:[L = 1.2]] see <<fig_D-1-1>>.

// [[fig_D-1-1]]
// .Boundary line of S-102 coverage
// image::figure-d-1-1.emf[]

[[sec_D-1.1]]
==== Data Constraints

. Portrayal of S-102 data and application of ESC must be restricted
by minimum and maximum display scale values contained in the exchange
catalogue as specified in <<sec_12.2>>.
. Coverage - S-102 data is not expected to overlap, but in case of
overlap the ECDIS must indicate an overlap by the text "OVERLAP" and
the user must have the ability to select which producer in the overlapped
area has priority and will be selected for processing safety contour.
.. Overlaps are strictly defined as those between grid cells containing
data, as opposed to grid cells with no-data (fill) values. Both individual
datasets and separate datasets may overlap, most commonly at national
borders, but also in areas where there are multiple vertical datums
within a single dataset. In these cases
... Overlaps within the same dataset (in areas with multiple vertical
datums) the overlap must be resolved by taking the shoalest value
for each grid cell within the intersection. This is also used to resolve
situations when the Mariner Selected Viewing Scale (MSVS) means that
multiple grid cells are to be portrayed at the same screen position
(the common point rule) - most often when the grid is being portrayed
at a smaller zoom scale than the dataset resolution.
... Overlaps between different producers. The end user must be able
to select which dataset (or data producer) they wish to use.
. No complex interpolation is required between points in the S-102
grid. Nearest neighbour is used to define the depth in each S-102
point's neighbourhood (that is, the same depth everywhere within the
grid square), regardless of any interpolationType defined for the
S-102 dataset (S-100 Part 8, clause 8-7.1.4), as illustrated by <<fig_D-1-2;and!fig_D-1-3>>:
+
--
[[fig_D-1-2]]
.The extents of the S-102 points overlaid on the S-102 grid (grid spacing = 'd')
image::figure-d-1-2.png["",261,227]

[[fig_D-1-3]]
.Extents of each S-102 points showing nearest neighbour interpolation (S-100 Part 8-7.1.4)
image::figure-d-1-3.png["",438,173]
--

. Only rectangular grids for S-102 are allowed. The method outlined
may be extended to other grids; for example, triangular grids in the
future.
. Enhanced Safety Contour can only be processed in areas where the
Sounding Datum of suppressed S-101 features is the same as the vertical
datum of the S-102 Coverage.

[[sec_D-1.2]]
==== Enhanced Safety Contour Selection and Implementation

The user must be able to select S-102 to be used as the source of
the depth information and the Enhanced Safety Contour.

The Enhanced Safety Contour must be enabled by default.

When S-102 is selected for use, in areas where S-102 coverage exists,
the S-102 suppresses the drawing instructions associated with the
following S-101 depth features

. Depth Area
. Dredged Area
. Depth Contour

This also suppresses the safety contour, the shallow water pattern,
the catzoc pattern, text indicating the dredged depth and contour
labels.

The process to construct the enhanced safety contour then consists
of a selection of common edges from rectangular extents for each S-102
dataset point, as shown in <<fig_D-1-4>>.

[[fig_D-1-4]]
.Common edges from rectangular extents
image::figure-d-1-4.png["",257,230]

Common edges are selected when the S-102 points on either side of
them lie on either side of the boundary of the safety contour value.
In <<fig_D-1-5>> below, 11.5 metres is the threshold value set by
the user.

Edges on the boundary of the dataset, or which lie on an edge common
with undefined S-102 values, are selected if the S-102 value is less
than or equal to the safety contour value; for example, see <<fig_D-1-5>>:

[[fig_D-1-5]]
.Edges from rectangular extents and at boundaries
====
image::figure-d-1-5-1.png[]

image::figure-d-1-5-2.png[]
====

The source of the displayed safety contour are the selected edges
as defined. The areas of safe and unsafe water formed by the selected
edges are used for processing of the safety contour related alarms
under IMO MSC 530(106) 11.4.3, which the OEM must implement.

=== Water Level Adjustment (WLA)

The user must be able to adjust depth information by water level height
in areas where both S-102 and S-104 data products are available.

. The system must default to no water level adjustment.
. The mariner must be able to select one of the following methods
of depth adjustment:

.. Current (or user selected) date and time;
.. A mariner specified date and time period;
.. Where the route includes a schedule, the predicted date and time
of transit in each area along a route

. When Water Level Adjustment is activated as defined in this section:

.. The functionality and portrayal of the safety contour, depth zone
shades, safety depth and indication of isolated dangers must use the
adjusted depth;
.. The ECDIS pick report must indicate both adjusted and unadjusted
depth;
.. Details of the Water Level Adjustment must be readily available,
such as the data source, temporal extent, and applicable areas;
.. It must be possible to de-activate Water Level Adjustment via simple
operator action;
.. There must be a permanent indication as described in <<sec_D-2.5>>,
<<sec_D-2.6>> and <<sec_D-2.7>>.

. The ECDIS voyage recording must include:

.. The state of Water Level Adjustment (method applied);
.. The mariner specified date and time or date and time period when in use for WLA, or the scheduled date and time, the check area distance and the time resolution when in use for WLA.

==== Scope

This section defines how the "**ECDIS Water Level Adjustment feature**" is implemented. Water Level Adjustment is referred to in this section as WLA. This section defines how the adjustment of depth information by water level is provided for:

* __Selected single date and time;__
* __Selected date and time period;__
* _Linked to an estimated route schedule with selected check distance and time resolution._

==== Constraints on input data

. Coverage - S-104 data is not expected to overlap, but in case of an overlap of greater than one grid cell footnote:[In the case of a difference in resolution the maximum overlap is the size of the larger of the overlapping grid cell.] the approach must be same as for overlapping S-102 data. The ECDIS must provide a permanent indication of "Overlap" and the user *must* have the ability to select which producer in the overlapped area has priority and will be selected for processing WLA.

. As with S-102, each S-104 point is assigned a rectangular extent with nearest neighbour interpolation.

. WLA must not be applied unless the S-102 and S-104 features are on the same vertical datum. If the S-102 and S-104 features are not on the same vertical datum then an indication "Incompatible vertical datums" must be given to the user.

==== User Inputs

When WLA is selected for use, in areas where WLA coverage exists, one of the three different options must be used:

. WLA Option 1: WLA at a single date and time (current or user selected).
. WLA Option 2: WLA for a date and time period (from start date and time to end date and time).
. WLA Option 3: WLA linked to an estimated route schedule. In this case the user also specifies:

.. A distance parameter, the limit of the check area as specified by IMO MSC 530(106) 11.3.5 when route planning and MSC.530(106)/Rev.1 11.4.4 when route monitoring.
.. A time resolution stem:[t_u] used to construct the individual WLA sections. This time resolution reflects the uncertainty or tolerance of the time schedule of the route, for example 10 minutes if the user assumes that they could follow the time schedule within 10 minutes.

==== Implementation - general

WLA can be applied only in areas where there is data from both S-102 and S-104. For example, the intersection of the Red and Blue outline in <<fig_D-2-6>> below. WLA is applied to S-101 features after substitution of depths by S-102 as defined in <<sec_D-1.2>> and <<sec_D-3.1>>.

[[fig_D-2-6]]
.WLA can only be computed in areas where there is S-104 and S-102 data
image::figure-d-2-6.png["",308,200]

Further, WLA can only be carried out:

. When WLA option 1 or WLA option 2 is selected, where the temporal extent of the S-104 fully covers the required date and time instant or period selected by the user
. When WLA option 3 is selected, where the S-104 temporal extent of the S-104 fully covers the estimated date and time of a part of the route; see <<fig_D-2-16>>.

Where these conditions are not met the WLA processing must not be carried out.

When WLA has been processed the area for which it is defined must be surrounded by a boundary line using colour token DEPWL footnote:[Thick dark blue dash line, colour token DEPWL xyL values are: DAY x= 0.15, stem:[y = not 0.15], stem:[L = 30.0]; DUSK stem:[x = 0.15], stem:[y = 0.15], stem:[L = 7.5]; NIGHT stem:[x = 0.15], stem:[y = 0.15], stem:[L = 1.2.]]; see <<fig_D-2-7>>.

[[fig_D-2-7]]
.Boundary line of WLA coverage
image::figure-d-2-7.png["",444,246]

NOTE: In this example S-102 coverage is larger than WLA coverage.

In addition to the display of the boundary line of the WLA coverage there should be a permanent indication about the application of WLA and the applied date and time, see details in WLA Options 1, 2 and 3.

OEMs are free to design their user interface. Usable ideas include, for example, a mouse roller to change datetime, use of a slider to change datetime, or even to provide an animation from user selected start date and time to user selected end date and time.

[[sec_D-2.5]]
==== Implementation of WLA Option 1 - WLA for a single datetime instant

WLA is based on S-104 values closest to the selected datetime instant. Each S-102 point has an extent of coverage which is closest to it. Each S-104 point, similarly has an extent. The adjustment of the S-102 values is calculated by adjusting each S-102 point by the shoalest of the S-104 values, for all S-104 points whose extent intersects the extent of the S-102 point.

When an S-104 record does not exist for the precise time specified the shoalest of the two S-104 adjacent values is selected from the S-104 dataset. S-104 values can only be selected within the temporal extent of the S-104 dataset. In the example shown in <<fig_D-2-8>> (where S-104 values, "V" defined every 15 minutes and a user selected datetime of 07:24) the two values selected are 07:00 and 07:30, WLA would select 1.3m (the 07:00 value).

[[fig_D-2-8]]
.Selection of time-varying value
image::figure-d-2-8.png["",386,96]

In <<fig_D-2-9>> below, the S-102 point X is adjusted by the shoalest (that is, minimum) value of the S-104 values from (a), (b), (c) and (d) at the required datetime instant because the S-102 point extent overlaps the S-104 extents of a, b, c and d.

[[fig_D-2-9]]
.Adjustment of S-102 values by S-104
image::figure-d-2-9.png["",345,240]

Format of the permanent indication is as below:

*WLA 12:34 08 Nov 2021*

[[sec_D-2.6]]
==== Implementation of WLA Option 2 - WLA for a datetime range specified by the user as a time period

When WLA is based on a datetime range, then the process is identical to that followed for WLA Option 1 except each S-104 value selected is the shoalest of all values available in the S-104 within the selected time period.

All S-104 points contributing to the WLA must be defined across the time range required, otherwise the WLA is not computable and the user must be informed. The S-104 records selected are those which lie either within the user defined time period; or before the start point of the time period and just after the end point of the time period.

In the following examples:

[[fig_D-2-10]]
.Examples of S-104 data selection
image::figure-d-2-10.png["",356,316]

. User selected period 1, four values are from 0700, 0730, 0800 and 0830 - WLA would select 08:30 value = 1.2m (even though the time period doesn't overlap).
. User selected period 2, two values are from 0630 and 0700 - WLA would select 06:30 value V=1.2m (even though the time period doesn't overlap).
. User selected period 3, three values are from 0600, 0630 and 0700 - WLA would select 06:00 V=1.1m (even though the time period doesn't overlap).
. User selected period 4, five values are from 0630, 0700, 0730, 0800 and 0830 - WLA would select 07:30 V=1.2m.

When adjusting depth values the shoalest (smallest) value from the selected S-104 records must be used in order to produce the safest WLA values.

Format of the permanent indication is as below:

*WLA from 12:34 08 Nov 2021 to 14:56 08 Nov 2021*

[[sec_D-2.7]]
==== Implementation of WLA Option 3 - linking of WLA to a defined route with planned waypoints and times

When WLA is based on a route then the limit of check area around the route is set by the user as specified by IMO MSC 530(106) 11.3.7.

The same user-specified distance must be used for the check of safety contour, prohibited areas, geographic areas for which special conditions exist and navigational hazards and equivalent requirements when route monitoring

The WLA is processed within this check area. The boundary of the area of the display where WLA has been carried out must be displayed (as shown in <<fig_D-2-16>>). In the process description this distance is referred to as 'a'.

A route could be either a Planned route or a Monitored route. Both could be processed for the WLA, but not at the same time in a single display area. In case of multiple display areas, it is possible that one area is WLA processed for Planned route and another area is WLA processed for the Monitored route.

For a Planned route the datetime period applied for the WLA process is based on the schedule of the planned route itself.

For a Monitored route the datetime period applied for the WLA process is user selectable either:

. Based on the planned schedule of the monitored route itself; or
. Based on the monitored route adjusted for the current own ship position.

When WLA is based on the planned schedule and own ship is not keeping to schedule a Caution must be raised to indicate the water level being experienced may be different to that being applied by the ECDIS

The region of WLA is restricted to a distinguishable bordered polygon around the route. The process works as follows:

. For each section of the route a series of estimated time markers is defined along the route at times stem:[t_0 - t_n]. The diagram also shows the "limit of check area" as specified by IMO MSC 530(106) 11.3.5. Each time marker is delimited before and after by the time +/- half the user selected stem:[t_u] interval so the rectangle in the diagram represents the extent of time stem:[t_1] which ranges from time stem:[t_1 - t_u/2] to stem:[t_1 + t_u/2]. This is the WLA adjustment polygon (shown in red) corresponding to time stem:[t_1]:
+
--
[[fig_D-2-11]]
.WLA adjustment polygon
image::figure-d-2-11.png["",309,210]
--

. Where the route follows a curved section the polygon formed is not a rectangle but an area defined by the user selected limit as shown by areas a and b:
+
--
[[fig_D-2-12]]
.WLA adjustment polygon along curved section
image::figure-d-2-12.png["",483,203]
--

. The individual S-102 points (blue dots in <<fig_D-2-13>> below) are assigned rectangular extents. For each WLA adjustment rectangle corresponding to each stem:[t_i] the S-102 extents which spatially intersect are selected. A full example is shown in <<fig_D-2-13>> for one of the WLA polygons (shown in red).
+
--
[[fig_D-2-13]]
.Grid cell selection
image::figure-d-2-13.png["",455,317]
--

. For each S-102 point whose extent intersects the WLA adjustment polygon the Water level is adjusted using a similar process to Option 1. The S-104 value used for adjustment is the shoalest value from each of the S-104 points whose extents intersect the S-102 point (as described in WLA Option 1) across the time period (stem:[t_i - t_u/2]) and (stem:[t_i + t_u/2]), In <<fig_D-2-14>>, illustrating this step, two S-102 points are adjusted by S-104 values in the time period (stem:[t_1 - t_u/2]) and (stem:[t_1 + t_u/2]), for calculation of stem:[t_1]. S-102 point stem:[x] is adjusted using values drawn from S-104 points *_a_* and *_b_* (because its extent intersects the extents of points *_a_* and *_b_*) and S-102 point stem:[y] is only adjusted with values from S-104 point *_b_*.
+
--
[[fig_D-2-14]]
.Selection of S-104 data
image::figure-d-2-14.png["",385,261]
--

. Each of the S-102 points are assigned the adjusted water level equal to the S-102 value + the calculated (shoalest) S-104 value as defined in the previous step.
. Once the WLA polygon for time stem:[t_i] is processed the WLA polygon for time stem:[t_{i+1}] is processed.
. S-102 points whose extents are intersected by the both the WLA polygon for stem:[t_i] and stem:[t_{i+1}] are assigned the shoaler of the two values, that is the shoalest of the S-104 values between the two time periods (stem:[t_i - t_u/2]) and (stem:[t_i + t_u/2]) and (stem:[t_{i+1} - t_u/2]) and (stem:[t_{i+1} + t_u/2]).

This completes the WLA process for (red) polygon stem:[t_i]. In <<fig_D-2-15>> below the orange border shows S-102 points lying in WLA polygons stem:[t_1] and stem:[t_2] and which would be assigned the shoaler of the two S-104 values corresponding to the stem:[t_1] and stem:[t_2] WLA process.

[[fig_D-2-15]]
.15: Time-dependent adjustment of S-102 data with S-104 data
image::figure-d-2-15.png["",450,285]

This process is extended to all stem:[t_i] along the planned route.

<<fig_D-2-16>> shows a boundary line around all the WLA processed S-102 grid cells. This marks the boundary of the Water Level Adjustment area and requires portrayal to inform the user which areas of the display are subject to WLA. This area is surrounded by a distinguishable boundary line using colour token DEPWL footnote:[__thick dark blue dash dot line__, colour token DEPWL, xyL values are: DAY stem:[x = 0.15], stem:[y = not 0.15], stem:[L = 30.0]; DUSK stem:[x = 0.15], stem:[y = 0.15], stem:[L = 7.5]; NIGHT stem:[x = 0.15], stem:[y = 0.15], stem:[L = 1.2]]).

[[fig_D-2-16]]
.Boundary of adjusted area
image::figure-d-2-16.png["",601,323]

<<fig_D-2-17>> below shows how the rectangle is positioned in the middle of S-104 coverage area and at the edge of the S-104 coverage are.

[[fig_D-2-17]]
.Positioning in interior and at edge
image::figure-d-2-17.jpeg["",602,211]

Format of the permanent indication is as below:

*WLA from 12:34 08 Nov 2021 to 14:56 08 Nov 2021*

[[sec_D-3]]
=== Treatment of depth and water level related S-101 features

[[sec_D-3.1]]
==== Substitution and adjustment of depth values

In areas covered by only S-102, all depth values must be substituted for all ENC features at all scales which have depth attribution (that is, the attribute _valueOfSounding_ bound to them in the S-101 Feature Catalogue)

In areas where WLA is processed, all depth values must be adjusted for all ENC features at all scales which have depth attribution (that is, the attribute _valueOfSounding_ bound to them in the S-101 Feature Catalogue).

==== Areas covered by S-102 only or by both S-102 and S-104

Adjustment of different geographic primitives.

. Point Features
** For Areas covered by S-102 only, a value for the attribute _valueOfSounding_ must be taken from the S-102 grid cell extents which intersect the point feature (as shown in <<fig_D-3-18>>).
** For Areas covered by S-102 and S-104, the value for attribute _valueOfSounding_ must be taken from the S-102 grid cell extents which intersect the point feature. WLA is then applied to this value using S-104 records selected from the S-104 grid cell intersecting the point feature. The S-104 value selected is as defined in <<sec_D-2.5;and!sec_D-2.6;and!sec_D-2.7>>.

. For Curve and Surface features
** For Areas covered by S-102 only, the value for _valueOfSounding_ must be the shoalest value of all S-102 grid cells whose extents intersect the feature's geometry within the S-102 coverage available. If the curve or surface feature is not completely within the S-102 then the value defined is the shoalest resulting from the original feature value in S-101 attribute and the value selected from the intersecting S-102 grid cells.
** For Areas covered by S-102 and S-104, the value for _valueOfSounding_ is first selected, as the shoalest value of all S-102 grid cells whose extents intersect the feature's geometry. WLA adjustment must then applied to this value by selecting the shoalest value from all intersecting S-104 grid cells. The value selected is as defined in <<sec_D-2.5;and!sec_D-2.6;and!sec_D-2.7>> and shown in <<fig_D-3-19>>. If the curve or surface feature is not completely within the S-104 coverage then the adjusted value is the shoalest value resulting from the original feature value in S-101 attribute and the WLA adjusted value.

[[fig_D-3-18]]
.Substitution of sounding value from S-102
image::figure-d-2-18.png["",450,289]

[[fig_D-3-19]]
.Substitution of _valueOfSounding_ attribute in S-101 Obstruction from S-102 data
image::figure-d-2-19.png["",442,237]

The S-101 features for which this depth substitution must be implemeneted within S-102 coverage areas are all those which bind _valueOfSounding_ in the S-101 feature catalogue along with multipoint geometries, unless those specifically excluded in this section.

Soundings are included (either individual soundings or those which are part of an array) substituting the S-102 grid cell whose extents intersect the sounding position for the defined ZCOO (ISO8211), See <<fig_D-3-18>>.

If the depth substituted S-101 feature is covered by S-104, then WLA must be processed using the same method as for the underlying depth area.

Depth values must also be substituted in all ENC features at all scales which have the attribute _depthRangeMinimumValue_ bound to them in the S-101 Feature Catalogue.

For all features with substituted (and possibly adjusted values), the ECDIS Pick Report must indicate the substituted/adjusted value and its source. The format and portrayal of depths and drying heights (that is, number of decimals, etc) is unchanged.

For example, for S-102 only covered area:

*Value Of Sounding 12.3 m [S-102]*

When an S-101 attribute has been WLA adjusted the pick report must indicate the WLA adjusted value, source and time/date. The format of time date is: hh:mm dd mmm yyyy.

For example, for both S-102 and S-104 covered area:

*Value Of Sounding 15.5m [WLA 12:34 08 Nov 2021]*

*Value Of Sounding 15.5m [WLA from 12:34 08 Nov 2021 to 14:56 08 Nov 2021]*

==== Adjustment of heights and vertical clearance values

Any vertical measurement which is referenced to the same vertical datum as the S-104 data must be adjusted using the intersecting S-104 grid cell water level value. This must be applied on any features within the coverage of S-104. Where a feature is not completely within the S-104 coverage the adjusted value is the minimum value resulting from the original feature value in the S-101 attribute and the WLA adjusted value.

Adjustment is defined for all features which bind _verticalDatum_ in the S-101 feature catalogue unless specifically excluded in this section.

The simple attributes adjusted are _height_ and _verticalClearanceValue_. When adjusting height or clearance values the largest value from the selected S-104 records must be used in order to produce the safest values.

The user must be given a permanent indication that the Water Level (S-104) values have adjusted attributes in the data display. Where values are not adjusted due to an incompatibility of vertical datums in the data, the user must be given a similar permanent notification.

When either _height_ or _verticalClearanceValue_ in S-101 have been substituted or adjusted the ECDIS Pick Report must indicate the substituted value, source and time/date. The format of the height or vertical clearance values (that is, number of decimals, etc) is unchanged.

For example:

*Vertical Clearance Value 5.3 m Mean Sea Level [WLA 12:34 08 Nov 2021]*

*Value Of Vertical Clearance 15.5m Mean Sea Level [WLA from 12:34 08 Nov 2021 to 14:56 08 Nov 2021]*

==== Alerts and indication details

Substituted or adjusted values in ENCs at the largest scale must be used as input to any alert/indication processing. The substituted values are portrayed as shown in <<fig_D-3-20>> which shows the graphical highlight (red boundary and red transparent fill) for the intersected safety contour.

[[fig_D-3-20]]
.20 - Graphical highlight for intersected safety contour
image::figure-d-3-20.png["",363,230]

==== Legend details

The legend must additionally indicate the vertical datum of S-102 and S-104 If the vertical datums are the same then a single indication is enough to cover S-101, S-102 and S-104.

[[annexE]]
[appendix]
== Dataset Loading and Display (Rendering) Algorithms

=== Introduction

Details of the dataset loading and data display algorithms are contained within this Appendix.

Algorithms for dataset loading, unloading, and rendering (display) within a navigation system are prescribed for S-101 (and possibly other products which provide multiple generalizations for a given geographic area) in order for the appropriate data to be viewed at the mariner's selected viewing scale (MSVS).

These algorithms are intended to provide clear and concise rules on how and when data is loaded and unloaded; and the order in which datasets are to be displayed.

NOTE: These algorithms only address loading and display related to visualization within the system graphics window. The application may need to load other datasets to satisfy requirements related to alerts processing, such as MSC.530(106)/Rev.1 A11.2.

NOTE: Light sectors and other features which may span dataset boundaries. It should be possible, on request, for the mariner to be capable of identifying the colour of the sectors affecting the ship, even if the lights involved are off the display, and, in general provision must be made to ensure that all relevant features are portrayed.

Scales and scale ranges are defined in <<sec_12.1.1>>. The scale range of a dataset is the range of display scales between which a producer intends the data for use. This scale range is determined by the scale ranges of the component *Data Coverage* features. Each *Data Coverage* feature has a *minimum display scale* and an *optimum display scale* attribute; the dataset scale range is from the smallest to the largest of these attribute values.

==== Dataset Loading Algorithm

===== Prerequisites

A collection of *Data Coverages, each* containing:

* A polygon describing the *Data Coverage*: __(dataCoverage)__;
* A set of scale bands: __scaleBands(dataCoverage)__;
* The associated dataset: __dataset(dataCoverage)__.

A projection _projection_ that can convert geographic polygons _geoPolygon_ to device polygons: __projection(geoPolygon)__;

==== Scale Bands

Attributes which represent scales store the denominator of the scale; an attribute value of "22,000" represents a scale of "1:22,000". Larger values represent smaller scales, while smaller values represent larger scales.

A scale range is the set of scales between different scale values. The attributes *minimum display scale* and *optimum display scale* describe the scale range of a *Data Coverage* feature. The scale range of a dataset is a set of ranges, each range taken from each of the component *Data Coverage*.

Scale bands describe specific scale ranges, as defined in <<table_11>>. Each scale band is defined by its minimum and optimum scale denominators and is defined using a numerical index.

Note that whenever scales are compared in these algorithms the numerical comparison and _min/max_ functions are based on scales, not on scale denominators for example a scale of 45,000 is less than ("<") a scale of 22,000 and stem:[min (22000,45000) = 45000].

[[table_11]]
.Scale Band definitions
[cols="46,141,214,140"]
|===
h| _scale band index_ h| _minimumScale_ h| _optimumScale_ h| Remarks

| 1   | NULL (stem:[oo]) | 10,000,000 | For all values larger than 10,000,000
| 2   | 10,000,000       | 3,500,000  |
| 3   | 3,500,000        | 1,500,000  |
| 4   | 1,500,000        | 700,000    |
| 5   | 700,000          | 350,000    |
| 6   | 350,000          | 180,000    |
| 7   | 180,000          | 90,000     |
| 8   | 90,000           | 45,000     |
| 9   | 45,000           | 22,000     |
| 10  | 22,000           | 12,000     |
| 11  | 12,000           | 8,000      |
| 12  | 8,000            | 4,000      |
| 13  | 4,000            | 3,000      |
| 14  | 3,000            | 2,000      |
| 15  | 2,000            | 1,000      |
|===

The following algorithm associates a scale band index with a (display) scale:

[pseudocode%unnumbered]
====
*Algorithm* __GetScaleBand(scale)__
*Input*: A scale
*Output* The index of the scale band
    1. **If** _scale < 10,000,000_
        a. **Return** 1
    2. **For** _index_ = 2 to 15
        a. *If* _scale > minimumScale[index] AND scale <= optimumScale[index]_
            i. *Return* _index_
    3. *Return* 15
====

The following algorithm associates a set of scale band indexes with a *Data Coverage* feature:

[pseudocode%unnumbered]
====
**Algorithm** _scaleBands(dataCoverage)_
*Input*: A *Data Coverage*
*Output:* A set of associated scale band indices _S_
    1. _minimumDisplayScale_ - The minimum display scale of the coverage (if not defined it is assumed that the scale is stem:[1:oo = 0])
    _optimumDisplayScale_ - The optimum display scale of the coverage
    2. Create an empty set _S_
    3. *If* _minimumDisplayScale < 10,000,000_
        a. stem:[S = S uu 1]
    4. *For* index = 2 to 15
        a. If _max(minimumDisplayScale,minimumScale[index]) < min(optimumDisplayScale,optimumScale[index])_
            i. stem:[S = S uu "index"]
    5. *Return* S
====

==== Dataset Selection Process

The following algorithm selects *Data Coverage* features. The output is used to load each dataset which is associated with any of the selected features (stem:[S]).

The algorithm evaluates a collection of *Data Coverage* features and selects those which overlap both the viewport and a supplied scale. If selected, the coverage footprint is subtracted from the viewport. This process is repeated until the viewport is empty or the entire inventory has been evaluated.

[pseudocode%unnumbered]
====
**Algorithm** _SelectDataCoverages(collection, scale, viewport, projection)_
*Input*: A collection of *Data Coverage* features _collection_
         A _scale_ for which the *Data Coverage* features will be selected (usually the display scale)
         A device-polygon _viewport_ describing the device area that should be covered with data
         A projection __projection__
**Output**: A set of *Data Coverage* features _S_
    1. stem:[S = O/]
    2. _ScaleBand_ = _GetScaleBand(scale)_
    3. *While* stem:["viewport" != O/] *do*
        a. *For* all _dataCoverage_ in _collection_
            i. *If* __ScaleBand__ stem:[in] scaleBands(_dataCoverage_) AND (_projection_(__dataCoverage__) stem:[nn] _viewport_) stem:[!= O/]
                1. stem:[S = S uu "dataCoverage"]
                2. _viewport_ = _viewport_ \ _projection(dataCoverage)_
        b. _ScaleBand_ = _ScaleBand_ - 1
        c. **If** __ScaleBand__ = 0
    4. **Return** _S_.
====

Comments:

[cols="41,534",options="unnumbered"]
|===
h| Row h| Description

| *1.*        | Create an empty set of inventory *Data Coverage* features
| *2.*        | Get the scale band to which _scale_ belongs and assign it to the variable _ScaleBand_
| *3.*        | While the _viewport_ area is not empty
| *3.a*       | Loop over all *Data Coverage* features in the inventory
| *3.a.i*     | If _ScaleBand_ is an element of the scale bands of the **Data Coverage and** the projected *Data Coverage* polygon overlaps the _viewport_
| *3.a.i.1.*  | Add the *Data Coverage* to _S_
| *3.a.i.2.*  | Remove the projected *Data Coverage* polygon from the __viewport__, The _viewport_ will now only define the uncovered part of the original _viewport_
| *3.b.*      | Decrement _ScaleBand_ footnote:[Data Coverage features selected after this point in the algorithm are subject to the OVERSC01 grossly overscaled pattern as described in <<sec_12.3>>]

| *3.c.*      | If _ScaleBand_ equals to zero (no scale band left to investigate)
| *3.c.i.*    | Return the collected result
| *4.*        | Return the collected result
|===

==== Data display Algorithm

===== Rendering Algorithm

The first step is to use information from the loading algorithm to assign a _mask_ to each of the *Data Coverage* features within each dataset.

Each _mask_ represents the footprint of obscuring *Data Coverages;* it indicates areas of a dataset which should not be visible. Each dataset is then assigned a _mask_ from the component *Data Coverage* features. The dataset _mask_ is the union of the component *Data Coverage* masks.

[pseudocode%unnumbered]
====
*Algorithm*: _AssignMasks(dataSets, viewport, projection)_
*Input*: A set of datasets _dataSets_ (previously selected using the dataset loading algorithm)
         A device-polygon _viewport_ describing the device area that should be covered with data
         A projection _projection_
        1. Collect all *Data Coverage* features from _dataSets_ into _dataCoverages_.
        2. Sort _dataCoverages_ by *minimum display scale* into _sortedCoverages_ (from smallest to largest scale)
        3. *For* each _dataCoverage_ in _sortedCoverages_
            a. *Set* _mask of dataCoverage to_ stem:[O/]
            b. *For* each _obscuringCoverage_ in _sortedCoverages_
                i. *If* _obscuringCoverage_ <> _dataCoverage_ AND _scale(dataCoverage)_ < _scale(obscuringCoverage)_ AND _projection(polygon(dataCoverage))_ stem:[cap] _projection(polygon(obscuringCoverage))_ stem:[!= O/]
                    1. _dataCoverage.mask_ = _dataCoverage.mask_ stem:[uu] _projection_(_polygon_(_obscuringCoverage_))
        4. For each _dataset_ in _dataSets_
            a. Set mask of dataset to stem:[O/]
            b. For each _dataCoverage_ in _dataset_
                i. _dataset.mask_ = _dataset.mask_ stem:[uu] _dataCoverage.mask_
====

The next step is rendering. The screen is filled with the no data pattern, then the active drawing instructions are collected from all loaded datasets and sorted by drawing priority. Each drawing instruction is then rendered using the _RenderInstruction_ algorithm.

[pseudocode%unnumbered]
====
*Algorithm*: _RenderChartImage(dataSets, viewport)_
*Input*: A set of datasets _dataSets_ (previously selected using the dataset loading algorithm)
         A device-polygon _viewport_ describing the device area that should be covered with data
    1. Fill _viewport_ as per Section _12.5.1 ENC No data areas_.
    2. Collect all active^\*^ drawing instructions from all _dataSets_ into _drawingInstructions._
    3. Sort _drawingInstructions_ by **drawing priority** into _sortedInstructions_ (from smallest to largest)^**^
        a. Instructions which share a *drawing priority* must be ordered as follows:
            i. all null instructions, followed by
            ii. all area instructions, followed by
            iii. all line instructions, followed by
            iV. all point instructions, followed by
            v. all text instructions
    4. For each _drawingInstruction_ in __sortedInstructions__
        a. __RenderInstruction__(_drawingInstruction_)

^*^ The __viewingGroup(s)__, __scaleMinimum__, _scaleMaximum, date dependency, line suppression, and any other_ properties of the drawing instruction which may affect the instructions visibility must be taken into account. (See S-100 Part 9).

^**^ To enhance the readability of text, an implementation may consider the guidance in S-100 Part 9 regarding text rendering to adjust this algorithm as needed.
====

==== The RenderInstruction Algorithm

This algorithm describes how each drawing instruction is to be rendered. Instructions originating from non-point geometries use _mask_ to clip or mask the rendered output; those originating from occluded point geometries are not rendered, and those originating from non-occluded point geometries are rendered without masking or clipping.

[pseudocode%unnumbered]
====
*Algorithm*: _RenderInstruction(drawingInstruction, dataset, viewport)_
*Input*: A _drawingInstruction_ generated by dataset portrayal
            The _dataset_ of the drawing instruction
            A device-polygon _viewport_ describing the device area that should be covered with data
    1. _isPoint_ = false
        a. *If* _drawingInstruction_ is an augmented point
            i. _isPoint_ = true
            ii. _point_ = augmented geometry
        b. *Else If* geometry of _drawingInstruction_ *feature reference* is a point
            i. _isPoint_ = true
            ii. __point =__ feature reference geometry
    2. *If* not __isPoint__
        a. Render the drawing instruction, using the _dataset mask_ to either clip or mask the rendered output. Portions of the rendered output which intersect _mask_ should not be visible.
    3. *Else If* _dataset.mask_ stem:[cap] _point_ <> stem:[O/]
        a. Do not render the instruction
    4. *Else*
        a. Render the instruction (without masking or clipping)
====

[[annexF]]
[appendix]
== GML Coverage Polygons

=== GML Coverage Polygons

==== Introduction

GML is used as an integral part of S-100 Part 17, specifically in the XML elements defined by the Exchange Catalogue Schema.

For the purpose of representing coverage objects in CATALOG.XML, however only a very small number of possibilities are required.

Implementers would benefit from a tighter standardization through a reduction of the CATALOG.XML coverage polygons.

==== Specification

In order to simplify the job of S-100 implementers for CATALOG.XML the only requirement is for a representation which encodes a simple, connected polygon with a single exterior and 0 or more holes.

Such polygons will be implemented using the GML vocabulary implemented in the included S-100 schemas as follows:

[source%unnumbered]
----
<S100XC:boundingPolygon>
     <gex:polygon>
         <gml:Polygon gml:id="DC1">
             <gml:exterior>
                 <gml:LinearRing>
                     <gml:posList srsName="http://www.opengis.net/def/crs/EPSG/0/4326">
                             0.0 0.0 1.0 0.0 1.1 1.1 0.0 1.0 0.0 0.0
                     </gml:posList>
                 </gml:LinearRing>
             </gml:exterior>
             <gml:interior>
                 <gml:LinearRing>
                     <gml:posList srsName="http://www.opengis.net/def/crs/EPSG/0/4326">
                             0.25 0.25 0.75 0.25 0.75 0.75 0.25 0.75 0.25 0.25
                     </gml:posList>
                 </gml:LinearRing>
             </gml:interior>
           </gml:Polygon>
       </gex:polygon>
</S100XC:boundingPolygon>
----

This implements bounding Polygons restricted to a single GML Polygon (with a gml:id with an SRS defined in each of the posList coordinates of http://www.opengis.net/def/crs/EPSG/0/4326) with a single exterior element and optional (i.e. 0 or more ) interior elements. Each exterior or optional interior is a Linear Ring with >=4 coordinate pairs expressed as a single space separated posList, with the first and last coordinate pair being identical, i.e. the Linear Ring is closed.

Coordinate order is always as per http://www.opengis.net/def/crs/EPSG/0/4326, latitude followed by longitude.

No further stipulations are required as geometry must also conform to the S-100 geometry model and be conformant with the XML Schema for exchange catalogues.

[[annexG]]
[appendix]
== Thinning Algorithms

=== Introduction

Thinning algorithms resize symbols and ensure they do not conflict on screen. Thinning is only required when zooming within the visible scale range (maximum - minimum display scale) of a dataset. The ECDIS implementer must use a thinning algorithm to reduce the possibility of screen clutter. The algorithm described meets these requirements but implementers may also use their own.

==== Regularly gridded data

Let the grid cell's diagonal for the unthinned grid at the current display scale be given by stem:[D "unitsml(mm)"]. Note that stem:[D] is dependent on the dataset and the characteristics of the viewing monitor. If every stem:[n^{"th"}] cell is displayed, the displayed spacing is stem:[nD]. Next, suppose the maximum dimension of the largest scaled symbol in the displayed field is stem:[L_{smax} "unitsml(mm)"]. Then the ratio stem:[R] of the maximum symbol dimension to the displayed grid spacing is constrained to be less than a prescribed maximum value, stem:[R_{"max"}]. A typical value for stem:[R_{"max"}] can be taken to be 0.5. (Given that on a navigation display there may be point features from other products within the extent of the grid, _Rmax=0.5_ may be too high for practical use; the optimal value of stem:[R_{"max"}] is left to manufacturer determination, and may be different for different products, depending on the shape of the symbol.) Then the following inequality must be satisfied for the thinned grid:

[stem%unnumbered]
++++
R = L_{"smax"} / {nD} < R_{"max"}
++++

If the above inequality cannot be met with increment stem:[n] equal to 1, then a new value for stem:[n] is computed by the following formula:

[stem%unnumbered]
++++
n = 1 + "fix" (L_{"smax"} / {D R_{"max"}})
++++

Where stem:["fix"()] is a function that returns the truncated integer value of its argument. For plotting, arrows at every stem:[n^{"th"}] column and every stem:[n^{"th"}] row are drawn, making sure that the row and column with the maximum-size symbol is drawn. The value of stem:[n] must be calculated by the system. It also requires identifying a "seed point," a grid point with the maximum-size symbol from which counting starts. Designating this seed point as (stem:[x_0, y_0]), the grid points where symbols are drawn are given by:

[stem%unnumbered]
++++
{:{:(x_k,=,x_0 pm (n xx k)),(y_k,=,y_0 pm (n xx k)):}} quad "for" quad k = 0, 1, 2, 3, ...
++++

This algorithm assumes the grid spacing can be represented by its cell diagonal. It can be adapted to allow for symbols that are aligned parallel to grid axes or for rectangular cells.

The Figures below illustrate the use of this algorithm. <<fig_G-1-1>> depicts a grid coverage feature symbolised by arrows of dimensions varying according to the value of an attribute at the grid point. <<fig_G-1-2>>. depicts the same data thinned with stem:[R_{"max"} = 0.5] (outline-only arrows are suppressed). <<fig_G-1-3>> depicts the thinning of the same data with stem:[R_{"max"} = 0.33]. The nominal footnote:[Values are for hypothetical data and display, and the figures have been reduced for reproduction in this document.] dimensions and parameters for the three cases are:

Grid spacing at the display scale (stem:[D]): stem:[36 "unitsml(mm)"] (grid diagonal).

Scaling of symbols by data attribute values at grid points produced symbols of four sizes (arrow length):

* stem:[L0 = 30.4 "unitsml(mm)" = L_{"smax"}]
* stem:[L1 = 17.7 "unitsml(mm)"]
* stem:[L2 = 16.2 "unitsml(mm)"]
* stem:[L3 = 12.7 "unitsml(mm)"]

[[fig_G-1-1]]
.Grid without thinning
image::figure-g-1-1.png["",365,361]

For stem:[R_{"max"} = 0.5], with stem:[n = 1], the value of stem:[R] is greater than stem:[R_{"max"}]:

[stem%unnumbered]
++++
R = L_{"smax"}/{1 xx D} = 30.4/36 = 0.844 > 0.5
++++

Applying the formula for computing stem:[n]:

[stem%unnumbered]
++++
n = 1 + "fix"(30.4/(36 xx 0.5)) = 2
++++

Counting in row-major order from the grid origin stem:[(0,0)], the first symbol of size _Lsmax_ is located at stem:[(1,1)]. Denoting this point as the seed point stem:[(x0, y0)], the only grid points where symbols are displayed are:

[stem%unnumbered]
++++
{:{:(x_k,=,x_0 pm (2 xx k)),(y_k,=,y_0 pm (2 xx k)):}} quad "for" quad k = 0, 1, 2, 3, ...
++++

The results are depicted in the following figure.

[[fig_G-1-2]]
.Grid thinned with stem:[R_{"max"} = 0.5]
image::figure-g-1-2.png["",316,313]

For stem:[R_{"max"} = 0.33], the formula for stem:[n] yields:

[stem%unnumbered]
++++
n = 1 + "fix"(30.4/(36 xx 0.33)) = 3
++++

and

[stem%unnumbered]
++++
{:{:(x_k,=,x_0 pm (3 xx k)),(y_k,=,y_0 pm (3 xx k)):}} quad "for" quad k = 0, 1, 2, 3, ...
++++

The results are shown in <<fig_10>>.

[[fig_G-1-3]]
.Grid thinned with stem:[R_{"max"} = 0.33]
image::figure-g-1-3.png["",320,316]

The algorithm may hide significant characteristics of the data; for example, counting displayable rows and columns starting with the first instance of a maximised symbol may suppress significant information in nearby grid points and produce the wrong overall impression. In <<fig_G-1-3>>, row 2 would be suppressed even if all the data points in that row are of the same size as the symbol at (1,1) — this would suppress more data points with scaled-up symbols, which may represent data of more significance to the Mariner.

Grid diagonal as a measure of cell spacing is more suitable for grids where cell dimensions along both axes are approximately equal in display units (that is, in millimetres at the display scale); if there are significant differences, the stem:[D] and stem:[R_{"max"}] parameters will need to be different for the two axes.

Execution of this algorithm would be faster if the grid coordinates of the seed point stem:[(x0, y0)] are known in advance, either encoded by the producer as instance metadata, or calculated when the dataset is ingested into the system. S-100 does not yet provide a standard way of encoding this information.

Manufacturers may extend or adapt this algorithm in various ways, for example:

* Adapt stem:[R_{"max"}] to the shape and proportions of the symbol (that is, its perceived effect on the display).
* For grids with cells whose dimensions in display units are very different along different axes, use different stem:[D] and stem:[R_{"max"}] parameters for the two axes, giving different values of stem:[n] for different axes.
* Pre-compute and cache the scale values where stem:[n] changes, so that suppression or revelation of symbols can be determined by the scale of the display.
* Adapt the determination of the seed point to show as many significant values as possible.

In order to avoid confusing the mariner, reasonable consideration should be given to generally maintaining the regular appearance of the grid coverage, though some irregularity is probably unavoidable with greater thinning.

[[annexH]]
[appendix]
== Import and Use of projected data on S-100 ECDIS

[[sec_H-1]]
=== Introduction

The ECDIS implementer must use an algorithm for the conversion of UTM coordinates to geographic latitude/longitude. The algorithm described meets these requirements but implementers may also use their own.

<<sec_H-1.1>> and <<sec_H-1.2>> provide a set of numbered, steps for the conversion calculations.

[[sec_H-1.1]]
==== Conversion from UTM to WGS 84

. For the calculation of latitude stem:[varphi] and longitude stem:[lambda] (both in degrees of arc) from easting stem:[E] and northing stem:[N] (both in meters) from a Universal Transverse Mercator (UTM) coordinate reference system (CRS) where the UTM CRS has a geodetic CRS of WGS 84, it is given for all UTM zones:
+
--
False easting stem:[FE]:: stem:[= 500000 "unitsml(m)"]
Scale at natural origin stem:[k_0]:: stem:[= 0.9996]
Semi-major axis stem:[a]:: stem:[= 6378137.000 "unitsml(m)"]
Inverse flattening stem:[1/f]:: stem:[= 298.257223563]

Where stem:[b] is the semi-minor axis, because stem:[1/f = a/{a - b}]

if follows that stem:[f = 3.35281066475 xx 10^{-3}]

that stem:[b = a(1 - f)]

and that stem:[b = 6356752.31425]
--

. For all UTM North zones, false northing stem:[FN = 0 "unitsml(m)"]
+
--
For all UTM South zones, false northing stem:[FN = 10000000 "unitsml(m)"]
--

. Each UTM zone has a corresponding central meridian stem:[λ_0], which can be found in the EPSG dataset. North and south zones of the same number (e.g., UTM Zone 18N and UTM Zone 18S) share a central meridian.

Algorithmically, the value can be found as follows:

For zone numbers stem:[N_z] between 1 and 30 (inclusive): stem:[λ_0 = [183-(6 xx N_z)\] "unitsml(deg)" W]

For zone numbers stem:[N_z] between 31 and 60 (inclusive): stem:[λ_0 = {[6 xx (N_z-30)\] - 3} "unitsml(deg)" E]

[example]
For UTM Zone 45S, stem:[N_z = 45], so stem:[lambda_0 = 87 "unitsml(deg)"E]. stem:[lambda_0] is also stem:[87 "unitsml(deg)"E] for UTM Zone 45N.

. We next calculate constants for the projection
+
--
[stem%unnumbered]
++++
e = sqrt{2} f - f^2 = 8.18191908 xx 10^{-2}
++++

[stem%unnumbered]
++++
n = f/{(2 - f)} = 1.67922039 xx 10^{-3}
++++

[stem%unnumbered]
++++
B = [a/{(1 + n)} (1 + n^2/4 + n^4/64)] = 6367449.145823415
++++

[stem%unnumbered]
++++
h_1^' = n/2 - (2/3) n^2 + (37/96) n^3 - (1/360) n^4 = 8.37732164 xx 10^{-4}
++++

[stem%unnumbered]
++++
h_2^' = (1/48) n^2 - (1/15) n^3 + (437/1440) n^4 = 5.84321837 xx 10^{-8}
++++

[stem%unnumbered]
++++
h_3^' = (17/480) n^3 - (37/840) n^4 = 1.67348888 xx 10^{-10}
++++

[stem%unnumbered]
++++
h_4^' = (4397/161280) n^4 = 2.16773776 xx 10^{-13}
++++
--

. Then
+
--
[stem%unnumbered]
++++
eta^' = (E - FE)/(B k_O) = (E - 500000)/6364902.166165086
++++

[stem%unnumbered]
++++
xi^' = (N - FN)/(B k_O) = (N - FN)/6364902.166165086
++++

[stem%unnumbered]
++++
xi_1^' = h_1^' sin(2 xi^') cosh(2 eta^') quad quad quad eta_1^' - h_1^' cos(2 xi^') sinh(2 eta^')
++++

[stem%unnumbered]
++++
xi_2^' = h_2^' sin(4 xi^') cosh(4 eta^') quad quad quad eta_2^' = h_2^' cos(4 xi^') sinh(4 eta^')
++++

[stem%unnumbered]
++++
xi_3^' = h_3^' sin(6 xi^') cosh(6 eta^') quad quad quad eta_3^' = h_3^' cos(6 xi^') sinh(6 eta^')
++++

[stem%unnumbered]
++++
x_4^' = h_4^' sin(8 xi^') cosh(8 eta^') quad quad quad eta_4^' = h_4^' cos(8 xi^') sinh(8 eta^')
++++

[stem%unnumbered]
++++
xi_0^' = xi^' + (xi_1^' + xi_2^' + xi_3^' + xi_4^') quad quad quad eta_0^' = eta^' - (xi_1^' + xi_2^' + xi_3^' + xi_4^')
++++

[stem%unnumbered]
++++
beta^' = sin^{-1}({sin xi_0^'}/{cosh eta_0^'})
++++

[stem%unnumbered]
++++
Q^' = sinh^{-1}(tan beta^')
++++

[stem%unnumbered]
++++
(:(Q^{''},=, Q^' + [e tanh^{-1} (e tanh Q^')],),
(,=, Q^' + [e tanh^{-1} (e tanh Q^{''})], "which should be iterated until the change in" quad Q^{''} < 10^{-8t}):)
++++
--

. Finally
+
--
[stem%unnumbered]
++++
{:(varphi, =, tan^{-1} (sinh Q^{''})(180/pi)),
(lambda, =, lambda_0 + sin^{-1} ({tanh(eta_0^')}/{cos beta^'})(180/pi)):}
++++
--

[[sec_H-1.2]]
==== Conversion from UPS North to WGS 84

. For the calculation of latitude stem:[phi] and longitude stem:[lambda] (both in degrees of arc) from easting stem:[E] and northing stem:[N] (both in meters) from the Universal Polar Stereographic (UPS) North CRS with a geodetic CRS of WGS 84, it is given that:
+
--
False easting stem:[FE = 2000000 "unitsml(m)"]

False northing stem:[FN = 2000000 "unitsml(m)"]

Scale at natural origin stem:[k_0 = 0.994]

Semi-major axis stem:[a = 6378137.000 "unitsml(m)"]

Inverse flattening stem:[1/f = 298.257223563]

It follows that stem:[f = 3.35281066475 xx 10^{-3}]

and that stem:[e = sqrt{2f - f^2} = 8.18191908 xx 10^{-2}]
--

. We next calculate the value stem:[t^']:
+
--
[stem%unnumbered]
++++
t^' = {sqrt{[(E - FE)^2 + (N - FN)^2](1 + e)^{(1 + e)}(1 - e)^{(1 - e)}}}/{2 a k_0}
++++

[stem%unnumbered]
++++
= 7.91307065 xx 10^{-8} sqrt{[(E-2000000)^2+(N-2000000)^2]}
++++
--

. We then calculate the value stem:[chi]. For UPS North:
+
--
[stem%unnumbered]
++++
chi = pi/2 - 2 tan^{-1} t^'
++++
--

. We then find stem:[varphi]
+
--
[stem%unnumbered]
++++
phi = (180/pi) [chi + (e^2/2 + {5e^4}/24 + e^6/12 + {13e^8}/360) sin(2chi) + ({7e^4}/48 + {29e^6}/240 + {811e^8}/11520) sin(4chi) + ({7e^6}/120 + {81e^8}/1120) sin(6chi) + ({4279e^8}/161280) sin(8chi)]
++++

[stem%unnumbered]
++++
= (180/pi)[chi + 3.35655147 xx 10^{-3} sin(2chi) + 6.57187270 xx 10^{-6} sin(4chi) + 1.76456433 xx 10^{-8} sin(6chi) + 5.32847842 xx 10^{-11} sin(8chi)]
++++
--

. Finally
+
--
if stem:[E = 200000, quad lambda = 0 "unitsml(deg)"]

else, stem:[lambda = (180/pi) atan2[(E - 200000),(200000 - N)\]]
--

==== Conversion from UPS South to WGS 84

. For the calculation of latitude stem:[phi] and longitude stem:[lambda] (both in degrees of arc) from easting stem:[E] and northing stem:[N] (both in meters) from the UPS South CRS with a geodetic CRS of WGS 84, it is given that:
+
--
False easting stem:[FE = 2000000 "unitsml(m)"]

False northing stem:[FN = 2000000 "unitsml(m)"]

Scale at natural origin stem:[k_0 = 0.994]

Semi-major axis stem:[a = 6378137.000 "unitsml(m)"]

Inverse flattening stem:[1/f = 298.257223563]

It follows that stem:[f = 3.35281066475 xx 10^{-3}]

and that stem:[e = sqrt{2f - f^2} = 8.18191908 xx 10^{-2}]
--

. We next calculate the value stem:[t^']:
+
--
[stem%unnumbered]
++++
{:(t^', =, {sqrt{[(E - FE)^2 + (N - FN)^2](1 + e)^{(1 + e)}(1 - e)^{(1 - e)}}}/{2 a k_0}),
(,=, 7.91307065 xx 10^{-8} sqrt{[(E-2000000)^2+(N-2000000)^2]}):}
++++
--

. We then calculate the value stem:[chi]. For UPS South:
+
--
[stem%unnumbered]
++++
chi = 2 tan^{-1} t^' - pi/2
++++
--

[start=4]
. We then find stem:[varphi]:
+
--
[stem%unnumbered]
++++
varphi = (180/pi) [chi + (e^2/2 + {5e^4}/24 + e^6/12 + {13e^8}/360) sin(2chi)
+ ({7e^4}/48 + {29e^6}/240 +{811e^8}/11520) sin(4chi)
+ ({7e^6}/120 + {81e^8}/1120) sin(6chi)
+ ({4279e^8}/161280) sin(8chi)]
++++

[stem%unnumbered]
++++
= (180/pi) [chi + 3.35655147 xx 10^-3 sin(2 chi) + 6.57187270 xx 10^-6 sin(4 chi) + 1.76456433 xx 10^-8 sin(6 chi) + 5.32847842 xx 10^-11 sin(8 chi)]
++++
--

. Finally
+
--
if stem:[E = 200000], stem:[lambda "unitsml(deg)"]

else, stem:[lambda = (180/pi) atan2[(E - 200000),(N - 200000)\]]
--

==== References [Informative]

The following references are provided for background, and to explain the origin of the formulas stated in this specification.

. "EPSG Geodetic Parameter Dataset" v. 11.023, 5 December 2024, https://epsg.org/
. IOGP Report 373-07-02 "Coordinate conversions and transformations including formulas" v. 68, August 2024, https://epsg.org/guidance-notes.html, p. 7
. IOGP Report 373-07-02, p. 60
. IOGP Report 373-07-02, p. 61
. IOGP Report 373-07-02, p. 84

////
////